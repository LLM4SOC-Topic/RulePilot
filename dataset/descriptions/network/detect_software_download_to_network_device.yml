description: The following analytic identifies unauthorized software downloads to
  network devices via TFTP, FTP, or SSH/SCP. It detects this activity by analyzing
  network traffic events on specific ports (69, 21, 22) from devices categorized as
  network, router, or switch. This activity is significant because adversaries may
  exploit netbooting to load unauthorized operating systems, potentially compromising
  network integrity. If confirmed malicious, this could lead to unauthorized control
  over network devices, enabling further attacks, data exfiltration, or persistent
  access within the network.
required_fields:
- _time
- All_Traffic.transport
- All_Traffic.dest_port
- All_Traffic.dest_category
- All_Traffic.src_category
- All_Traffic.src
- All_Traffic.dest
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Network_Traffic where (All_Traffic.transport=udp AND All_Traffic.dest_port=69)
  OR (All_Traffic.transport=tcp AND All_Traffic.dest_port=21) OR (All_Traffic.transport=tcp
  AND All_Traffic.dest_port=22) AND All_Traffic.dest_category!=common_software_repo_destination
  AND All_Traffic.src_category=network OR All_Traffic.src_category=router OR All_Traffic.src_category=switch
  by All_Traffic.src All_Traffic.dest All_Traffic.dest_port | `drop_dm_object_name("All_Traffic")`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `detect_software_download_to_network_device_filter`'
