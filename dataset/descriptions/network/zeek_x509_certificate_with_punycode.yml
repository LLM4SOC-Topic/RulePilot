description: The following analytic detects the presence of punycode within x509 certificates
  using Zeek x509 logs. It identifies punycode in the subject alternative name email
  and other fields by searching for the "xn--" prefix. This activity is significant
  as punycode can be used in phishing attacks or to bypass domain filters, posing
  a security risk. If confirmed malicious, attackers could use these certificates
  to impersonate legitimate domains, potentially leading to unauthorized access or
  data breaches.
required_fields:
- domain_detected
- basic_constraints.ca
- source
- host
rule: sourcetype="zeek:x509:json" | rex field=san.email{} "\@(?<domain_detected>xn--.*)"
  | rex field=san.other_fields{} "\@(?<domain_detected>xn--.*)" | stats values(domain_detected)
  by  basic_constraints.ca source host | `zeek_x509_certificate_with_punycode_filter`
