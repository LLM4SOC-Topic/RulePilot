description: The following analytic identifies DNS requests with unusually large query
  lengths for the record type being requested. It leverages the Network_Resolution
  data model and applies a machine learning model to detect outliers in DNS query
  lengths. This activity is significant because unusually large DNS queries can indicate
  data exfiltration or command-and-control communication attempts. If confirmed malicious,
  this activity could allow attackers to exfiltrate sensitive data or maintain persistent
  communication channels with compromised systems.
required_fields:
- _time
- DNS.src
- DNS.dest
- DNS.query
- DNS.record_type
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as start_time max(_time) as end_time
  values(DNS.src) as src values(DNS.dest) as dest from datamodel=Network_Resolution
  by DNS.query DNS.record_type | search DNS.record_type=* |  `drop_dm_object_name(DNS)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | eval query_length = len(query) | apply dns_query_pdfmodel threshold=0.01
  | rename "IsOutlier(query_length)" as isOutlier | search isOutlier > 0 | sort -query_length
  | table start_time end_time query record_type count src dest query_length | `dns_query_length_outliers___mltk_filter`'
