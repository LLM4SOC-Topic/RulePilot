description: The following analytic identifies allowed network traffic to The Onion
  Router (TOR), an anonymity network often exploited for malicious activities. It
  leverages data from Next Generation Firewalls, using the Network_Traffic data model
  to detect traffic where the application is TOR and the action is allowed. This activity
  is significant as TOR can be used to bypass conventional monitoring, facilitating
  hacking, data breaches, and illicit content dissemination. If confirmed malicious,
  this could lead to unauthorized access, data exfiltration, and severe compliance
  violations, compromising the integrity and security of the network.
required_fields:
- _time
- All_Traffic.app
- All_Traffic.action
- All_Traffic.src_ip
- All_Traffic.dest_ip
- All_Traffic.dest_port
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Network_Traffic where All_Traffic.app=tor AND All_Traffic.action=allowed
  by All_Traffic.src_ip All_Traffic.dest_ip All_Traffic.dest_port All_Traffic.action
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `drop_dm_object_name("All_Traffic")` | `tor_traffic_filter`'
