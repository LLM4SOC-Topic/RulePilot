description: The following analytic detects attempts to exploit the SIGRed vulnerability
  (CVE-2020-1350) in Windows DNS servers. It leverages Splunk Stream DNS and TCP data
  to identify DNS SIG and KEY records, as well as TCP payloads exceeding 65KB. This
  activity is significant because SIGRed is a critical wormable vulnerability that
  allows remote code execution. If confirmed malicious, an attacker could gain unauthorized
  access, execute arbitrary code, and potentially disrupt services, leading to severe
  data breaches and infrastructure compromise. Immediate investigation and remediation
  are crucial to mitigate these risks.
required_fields:
- _time
rule: sourcetype=stream:dns | spath "query_type{}" | search "query_type{}" IN (SIG,KEY)
  | spath protocol_stack | search protocol_stack="ip:tcp:dns" | append [search sourcetype=stream:tcp
  bytes_out>65000] | `detect_windows_dns_sigred_via_splunk_stream_filter` | stats
  count by flow_id | where count>1 | fields - count
