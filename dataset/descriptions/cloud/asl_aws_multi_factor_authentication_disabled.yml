description: The following analytic detects attempts to disable multi-factor authentication
  (MFA) for an AWS IAM user. It leverages Amazon Security Lake logs, specifically
  monitoring for `DeleteVirtualMFADevice` or `DeactivateMFADevice` API operations.
  This activity is significant as disabling MFA can indicate an adversary attempting
  to weaken account security to maintain persistence using a compromised account.
  If confirmed malicious, this action could allow attackers to retain access to the
  AWS environment without detection, potentially leading to unauthorized access to
  sensitive resources and prolonged compromise.
required_fields:
- api.operation
- actor.user.account_uid
- actor.user.name
- actor.user.uid
- http_request.user_agent
- src_endpoint.ip
- cloud.region
rule: sourcetype=aws:cloudtrail:lake (api.operation=DeleteVirtualMFADevice OR api.operation=DeactivateMFADevice)
  | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by api.operation
  actor.user.account_uid actor.user.uid http_request.user_agent src_endpoint.ip cloud.region
  | rename actor.user.uid as user, src_endpoint.ip as src_ip, cloud.region as region,
  http_request.user_agent as user_agent, actor.user.account_uid as aws_account_id
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `asl_aws_multi_factor_authentication_disabled_filter`
