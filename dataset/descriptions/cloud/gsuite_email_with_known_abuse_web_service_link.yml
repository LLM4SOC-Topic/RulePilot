description: The following analytic detects emails in Gsuite containing links to known
  abuse web services such as Pastebin, Telegram, and Discord. It leverages Gsuite
  Gmail logs to identify emails with these specific domains in their links. This activity
  is significant because these services are commonly used by attackers to deliver
  malicious payloads. If confirmed malicious, this could lead to the delivery of malware,
  phishing attacks, or other harmful activities, potentially compromising sensitive
  information or systems within the organization.
required_fields:
- _time
rule: sourcetype=gsuite:gmail:bigquery "link_domain{}" IN ("*pastebin.com*", "*discord*",
  "*telegram*","t.me") | rex field=source.from_header_address "[^@]+@(?<source_domain>[^@]+)"
  | rex field=destination{}.address "[^@]+@(?<dest_domain>[^@]+)" | where not source_domain="internal_test_email.com"
  and dest_domain="internal_test_email.com" | eval phase="plan" | eval severity="low"
  |stats values(link_domain{}) as link_domains min(_time) as firstTime max(_time)
  as lastTime count by is_spam source.address source.from_header_address subject destination{}.address
  phase severity | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `gsuite_email_with_known_abuse_web_service_link_filter`
