description: The following analytic detects the assignment of the 'full_access_as_app'
  permission to an application registration in Office 365 Exchange Online. This detection
  leverages Office 365 management activity logs and filters Azure Active Directory
  workload events to identify when the specific permission, identified by GUID 'dc890d15-9560-4a4c-9b7f-a736ec74ec40',
  is granted. This activity is significant because it provides extensive control over
  Office 365 operations, including access to all mailboxes and the ability to send
  mail as any user. If confirmed malicious, this could lead to unauthorized data access,
  exfiltration, or account compromise. Immediate investigation is required.
required_fields:
- _time
- Workload
- Operation
- ModifiedProperties{}.NewValue
- object
- user
- user_agent
rule: sourcetype=o365:management:activity Workload=AzureActiveDirectory Operation="Update
  application." | eval newvalue = mvindex('ModifiedProperties{}.NewValue',0) | spath
  input=newvalue  | search "{}.ResourceAppId"="00000002-0000-0ff1-ce00-000000000000"  "{}.RequiredAppPermissions{}.EntitlementId"="dc890d15-9560-4a4c-9b7f-a736ec74ec40"
  | eval Permissions = '{}.RequiredAppPermissions{}.EntitlementId' | stats count earliest(_time)
  as firstTime latest(_time) as lastTime values(Permissions) by user, object, user_agent,
  Operation | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `o365_fullaccessasapp_permission_assigned_filter`
