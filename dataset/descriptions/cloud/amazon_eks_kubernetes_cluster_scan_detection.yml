description: The following analytic detects unauthenticated requests to an Amazon
  EKS Kubernetes cluster, specifically identifying actions by the "system:anonymous"
  user. It leverages AWS CloudWatch Logs data, focusing on user agents and authentication
  details. This activity is significant as it may indicate unauthorized scanning or
  probing of the Kubernetes cluster, which could be a precursor to an attack. If confirmed
  malicious, this could lead to unauthorized access, data exfiltration, or disruption
  of services within the Kubernetes environment.
required_fields:
- _time
- user.username
- userAgent
- sourceIPs{}
- responseStatus.reason
- source
- responseStatus.code
- verb
- requestURI
- src_ip
- user.groups{}
rule: sourcetype="aws:cloudwatchlogs:eks" "user.username"="system:anonymous" userAgent!="AWS
  Security Scanner" | rename sourceIPs{} as src_ip | stats count min(_time) as firstTime
  max(_time) as lastTime values(responseStatus.reason) values(source) as cluster_name
  values(responseStatus.code) values(userAgent) as http_user_agent values(verb) values(requestURI)
  by src_ip user.username user.groups{} | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) |`amazon_eks_kubernetes_cluster_scan_detection_filter`
