description: The following analytic detects when emails are accessed in Office 365
  Exchange via Exchange Web Services (EWS) using OAuth-authenticated applications.
  It leverages the ClientInfoString field to identify EWS interactions and aggregates
  metrics such as access counts, timing, and client IP addresses, categorized by user,
  ClientAppId, OperationCount, and AppId. Monitoring OAuth applications accessing
  emails through EWS is crucial for identifying potential abuse or unauthorized data
  access. If confirmed malicious, this activity could lead to unauthorized email access,
  data exfiltration, or further compromise of sensitive information.
required_fields:
- _time
- Workload
- Operation
- AppId
- ClientAppId
- OperationCount
rule: sourcetype=o365:management:activity Workload=Exchange Operation=MailItemsAccessed
  AppId=* ClientAppId=* | regex ClientInfoString="^Client=WebServices;ExchangeWebServices"
  |  stats count earliest(_time) as firstTime latest(_time) as lastTime values(ClientIPAddress)
  as src_ip by user ClientAppId OperationCount AppId ClientInfoString | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `o365_oauth_app_mailbox_access_via_ews_filter`
