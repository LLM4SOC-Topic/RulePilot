description: The following analytic detects the creation of a DaemonSet in a Kubernetes
  cluster. This behavior is identified by monitoring Kubernetes Audit logs for the
  creation event of a DaemonSet. DaemonSets ensure a specific pod runs on every node,
  making them a potential vector for persistent access. This activity is significant
  for a SOC as it could indicate an attempt to maintain persistent access to the Kubernetes
  infrastructure. If confirmed malicious, it could lead to persistent attacks, service
  disruptions, or unauthorized access to sensitive information.
required_fields:
- user.groups{}
- kind
- objectRef.name
- objectRef.namespace
- objectRef.resource
- requestObject.kind
- responseStatus.code
- sourceIPs{}
- stage
- user.username
- userAgent
- verb
rule: source="kubernetes" "objectRef.resource"=daemonsets verb=create | fillnull |
  stats count values(user.groups{}) as user_groups by kind objectRef.name objectRef.namespace
  objectRef.resource requestObject.kind responseStatus.code sourceIPs{} stage user.username
  userAgent verb | rename sourceIPs{} as src_ip, user.username as user | `kubernetes_daemonset_deployed_filter`
