description: The following analytic detects the creation or update of privileged pods
  in Kubernetes. It identifies this activity by monitoring Kubernetes Audit logs for
  pod configurations that include root privileges. This behavior is significant for
  a SOC as it could indicate an attempt to escalate privileges, exploit the kernel,
  and gain full access to the host's namespace and devices. If confirmed malicious,
  this activity could lead to unauthorized access to sensitive information, data breaches,
  and service disruptions, posing a severe threat to the environment.
required_fields:
- user.groups{}
- kind
- objectRef.name
- objectRef.namespace
- objectRef.resource
- requestObject.kind
- requestObject.spec.type
- responseStatus.code
- sourceIPs{}
- stage
- user.username
- userAgent
- verb
- requestObject.metadata.annotations.kubectl.kubernetes.io/last-applied-configuration
rule: source="kubernetes" objectRef.resource=pods verb=create OR verb=update requestObject.metadata.annotations.kubectl.kubernetes.io/last-applied-configuration=*\"privileged\":true*
  | fillnull | stats count values(user.groups{}) as user_groups by kind objectRef.name
  objectRef.namespace objectRef.resource requestObject.kind responseStatus.code sourceIPs{}
  stage user.username userAgent verb requestObject.metadata.annotations.kubectl.kubernetes.io/last-applied-configuration
  | rename sourceIPs{} as src_ip, user.username as user | `kubernetes_create_or_update_privileged_pod_filter`
