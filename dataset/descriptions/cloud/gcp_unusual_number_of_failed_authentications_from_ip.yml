description: The following analytic identifies a single source IP failing to authenticate
  into Google Workspace with multiple valid users, potentially indicating a Password
  Spraying attack. It uses Google Workspace login failure events and calculates the
  standard deviation for source IPs, applying the 3-sigma rule to detect unusual failed
  authentication attempts. This activity is significant as it may signal an adversary
  attempting to gain initial access or elevate privileges. If confirmed malicious,
  this could lead to unauthorized access, data breaches, or further exploitation within
  the environment.
required_fields:
- _time
- event.name
- src
- event.type
- user_name
rule: sourcetype=gws:reports:login event.type = login event.name = login_failure|
  bucket span=5m _time | stats  dc(user_name) AS unique_accounts values(user_name)
  as tried_accounts values(authentication_method) AS authentication_method by _time,
  src | eventstats  avg(unique_accounts) as ip_avg , stdev(unique_accounts) as ip_std
  by _time | eval  upperBound=(ip_avg+ip_std*3) | eval  isOutlier=if(unique_accounts
  > 10 and unique_accounts >= upperBound, 1, 0) | where isOutlier =1| `gcp_unusual_number_of_failed_authentications_from_ip_filter`
