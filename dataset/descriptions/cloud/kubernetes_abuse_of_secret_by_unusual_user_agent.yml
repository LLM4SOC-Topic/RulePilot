description: The following analytic detects unauthorized access or misuse of Kubernetes
  Secrets by unusual user agents. It leverages Kubernetes Audit logs to identify anomalies
  in access patterns by analyzing the source of requests based on user agents. This
  activity is significant for a SOC because Kubernetes Secrets store sensitive information
  like passwords, OAuth tokens, and SSH keys, making them critical assets. If confirmed
  malicious, this activity could lead to unauthorized access to sensitive systems
  or data, potentially resulting in significant security breaches and exfiltration
  of critical information.
required_fields:
- objectRef.resource
- verb
- objectRef.name
- objectRef.namespace
- requestReceivedTimestamp
- requestURI
- responseStatus.code
- sourceIPs{}
- stage
- user.groups{}
- user.uid
- user.username
- userAgent
- verb
rule: source="kubernetes" objectRef.resource=secrets verb=get | search NOT userAgent=Helm/3.13.2
  | fillnull | stats count by objectRef.name objectRef.namespace objectRef.resource
  requestReceivedTimestamp requestURI responseStatus.code sourceIPs{} stage user.groups{}
  user.uid user.username userAgent verb | rename sourceIPs{} as src_ip, user.username
  as user | `kubernetes_abuse_of_secret_by_unusual_user_agent_filter`
