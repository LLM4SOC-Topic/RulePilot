description: The following analytic detects the assignment of privileged Azure Active
  Directory roles to a user. It leverages Azure AD audit logs, specifically monitoring
  the "Add member to role" operation. This activity is significant as adversaries
  may assign privileged roles to compromised accounts to maintain persistence within
  the Azure AD environment. If confirmed malicious, this could allow attackers to
  escalate privileges, access sensitive information, and maintain long-term control
  over the Azure AD infrastructure.
required_fields:
- _time
- user
- properties.targetResources{}.type
- properties.initiatedBy.user.userPrincipalName
- properties.result
rule: sourcetype=azure:monitor:aad  "operationName"="Add member to role" | rename
  properties.*  as * | rename initiatedBy.user.userPrincipalName as initiatedBy |
  rename targetResources{}.modifiedProperties{}.newValue  as roles | eval role=mvindex(roles,1)
  | stats count min(_time) as firstTime max(_time) as lastTime values(user) as user
  by initiatedBy, result, operationName, role | lookup privileged_azure_ad_roles azureadrole
  AS role OUTPUT isprvilegedadrole description | search isprvilegedadrole = True |
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `azure_ad_privileged_role_assigned_filter`
