description: The following analytic detects the deletion of an IAM policy in AWS.
  It leverages AWS CloudTrail logs to identify `DeletePolicy` events, excluding those
  from AWS internal services. This activity is significant as unauthorized policy
  deletions can disrupt access controls and weaken security postures. If confirmed
  malicious, an attacker could remove critical security policies, potentially leading
  to privilege escalation, unauthorized access, or data exfiltration. Monitoring this
  behavior helps ensure that only authorized changes are made to IAM policies, maintaining
  the integrity and security of the AWS environment.
required_fields:
- _time
- eventName
- userAgent
- errorCode
- requestParameters.policyArn
rule: sourcetype=aws:cloudtrail eventName=DeletePolicy (userAgent!=*.amazonaws.com)
  | stats count min(_time) as firstTime max(_time) as lastTime values(requestParameters.policyArn)
  as policyArn by src user_arn eventName eventSource aws_account_id errorCode errorMessage
  userAgent eventID awsRegion userIdentity.principalId | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `aws_iam_delete_policy_filter`
