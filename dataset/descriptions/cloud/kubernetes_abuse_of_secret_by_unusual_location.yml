description: The following analytic detects unauthorized access or misuse of Kubernetes
  Secrets from unusual locations. It leverages Kubernetes Audit logs to identify anomalies
  in access patterns by analyzing the source of requests by country. This activity
  is significant for a SOC as Kubernetes Secrets store sensitive information like
  passwords, OAuth tokens, and SSH keys, making them critical assets. If confirmed
  malicious, this behavior could indicate an attacker attempting to exfiltrate or
  misuse these secrets, potentially leading to unauthorized access to sensitive systems
  or data.
required_fields:
- objectRef.resource
- verb
- objectRef.name
- objectRef.namespace
- requestReceivedTimestamp
- requestURI
- responseStatus.code
- sourceIPs{}
- stage
- user.groups{}
- user.uid
- user.username
- userAgent
- verb
rule: source="kubernetes" objectRef.resource=secrets verb=get | iplocation sourceIPs{}
  | fillnull | search NOT Country="United States" | stats count by objectRef.name
  objectRef.namespace objectRef.resource requestReceivedTimestamp requestURI responseStatus.code
  sourceIPs{} stage user.groups{} user.uid user.username userAgent verb City Country
  | rename sourceIPs{} as src_ip, user.username as user | `kubernetes_abuse_of_secret_by_unusual_location_filter`
