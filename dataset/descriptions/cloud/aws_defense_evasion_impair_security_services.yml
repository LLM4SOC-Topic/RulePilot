description: The following analytic detects attempts to delete critical AWS security
  service configurations, such as CloudWatch alarms, GuardDuty detectors, and Web
  Application Firewall rules. It leverages CloudTrail logs to identify specific API
  calls like "DeleteLogStream" and "DeleteDetector." This activity is significant
  because it indicates potential efforts to disable security monitoring and evade
  detection. If confirmed malicious, this could allow attackers to operate undetected,
  escalate privileges, or exfiltrate data without triggering security alerts, severely
  compromising the security posture of the AWS environment.
required_fields:
- _time
- eventName
- eventSource
- user_agent
- user_type
- aws_account_id
- src
- region
- errorCode
rule: sourcetype=aws:cloudtrail eventName IN ("DeleteLogStream","DeleteDetector","DeleteIPSet","DeleteWebACL","DeleteRule","DeleteRuleGroup","DeleteLoggingConfiguration","DeleteAlarms")
  | stats count min(_time) as firstTime max(_time) as lastTime values(eventName)  as
  eventName values(eventSource) as eventSource values(requestParameters.*) as * by
  src region user_arn aws_account_id user_type user_agent errorCode| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)|  `aws_defense_evasion_impair_security_services_filter`
