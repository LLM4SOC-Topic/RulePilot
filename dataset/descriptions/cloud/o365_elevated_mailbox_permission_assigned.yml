description: The following analytic identifies the assignment of elevated mailbox
  permissions in an Office 365 environment via the Add-MailboxPermission operation.
  It leverages logs from the Exchange workload in the o365_management_activity data
  source, focusing on permissions such as FullAccess, ChangePermission, or ChangeOwner.
  This activity is significant as it indicates potential unauthorized access or control
  over mailboxes, which could lead to data exfiltration or privilege escalation. If
  confirmed malicious, attackers could gain extensive access to sensitive email data
  and potentially manipulate mailbox settings, posing a severe security risk.
required_fields:
- _time
- Workload
- Operation
- AccessRights
- user
- src_user
- dest_user
rule: sourcetype=o365:management:activity Workload=Exchange Operation=Add-MailboxPermission
  | search (AccessRights=FullAccess OR AccessRights=ChangePermission OR AccessRights=ChangeOwner)
  | rename Identity AS dest_user | stats count earliest(_time) as firstTime latest(_time)
  as lastTime by user dest_user Operation AccessRights |convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) |convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `o365_elevated_mailbox_permission_assigned_filter`
