description: The following analytic detects `UpdateTrail` events in AWS CloudTrail
  logs. It identifies attempts to modify CloudTrail settings, potentially to evade
  logging. The detection leverages CloudTrail logs, focusing on `UpdateTrail` events
  where the user agent is not the AWS console and the operation is successful. This
  activity is significant because altering CloudTrail settings can disable or limit
  logging, hindering visibility into AWS account activities. If confirmed malicious,
  this could allow attackers to operate undetected, compromising the integrity and
  security of the AWS environment.
required_fields:
- _time
- eventName
- eventSource
- requestParameters.name
- userAgent
- aws_account_id
- src
- region
rule: sourcetype=aws:cloudtrail eventName = UpdateTrail eventSource = cloudtrail.amazonaws.com
  userAgent !=console.amazonaws.com errorCode = success| stats count min(_time) as
  firstTime max(_time) as lastTime values(requestParameters.name) as cloudtrail_name
  by src region eventName userAgent user_arn aws_account_id | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `aws_defense_evasion_update_cloudtrail_filter`
