description: The following analytic detects when the Microsoft Zero-hour Automatic
  Purge (ZAP) capability takes action against a user's mailbox. This capability is
  an enhanced protection feature that retro-actively removes email with known malicious
  content for user inboxes. Since this is a retroactive capability, there is still
  a window in which the user may fall victim to the malicious content.
required_fields:
- _time
- Workload
- Operation
- Name
- Data
- AlertId
rule: sourcetype=o365:management:activity Workload=SecurityComplianceCenter Operation=AlertEntityGenerated
  Name="*messages containing malicious*" | fromjson Data | stats count min(_time)
  as firstTime max(_time) as lastTime values(zu) as url values(zfn) as file_name values(ms)
  as subject values(ttr) as result values(tsd) as src_user by AlertId,trc,Operation,Name
  | rename Name as signature, AlertId as signature_id, trc as user | eval action =
  CASE(match(result,"Success"), "blocked", true(),"allowed"), url = split(url,";")
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `o365_zap_activity_detection_filter`
