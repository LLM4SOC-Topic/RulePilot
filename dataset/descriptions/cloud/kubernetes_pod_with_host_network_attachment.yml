description: The following analytic detects the creation or update of a Kubernetes
  pod with host network attachment. It leverages Kubernetes Audit logs to identify
  pods configured with host network settings. This activity is significant for a SOC
  as it could allow an attacker to monitor all network traffic on the node, potentially
  capturing sensitive information and escalating privileges. If confirmed malicious,
  this could lead to unauthorized access, data breaches, and service disruptions,
  severely impacting the security and integrity of the Kubernetes environment.
required_fields:
- user.groups{}
- kind
- objectRef.name
- objectRef.namespace
- objectRef.resource
- requestObject.kind
- requestObject.spec.type
- responseStatus.code
- sourceIPs{}
- stage
- user.username
- userAgent
- verb
- requestObject.metadata.annotations.kubectl.kubernetes.io/last-applied-configuration
rule: source="kubernetes" objectRef.resource=pods verb=create OR verb=update requestObject.metadata.annotations.kubectl.kubernetes.io/last-applied-configuration=*\"hostNetwork\":true*
  | fillnull | stats count values(user.groups{}) as user_groups by kind objectRef.name
  objectRef.namespace objectRef.resource requestObject.kind responseStatus.code sourceIPs{}
  stage user.username userAgent verb requestObject.metadata.annotations.kubectl.kubernetes.io/last-applied-configuration
  | rename sourceIPs{} as src_ip, user.username as user | `kubernetes_pod_with_host_network_attachment_filter`
