description: The following analytic detects the invitation of an external guest user
  within Azure AD. It leverages Azure AD AuditLogs to identify events where an external
  user is invited, using fields such as operationName and initiatedBy. Monitoring
  these invitations is crucial as they can lead to unauthorized access if abused.
  If confirmed malicious, this activity could allow attackers to gain access to internal
  resources, potentially leading to data breaches or further exploitation of the environment.
required_fields:
- _time
- user
- properties.targetResources{}.type
- properties.initiatedBy.user.userPrincipalName
- properties.result
rule: sourcetype=azure:monitor:aad operationName="Invite external user" | rename properties.*  as
  * | rename initiatedBy.user.userPrincipalName as initiatedBy | rename targetResources{}.type
  as type | stats count min(_time) as firstTime max(_time) as lastTime values(user)
  as user by type, initiatedBy, result, operationName | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `azure_ad_external_guest_user_invited_filter`
