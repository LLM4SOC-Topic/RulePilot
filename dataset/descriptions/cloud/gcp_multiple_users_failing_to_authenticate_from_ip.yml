description: The following analytic detects a single source IP address failing to
  authenticate into more than 20 unique Google Workspace user accounts within a 5-minute
  window. It leverages Google Workspace login failure events to identify potential
  password spraying attacks. This activity is significant as it may indicate an adversary
  attempting to gain unauthorized access or elevate privileges within the Google Cloud
  Platform. If confirmed malicious, this behavior could lead to unauthorized access
  to sensitive resources, data breaches, or further exploitation within the environment.
required_fields:
- _time
- event.name
- event.type
- authentication_method
- app
- id.applicationName
- src
rule: sourcetype=gws:reports:login event.type = login event.name = login_failure |
  bucket span=5m _time | stats count dc(user) AS unique_accounts values(user) as tried_accounts
  values(authentication_method) AS authentication_method earliest(_time) as firstTime
  latest(_time) as lastTime by _time event.name src app id.applicationName | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) |  where unique_accounts > 20 | `gcp_multiple_users_failing_to_authenticate_from_ip_filter`
