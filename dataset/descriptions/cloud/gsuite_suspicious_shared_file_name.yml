description: The following analytic detects shared files in Google Drive with suspicious
  filenames commonly used in spear phishing campaigns. It leverages GSuite Drive logs
  to identify documents with titles that include keywords like "dhl," "ups," "invoice,"
  and "shipment." This activity is significant because such filenames are often used
  to lure users into opening malicious documents or clicking harmful links. If confirmed
  malicious, this activity could lead to unauthorized access, data theft, or further
  compromise of the user's system.
required_fields:
- _time
- parameters.doc_title
- src_domain
- dest_domain
- email
- parameters.visibility
- parameters.owner
- parameters.doc_type
rule: sourcetype=gsuite:drive:json parameters.owner_is_team_drive=false "parameters.doc_title"
  IN ("*dhl*", "* ups *", "*delivery*", "*parcel*", "*label*", "*invoice*", "*postal*",
  "*fedex*", "* usps *", "* express *", "*shipment*", "*Banking/Tax*","*shipment*",
  "*new order*") parameters.doc_type IN ("document","pdf", "msexcel", "msword", "spreadsheet",
  "presentation") | rex field=parameters.owner "[^@]+@(?<source_domain>[^@]+)" | rex
  field=parameters.target_user "[^@]+@(?<dest_domain>[^@]+)" | where not source_domain="internal_test_email.com"
  and dest_domain="internal_test_email.com" | eval phase="plan" | eval severity="low"
  | stats count min(_time) as firstTime max(_time) as lastTime by email parameters.owner
  parameters.target_user parameters.doc_title parameters.doc_type phase severity |
  rename parameters.target_user AS user | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `gsuite_suspicious_shared_file_name_filter`
