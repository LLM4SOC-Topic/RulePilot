description: The following analytic identifies failed user authentication attempts
  in Okta due to FastPass declining a phishing attempt. It leverages Okta logs, specifically
  looking for events where multi-factor authentication (MFA) fails with the reason
  "FastPass declined phishing attempt." This activity is significant as it indicates
  that attackers are targeting users with real-time phishing proxies, attempting to
  capture credentials. If confirmed malicious, this could lead to unauthorized access
  to user accounts, potentially compromising sensitive information and furthering
  lateral movement within the organization.
required_fields:
- _time
- eventType
- client.userAgent.rawUserAgent
- client.userAgent.browser
- outcome.reason
- displayMessage
rule: eventtype=okta_log OR sourcetype = "OktaIM2:log" eventType="user.authentication.auth_via_mfa"
  AND result="FAILURE" AND outcome.reason="FastPass declined phishing attempt" | stats
  count min(_time) as firstTime max(_time) as lastTime values(displayMessage) by user
  eventType client.userAgent.rawUserAgent client.userAgent.browser outcome.reason
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `okta_phishing_detection_with_fastpass_origin_check_filter`
