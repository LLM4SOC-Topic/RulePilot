description: The following analytic identifies when a new device is enrolled on an
  Okta account. It uses OktaIm2 logs ingested via the Splunk Add-on for Okta Identity
  Cloud to detect the creation of new device enrollments. This activity is significant
  as it may indicate a legitimate user setting up a new device or an adversary adding
  a device to maintain unauthorized access. If confirmed malicious, this could lead
  to potential account takeover, unauthorized access, and persistent control over
  the compromised Okta account. Monitoring this behavior is crucial for detecting
  and mitigating unauthorized access attempts.
required_fields:
- _time
- displayMessage
- user
- eventType
- client.userAgent.rawUserAgent
- client.userAgent.browser
- client.geographicalContext.city
- client.geographicalContext.country
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count max(_time) as lastTime, min(_time) as firstTime
  from datamodel=Change where All_Changes.action=created All_Changes.command=device.enrollment.create
  by _time span=5m All_Changes.user All_Changes.result All_Changes.command sourcetype
  All_Changes.src All_Changes.action All_Changes.object_category | `drop_dm_object_name("All_Changes")`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `okta_new_device_enrolled_on_account_filter`'
