description: The following analytic identifies threats detected by Okta ThreatInsight,
  such as password spraying, login failures, and high counts of unknown user login
  attempts. It leverages Okta Identity Management logs, specifically focusing on security.threat.detected
  events. This activity is significant for a SOC as it highlights potential unauthorized
  access attempts and credential-based attacks. If confirmed malicious, these activities
  could lead to unauthorized access, data breaches, and further exploitation of compromised
  accounts, posing a significant risk to the organization's security posture.
required_fields:
- _time
- signature
- eventType
- displayMessage
- client.device
- city
- state
- country
- user_agent
- outcome.reason
- outcome.result
- severity
rule: eventtype=okta_log OR sourcetype = "OktaIM2:log" eventType = security.threat.detected
  | rename client.geographicalContext.country as country, client.geographicalContext.state
  as state, client.geographicalContext.city as city | stats count min(_time) as firstTime
  max(_time) as lastTime by app src_ip signature eventType displayMessage client.device
  city state country user_agent outcome.reason outcome.result severity | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `okta_threatinsight_threat_detected_filter`
