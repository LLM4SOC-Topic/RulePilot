description: This search looks for AWS provisioning activities from previously unseen
  countries. Provisioning activities are defined broadly as any event that begins
  with "Run" or "Create." This search is deprecated and have been translated to use
  the latest Change Datamodel.
required_fields:
- _time
- eventName
- sourceIPAddress
rule: sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation
  sourceIPAddress | search Country=* [search sourcetype=aws:cloudtrail (eventName=Run*
  OR eventName=Create*) | iplocation sourceIPAddress | search Country=* | stats earliest(_time)
  as firstTime, latest(_time) as lastTime by sourceIPAddress, City, Region, Country
  | inputlookup append=t previously_seen_provisioning_activity_src.csv | stats min(firstTime)
  as firstTime max(lastTime) as lastTime by sourceIPAddress, City, Region, Country
  | outputlookup previously_seen_provisioning_activity_src.csv | stats min(firstTime)
  as firstTime max(lastTime) as lastTime by Country | eval newCountry=if(firstTime
  >= relative_time(now(), "-70m@m"), 1, 0) | where newCountry=1 | table Country] |
  spath output=user userIdentity.arn | rename sourceIPAddress as src_ip | table _time,
  user, src_ip, Country, eventName, errorCode | `aws_cloud_provisioning_from_previously_unseen_country_filter`
