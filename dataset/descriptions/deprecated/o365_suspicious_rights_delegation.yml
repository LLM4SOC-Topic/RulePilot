description: '**DEPRECATION NOTE** - This search has been deprecated and replaced
  with `O365 Elevated Mailbox Permission Assigned`. This analytic identifies instances
  where potentially suspicious rights are delegated within the Office 365 environment.
  Specifically, it detects when a user is granted FullAccess, SendAs, or SendOnBehalf
  permissions on another users mailbox. Such permissions can allow a user to access,
  send emails from, or send emails on behalf of the target mailbox. The detection
  leverages O365 audit logs, focusing on the Add-MailboxPermission operation. By parsing
  the parameters of this operation, the analytic filters for events where FullAccess,
  SendAs, or SendOnBehalf rights are granted. It then aggregates this data to capture
  the source user (who was granted the permissions), the destination user (whose mailbox
  was affected), the specific operation, and the type of access rights granted. Delegating
  mailbox rights, especially those as powerful as FullAccess, can pose significant
  security risks. While there are legitimate scenarios for these permissions, such
  as an executive assistant needing access to an executives mailbox, there are also
  malicious scenarios where an attacker or a compromised insider might grant themselves
  unauthorized access to sensitive mailboxes. Monitoring for these permissions changes
  is crucial to detect potential insider threats, compromised accounts, or other malicious
  activities.If the detection is a true positive, it indicates that a user has been
  granted potentially high-risk permissions on another users mailbox. This could lead
  to unauthorized access to sensitive emails, impersonation through sending emails
  as or on behalf of the mailbox owner, or data manipulation by altering or deleting
  emails. Immediate investigation is required to validate the legitimacy of the permission
  change and to assess the potential risks associated with the granted access.'
required_fields:
- _time
- Operation
- Parameters
rule: sourcetype=o365:management:activity Operation=Add-MailboxPermission | spath
  input=Parameters | rename User AS src_user, Identity AS dest_user | search AccessRights=FullAccess
  OR AccessRights=SendAs OR AccessRights=SendOnBehalf | stats count earliest(_time)
  as firstTime latest(_time) as lastTime by user src_user dest_user Operation AccessRights
  |convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) |convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) |`o365_suspicious_rights_delegation_filter`
