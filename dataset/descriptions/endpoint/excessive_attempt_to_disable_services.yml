description: The following analytic identifies a suspicious series of command-line
  executions attempting to disable multiple services. It leverages data from Endpoint
  Detection and Response (EDR) agents, focusing on processes where "sc.exe" is used
  with parameters like "config" or "Disabled" within a short time frame. This activity
  is significant as it may indicate an adversary's attempt to disable security or
  other critical services to further compromise the system. If confirmed malicious,
  this could lead to the attacker achieving persistence, evading detection, or disabling
  security mechanisms, thereby increasing the risk of further exploitation.
required_fields:
- _time
- Processes.process
- Processes.process_id
- Processes.process_name
- Processes.parent_process_name
- Processes.dest
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` values(Processes.process) as process values(Processes.process_id)
  as process_id count min(_time) as firstTime max(_time) as lastTime  from datamodel=Endpoint.Processes
  where   Processes.process_name = "sc.exe" AND Processes.process="*config*" OR Processes.process="*Disabled*"
  by Processes.process_name Processes.parent_process_name Processes.dest Processes.user
  _time span=1m | where count >=4 | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `excessive_attempt_to_disable_services_filter`'
