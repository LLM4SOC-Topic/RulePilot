description: The following analytic identifies processes running from file paths not
  typically associated with legitimate software. It leverages data from Endpoint Detection
  and Response (EDR) agents, focusing on specific process paths within the Endpoint
  data model. This activity is significant because adversaries often use unconventional
  file paths to execute malicious code without requiring administrative privileges.
  If confirmed malicious, this behavior could indicate an attempt to bypass security
  controls, leading to unauthorized software execution, potential system compromise,
  and further malicious activities within the environment.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.parent_process_name
- Processes.parent_process
- Processes.process_path
- Processes.dest
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Processes.process_name) as process_name
  values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_path = "*\\windows\\fonts\\*"
  OR Processes.process_path = "*\\windows\\temp\\*" OR Processes.process_path = "*\\users\\public\\*"
  OR Processes.process_path = "*\\windows\\debug\\*" OR Processes.process_path = "*\\Users\\Administrator\\Music\\*"
  OR Processes.process_path = "*\\Windows\\servicing\\*" OR Processes.process_path
  = "*\\Users\\Default\\*" OR Processes.process_path = "*Recycle.bin*" OR Processes.process_path
  = "*\\Windows\\Media\\*" OR Processes.process_path = "\\Windows\\repair\\*" OR Processes.process_path
  = "*\\temp\\*" OR Processes.process_path = "*\\PerfLogs\\*" by Processes.parent_process_name
  Processes.parent_process Processes.process_path Processes.dest Processes.user |
  `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `suspicious_process_file_path_filter`'
