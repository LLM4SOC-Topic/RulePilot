description: The following analytic detects the creation or enabling of services on
  Linux platforms using the systemctl or service tools. It leverages Endpoint Detection
  and Response (EDR) logs, focusing on process names, parent processes, and command-line
  executions. This activity is significant as adversaries may create or modify services
  to maintain persistence or execute malicious payloads. If confirmed malicious, this
  behavior could lead to persistent access, data theft, ransomware deployment, or
  other damaging outcomes. Monitoring and investigating such activities are crucial
  for maintaining the security and integrity of the environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name IN ("systemctl",
  "service") OR Processes.process IN ("*systemctl *", "*service *")) Processes.process
  IN ("* start *", "* enable *") AND NOT (Processes.os="Microsoft Windows" OR Processes.vendor_product="Microsoft
  Windows") by Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id Processes.process_guid
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `linux_service_started_or_enabled_filter`'
