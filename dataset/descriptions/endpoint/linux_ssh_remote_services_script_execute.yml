description: The following analytic detects the use of SSH to move laterally and execute
  a script or file on a remote host. It leverages data from Endpoint Detection and
  Response (EDR) agents, focusing on specific SSH command-line parameters and URLs.
  This activity is significant as it may indicate an attacker attempting to execute
  remote commands or scripts, potentially leading to unauthorized access or control
  over additional systems. If confirmed malicious, this could result in lateral movement,
  privilege escalation, or the execution of malicious payloads, compromising the security
  of the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where  Processes.process_name=ssh Processes.process
  IN ("*oStrictHostKeyChecking*", "*oConnectTimeout*", "*oBatchMode*") AND Processes.process
  IN ("*http:*","*https:*") by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `linux_ssh_remote_services_script_execute_filter`'
