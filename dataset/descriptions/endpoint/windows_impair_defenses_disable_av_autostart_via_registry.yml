description: The following analytic detects modifications to the registry related
  to the disabling of autostart functionality for certain antivirus products, such
  as Kingsoft and Tencent. Malware like ValleyRAT may alter specific registry keys
  to prevent these security tools from launching automatically at startup, thereby
  weakening system defenses. By monitoring changes in the registry entries associated
  with antivirus autostart settings, this detection enables security analysts to identify
  attempts to disable protective software. Detecting these modifications early is
  critical for maintaining system integrity and preventing further compromise by malicious
  actors.
required_fields:
- Registry.dest
- Registry.registry_value_name
- Registry.registry_key_name
- Registry.registry_path
- Registry.registry_value_data
- Registry.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count FROM datamodel=Endpoint.Registry WHERE Registry.registry_path
  IN("*\\kingsoft\\antivirus\\KAVReport\\*" , "*\\kingsoft\\antivirus\\KSetting\\*",
  "*\\kingsoft\\antivirus\\Windhunter\\*" ,"*\\Tencent\\QQPCMgr\\*") AND ((Registry.registry_value_name
  IN("autostart","kxesc", "WindhunterSwitch") AND Registry.registry_value_data = "0x00000000")
  OR (Registry.registry_value_name = "WindhunterLevel" AND Registry.registry_value_data
  = "0x00000004")) BY Registry.dest Registry.user Registry.registry_path Registry.registry_key_name
  Registry.registry_value_name Registry.registry_value_data Registry.registry_hive
  Registry.process_guid | `drop_dm_object_name(Registry)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_impair_defenses_disable_av_autostart_via_registry_filter`'
