description: The following analytic detects the use of the copy command to dump credentials
  from a shadow copy. It leverages Endpoint Detection and Response (EDR) data to identify
  processes with command lines referencing critical files like "sam", "security",
  "system", and "ntds.dit" in system directories. This activity is significant as
  it indicates an attempt to extract credentials, a common technique for unauthorized
  access and privilege escalation. If confirmed malicious, this could lead to attackers
  gaining sensitive login information, escalating privileges, moving laterally within
  the network, or accessing sensitive data.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=cmd.exe OR Processes.original_file_name=Cmd.Exe)
  (Processes.process=*\\system32\\config\\sam* OR Processes.process=*\\system32\\config\\security*
  OR Processes.process=*\\system32\\config\\system* OR Processes.process=*\\windows\\ntds\\ntds.dit*)
  by Processes.dest Processes.user Processes.process_name Processes.process  Processes.parent_process
  Processes.original_file_name Processes.process_id Processes.parent_process_id  Processes.parent_process_name
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)|
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `credential_dumping_via_copy_command_from_shadow_copy_filter`'
