description: The following analytic detects the execution of a kworker process with
  a command line in writable directories such as /home/, /var/log, and /tmp on a Linux
  machine. It leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on process and parent process paths. This activity is significant as kworker processes
  are typically kernel threads, and their presence in writable directories is unusual
  and indicative of potential malware, such as CyclopsBlink. If confirmed malicious,
  this could allow attackers to blend malicious processes with legitimate ones, leading
  to persistent access and further system compromise.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
- Processes.parent_process_path
- Processes.process_path
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where  Processes.parent_process = "*[kworker/*"
  Processes.parent_process_path IN ("/home/*", "/tmp/*", "/var/log/*") Processes.process="*iptables*"
  by  Processes.parent_process_name Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id Processes.parent_process_path
  Processes.process_guid Processes.dest Processes.user | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `linux_kworker_process_in_writable_process_path_filter`'
