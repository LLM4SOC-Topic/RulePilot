description: The following analytic detects the deletion of the Windows Defender main
  profile registry key. It leverages data from the Endpoint.Registry datamodel, specifically
  monitoring for deleted actions within the Windows Defender registry path. This activity
  is significant as it indicates potential tampering with security defenses, often
  associated with Remote Access Trojans (RATs) and other malware. If confirmed malicious,
  this action could allow an attacker to disable Windows Defender, reducing the system's
  ability to detect and respond to further malicious activities, thereby compromising
  endpoint security.
required_fields:
- _time
- Registry.registry_key_name
- Registry.registry_value_name
- Registry.dest
- Registry.user
- Registry.registry_path
- Registry.action
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Registry where Registry.registry_path = "*\\Policies\\Microsoft\\Windows
  Defender" Registry.action = deleted by  Registry.registry_path Registry.registry_value_name
  Registry.registry_value_data Registry.process_guid Registry.action  Registry.user
  Registry.dest | `drop_dm_object_name(Registry)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_impair_defense_delete_win_defender_profile_registry_filter`'
