description: The following analytic detects the execution of PowerShell scripts containing
  Base64 encoded content, specifically identifying the use of `FromBase64String`.
  It leverages PowerShell Script Block Logging (EventCode=4104) to capture and analyze
  the full command sent to PowerShell. This activity is significant as Base64 encoding
  is often used by attackers to obfuscate malicious payloads, making it harder to
  detect. If confirmed malicious, this could lead to code execution, allowing attackers
  to run arbitrary commands and potentially compromise the system.
required_fields:
- _time
- ScriptBlockText
- Opcode
- Computer
- UserID
- EventCode
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*frombase64string*" OR ScriptBlockText = "*gnirtS46esaBmorF*"
  | stats count min(_time) as firstTime max(_time) as lastTime by EventCode ScriptBlockText
  Computer UserID | rename Computer as dest |rename UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `powershell_fileless_script_contains_base64_encoded_content_filter`
