description: The following analytic identifies instances where wmiprvse.exe spawns
  msbuild.exe, which is unusual and indicative of potential misuse of a COM object.
  This detection leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on process relationships and command-line executions. This activity is
  significant because msbuild.exe is typically spawned by devenv.exe during legitimate
  Visual Studio use, not by wmiprvse.exe. If confirmed malicious, this behavior could
  indicate an attacker executing arbitrary code or scripts, potentially leading to
  system compromise or further malicious activities.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Processes.process_name) as process_name
  values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name=wmiprvse.exe
  AND (Processes.process_name=msbuild.exe OR Processes.original_file_name=MSBuild.exe)
  by Processes.dest Processes.parent_process Processes.original_file_name Processes.user
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `suspicious_msbuild_spawn_filter`'
