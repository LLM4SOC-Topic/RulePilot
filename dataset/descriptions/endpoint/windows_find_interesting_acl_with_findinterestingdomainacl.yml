description: The following analytic detects the execution of the `Find-InterestingDomainAcl`
  cmdlet, part of the PowerView toolkit, using PowerShell Script Block Logging (EventCode=4104).
  This detection leverages logs to identify when this command is run, which is significant
  as adversaries may use it to find misconfigured or unusual Access Control Lists
  (ACLs) within a domain. If confirmed malicious, this activity could allow attackers
  to identify privilege escalation opportunities or weak security configurations in
  Active Directory, potentially leading to unauthorized access or further exploitation.
required_fields:
- _time
- EventCode
- Message
- Computer
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*Find-InterestingDomainAcl*" | stats count min(_time)
  as firstTime max(_time) as lastTime by EventCode ScriptBlockText Computer UserID
  | rename Computer as dest, UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_find_interesting_acl_with_findinterestingdomainacl_filter`
