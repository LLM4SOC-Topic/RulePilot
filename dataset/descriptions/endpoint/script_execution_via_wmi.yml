description: The following analytic detects the execution of scripts via Windows Management
  Instrumentation (WMI) by monitoring the process 'scrcons.exe'. This detection leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process creation
  events. WMI-based script execution is significant because adversaries often use
  it to perform malicious activities stealthily, such as system compromise, data exfiltration,
  or establishing persistence. If confirmed malicious, this activity could allow attackers
  to execute arbitrary code, escalate privileges, or maintain long-term access to
  the environment. Analysts should differentiate between legitimate administrative
  use and potential threats.
required_fields:
- _time
- Processes.process_name
- Processes.user
- Processes.dest
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=scrcons.exe by Processes.dest
  Processes.user Processes.parent_process Processes.process_name Processes.process
  Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `script_execution_via_wmi_filter`'
