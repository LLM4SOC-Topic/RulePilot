description: The following analytic detects a single source endpoint failing to authenticate
  with 30 unique invalid users using the NTLM protocol. It leverages EventCode 4776
  from Domain Controller logs, focusing on error code 0xC0000064, which indicates
  non-existent usernames. This behavior is significant as it may indicate a Password
  Spraying attack, where an adversary attempts to gain initial access or elevate privileges.
  If confirmed malicious, this activity could lead to unauthorized access, privilege
  escalation, and potential compromise of sensitive information within the Active
  Directory environment.
required_fields:
- _time
- EventCode
- TargetUserName
- Workstation
- Status
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=4776 TargetUserName!=*$ Status=0xc0000064 | bucket span=5m _time | stats
  dc(TargetUserName) AS unique_accounts values(TargetUserName) as tried_accounts by
  _time, Workstation | where unique_accounts > 30 | `windows_multiple_invalid_users_failed_to_authenticate_using_ntlm_filter`
