description: The following analytic detects the creation of a Windows Service with
  its binary path located in public directories using Windows Event ID 7045. This
  detection leverages logs from the `wineventlog_system` data source, focusing on
  the `ImagePath` field to identify services installed outside standard system directories.
  This activity is significant as it may indicate the installation of a malicious
  service, often used by adversaries for lateral movement or remote code execution.
  If confirmed malicious, this could allow attackers to execute arbitrary code, maintain
  persistence, or further compromise the system.
required_fields:
- EventCode
- Service_File_Name
- Service_Type
- _time
- Service_Name
- Service_Start_Type
rule: eventtype=wineventlog_system EventCode=7045 ImagePath = "*.exe" NOT (ImagePath
  IN ("*:\\Windows\\*", "*:\\Program File*", "*:\\Programdata\\*", "*%systemroot%\\*"))
  | stats count min(_time) as firstTime max(_time) as lastTime by EventCode ImagePath
  ServiceName ServiceType StartType Computer UserID | rename Computer as dest | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_service_created_within_public_path_filter`
