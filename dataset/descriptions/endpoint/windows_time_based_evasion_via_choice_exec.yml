description: The following analytic detects the use of choice.exe in batch files as
  a delay tactic, a technique observed in SnakeKeylogger malware. It leverages data
  from Endpoint Detection and Response (EDR) agents, focusing on process names and
  command-line executions. This activity is significant as it indicates potential
  time-based evasion techniques used by malware to avoid detection. If confirmed malicious,
  this behavior could allow attackers to execute code stealthily, delete malicious
  files, and persist on compromised hosts, making it crucial for SOC analysts to investigate
  promptly.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name =choice.exe  Processes.process
  = "*/T*"  Processes.process = "*/N*" by Processes.parent_process_name Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id Processes.process_guid
  Processes.dest Processes.user | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_time_based_evasion_via_choice_exec_filter`'
