description: The following analytic detects the use of the Advanced Package Tool (APT)
  with elevated privileges via sudo on Linux systems. It leverages Endpoint Detection
  and Response (EDR) telemetry to identify processes where APT commands are executed
  with sudo rights. This activity is significant because it indicates a user can run
  system commands as root, potentially leading to unauthorized root shell access.
  If confirmed malicious, this could allow an attacker to escalate privileges, execute
  arbitrary commands, and gain full control over the affected system, posing a severe
  security risk.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process="*apt*" AND Processes.process="*APT::Update::Pre-Invoke::*"
  AND Processes.process="*sudo*" by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  Processes.process_guid | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `linux_apt_privilege_escalation_filter`'
