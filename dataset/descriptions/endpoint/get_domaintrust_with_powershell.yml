description: The following analytic identifies the execution of the Get-DomainTrust
  command from PowerView using PowerShell, which is used to gather domain trust information.
  This detection leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on process and command-line telemetry. This activity is significant as
  it indicates potential reconnaissance efforts by an adversary to understand domain
  trust relationships, which can inform lateral movement strategies. If confirmed
  malicious, this could allow attackers to map out the network, identify potential
  targets, and plan further attacks, potentially compromising additional systems within
  the domain.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process=*get-domaintrust* by Processes.dest
  Processes.user Processes.parent_process_name Processes.process_name Processes.process
  Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `get_domaintrust_with_powershell_filter`'
