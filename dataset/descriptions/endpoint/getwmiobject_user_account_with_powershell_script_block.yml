description: The following analytic detects the execution of the `Get-WmiObject` commandlet
  with the `Win32_UserAccount` parameter via PowerShell Script Block Logging (EventCode=4104).
  This method leverages script block text to identify when a list of all local users
  is being enumerated. This activity is significant as it may indicate an adversary
  or Red Team operation attempting to gather user information for situational awareness
  and Active Directory discovery. If confirmed malicious, this could lead to further
  reconnaissance, privilege escalation, or lateral movement within the network.
required_fields:
- _time
- EventCode
- ScriptBlockText
- Computer
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 (ScriptBlockText="*Get-WmiObject*" AND ScriptBlockText="*Win32_UserAccount*")
  | stats count min(_time) as firstTime max(_time) as lastTime by EventCode ScriptBlockText
  Computer UserID | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `getwmiobject_user_account_with_powershell_script_block_filter`
