description: The following analytic detects the use of the `[Adsisearcher]` type accelerator
  in PowerShell scripts to query Active Directory for domain computers. It leverages
  PowerShell Script Block Logging (EventCode=4104) to identify specific script blocks
  containing `adsisearcher` and `objectcategory=computer` with methods like `findAll()`
  or `findOne()`. This activity is significant as it may indicate an attempt by adversaries
  or Red Teams to perform Active Directory discovery and gain situational awareness.
  If confirmed malicious, this could lead to further reconnaissance and potential
  lateral movement within the network.
required_fields:
- _time
- EventCode
- ScriptBlockText
- Computer
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*adsisearcher*" AND ScriptBlockText = "*objectcategory=computer*"
  AND ScriptBlockText IN ("*findAll()*","*findOne()*") | stats count min(_time) as
  firstTime max(_time) as lastTime by EventCode ScriptBlockText Computer UserID |
  rename Computer as dest |rename UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `remote_system_discovery_with_adsisearcher_filter`
