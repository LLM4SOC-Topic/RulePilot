description: The following analytic identifies processes that retrieve information
  related to private key files, often used by post-exploitation tools like winpeas.
  This detection leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on command-line executions that search for private key certificates. This
  activity is significant as it indicates potential attempts to locate insecurely
  stored credentials, which adversaries can exploit for privilege escalation, persistence,
  or remote service authentication. If confirmed malicious, this behavior could allow
  attackers to access sensitive information, escalate privileges, or maintain persistence
  within the compromised environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.parent_process_guid
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process = "*dir *" OR  Processes.process
  = "*findstr*" AND Processes.process IN ( "*.rdg*", "*.gpg*", "*.pgp*", "*.p12*",
  "*.der*", "*.csr*", "*.cer*", "*.ovpn*", "*.key*",  "*.ppk*", "*.p12*", "*.pem*",
  "*.pfx*", "*.p7b*", "*.asc*") by Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.process_guid Processes.parent_process_name
  Processes.parent_process Processes.parent_process_guid Processes.dest Processes.user
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_private_keys_discovery_filter`'
