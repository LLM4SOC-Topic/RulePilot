description: The following analytic detects the creation of scheduled tasks on remote
  Windows endpoints using the at.exe command. This detection leverages Endpoint Detection
  and Response (EDR) telemetry, focusing on process creation events involving at.exe
  with remote command-line arguments. Identifying this activity is significant for
  a SOC as it may indicate lateral movement or remote code execution attempts by an
  attacker. If confirmed malicious, this activity could lead to unauthorized access,
  persistence, or execution of malicious code, potentially resulting in data theft
  or further compromise of the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=at.exe OR Processes.original_file_name=at.exe)
  (Processes.process=*\\\\*) by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)|
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `scheduled_task_creation_on_remote_endpoint_using_at_filter`'
