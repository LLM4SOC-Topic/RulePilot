description: The following analytic identifies child processes spawned by spoolsv.exe,
  the Print Spooler service in Windows, which typically runs with SYSTEM privileges.
  This detection leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on process and parent process relationships. Monitoring this activity is
  crucial as it can indicate exploitation attempts, such as those associated with
  CVE-2018-8440, which can lead to privilege escalation. If confirmed malicious, attackers
  could gain SYSTEM-level access, allowing them to execute arbitrary code, escalate
  privileges, and potentially compromise the entire system.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.parent_process_name
- Processes.process_name
- Processes.dest
- Processes.parent_process
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Processes.process_name) as process_name
  values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name=spoolsv.exe
  AND Processes.process_name!=regsvr32.exe by Processes.dest Processes.parent_process
  Processes.user | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `child_processes_of_spoolsv_exe_filter`'
