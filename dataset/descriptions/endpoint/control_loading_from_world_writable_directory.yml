description: The following analytic identifies instances of control.exe loading a
  .cpl or .inf file from a writable directory, which is related to CVE-2021-40444.
  This detection leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on process names and command-line executions mapped to the `Processes`
  node of the `Endpoint` data model. This activity is significant as it may indicate
  an attempt to exploit a known vulnerability, potentially leading to unauthorized
  code execution. If confirmed malicious, this could allow an attacker to gain control
  over the affected system, leading to further compromise.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=control.exe OR Processes.original_file_name=CONTROL.EXE)
  AND Processes.process IN ("*\\appdata\\*", "*\\windows\\temp\\*", "*\\programdata\\*")
  by Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id Processes.original_file_name
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `control_loading_from_world_writable_directory_filter`'
