description: The following analytic detects suspicious modifications to the Windows
  Update Server (WUServer) registry settings. It leverages data from the Endpoint.Registry
  data model to identify changes in the registry path associated with Windows Update
  configurations. This activity is significant because adversaries, including malware
  like RedLine Stealer, exploit this technique to bypass detection and deploy additional
  payloads. If confirmed malicious, this registry modification could allow attackers
  to evade defenses, potentially leading to further system compromise and persistent
  unauthorized access.
required_fields:
- _time
- Registry.registry_key_name
- Registry.registry_path
- Registry.user
- Registry.dest
- Registry.registry_value_name
- Registry.action
- Registry.registry_value_data
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Registry where Registry.registry_path="*\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\WUServer"
  by Registry.dest Registry.user Registry.registry_path Registry.registry_value_data
  Registry.registry_key_name | `drop_dm_object_name(Registry)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_modify_registry_wuserver_filter`'
