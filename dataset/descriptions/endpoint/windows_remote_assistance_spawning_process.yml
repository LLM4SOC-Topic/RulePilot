description: The following analytic detects Microsoft Remote Assistance (msra.exe)
  spawning PowerShell.exe or cmd.exe as a child process. This detection leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process creation
  events where msra.exe is the parent process. This activity is significant because
  msra.exe typically does not spawn command-line interfaces, indicating potential
  process injection or misuse. If confirmed malicious, an attacker could use this
  technique to execute arbitrary commands, escalate privileges, or maintain persistence
  on the compromised system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name=msra.exe (Processes.process_name=cmd.exe
  OR Processes.process_name=powershell.exe OR Processes.process_name=pwsh.exe OR Processes.process_name=sh.exe
  OR Processes.process_name=bash.exe OR Processes.process_name=wscript.exe OR Processes.process_name=cscript.exe)
  by Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.original_file_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_remote_assistance_spawning_process_filter`'
