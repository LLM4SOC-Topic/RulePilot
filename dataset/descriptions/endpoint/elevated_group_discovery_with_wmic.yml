description: The following analytic detects the execution of `wmic.exe` with command-line
  arguments querying specific elevated domain groups. It leverages Endpoint Detection
  and Response (EDR) telemetry to identify processes that access the LDAP namespace
  and search for groups like "Domain Admins" or "Enterprise Admins." This activity
  is significant as it indicates potential reconnaissance efforts by adversaries to
  identify high-privilege accounts within Active Directory. If confirmed malicious,
  this behavior could lead to privilege escalation, allowing attackers to gain elevated
  access and control over critical network resources.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="wmic.exe") (Processes.process=*/NAMESPACE:\\\\root\\directory\\ldap*)
  (Processes.process="*Domain Admins*" OR Processes.process="*Enterprise Admins*"
  OR Processes.process="*Schema Admins*" OR Processes.process="*Account Operators*"
  OR Processes.process="*Server Operators*" OR Processes.process="*Protected Users*"
  OR Processes.process="*Dns Admins*") by Processes.dest Processes.user Processes.parent_process
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `elevated_group_discovery_with_wmic_filter`'
