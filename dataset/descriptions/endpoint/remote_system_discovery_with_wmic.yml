description: The following analytic detects the execution of `wmic.exe` with specific
  command-line arguments used to discover remote systems within a domain. It leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process names
  and command-line executions. This activity is significant as it indicates potential
  reconnaissance efforts by adversaries to map out network resources and Active Directory
  structures. If confirmed malicious, this behavior could allow attackers to gain
  situational awareness, identify critical systems, and plan further attacks, potentially
  leading to unauthorized access and data exfiltration.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="wmic.exe") (Processes.process=*/NAMESPACE:\\\\root\\directory\\ldap*
  AND Processes.process=*ds_computer* AND Processes.process="*GET ds_samaccountname*")
  by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `remote_system_discovery_with_wmic_filter`'
