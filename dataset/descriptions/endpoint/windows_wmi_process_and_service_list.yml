description: The following analytic identifies suspicious WMI command lines querying
  for running processes or services. It leverages data from Endpoint Detection and
  Response (EDR) agents, focusing on specific process and command-line events. This
  activity is significant as adversaries often use WMI to gather system information
  and identify services on compromised machines. If confirmed malicious, this behavior
  could allow attackers to map out the system, identify critical services, and plan
  further attacks, potentially leading to privilege escalation or persistence within
  the environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.parent_process_guid
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=wmic.exe OR Processes.original_file_name=wmic.exe)
  Processes.process IN ("*process list*", "*service list*") by Processes.process_name
  Processes.original_file_name Processes.process Processes.process_id Processes.process_guid
  Processes.parent_process_name Processes.parent_process Processes.parent_process_guid
  Processes.dest Processes.user | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_wmi_process_and_service_list_filter`'
