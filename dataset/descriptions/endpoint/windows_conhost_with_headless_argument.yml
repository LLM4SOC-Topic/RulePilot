description: The following analytic detects the unusual invocation of the Windows
  Console Host process (conhost.exe) with the undocumented --headless parameter. This
  detection leverages Endpoint Detection and Response (EDR) telemetry, specifically
  monitoring for command-line executions where conhost.exe is executed with the --headless
  argument. This activity is significant for a SOC as it is not commonly used in legitimate
  operations and may indicate an attacker's attempt to execute commands stealthily.
  If confirmed malicious, this behavior could lead to persistence, lateral movement,
  or other malicious activities, potentially resulting in data exfiltration or system
  compromise.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=conhost.exe Processes.process="*--headless
  *" by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_conhost_with_headless_argument_filter`'
