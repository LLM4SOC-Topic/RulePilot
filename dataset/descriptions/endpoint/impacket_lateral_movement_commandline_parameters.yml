description: The following analytic identifies the use of suspicious command-line
  parameters associated with Impacket tools, such as `wmiexec.py`, `smbexec.py`, `dcomexec.py`,
  and `atexec.py`, which are used for lateral movement and remote code execution.
  It detects these activities by analyzing process execution logs from Endpoint Detection
  and Response (EDR) agents, focusing on specific command-line patterns. This activity
  is significant because Impacket tools are commonly used by adversaries and Red Teams
  to move laterally within a network. If confirmed malicious, this could allow attackers
  to execute commands remotely, potentially leading to further compromise and data
  exfiltration.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=cmd.exe (Processes.process
  = "*/Q /c * \\\\127.0.0.1\\*$*" AND Processes.process IN ("*2>&1*","*2&gt;&amp;1*"))
  by Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `impacket_lateral_movement_commandline_parameters_filter`'
