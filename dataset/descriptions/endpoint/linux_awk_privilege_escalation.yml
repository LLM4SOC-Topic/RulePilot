description: The following analytic detects the use of the AWK command with elevated
  privileges to execute system commands. It leverages Endpoint Detection and Response
  (EDR) telemetry, specifically monitoring processes that include "sudo," "awk," and
  "BEGIN*system" in their command lines. This activity is significant because it indicates
  a potential privilege escalation attempt, where a user could gain root access by
  executing commands as the root user. If confirmed malicious, this could allow an
  attacker to fully compromise the system, execute arbitrary commands, and maintain
  persistent control over the affected endpoint.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process="*sudo*" AND Processes.process="*awk*"  AND
  Processes.process="*BEGIN*system*" by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  Processes.process_guid | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `linux_awk_privilege_escalation_filter`'
