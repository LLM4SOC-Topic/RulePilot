description: The following analytic detects the execution of `powershell.exe` with
  the `Get-LocalUser` commandlet, which is used to query local user accounts. This
  detection leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on process names and command-line arguments. Monitoring this activity is significant
  because adversaries and Red Teams may use it to enumerate local users for situational
  awareness and Active Directory discovery. If confirmed malicious, this activity
  could allow attackers to identify potential targets for further exploitation or
  privilege escalation within the environment.
required_fields:
- _time
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="powershell.exe")
  (Processes.process=*Get-LocalUser*) by Processes.dest Processes.user Processes.parent_process
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `getlocaluser_with_powershell_filter`'
