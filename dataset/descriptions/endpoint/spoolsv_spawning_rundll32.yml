description: The following analytic detects the spawning of `rundll32.exe` without
  command-line arguments by `spoolsv.exe`, which is unusual and potentially indicative
  of exploitation attempts like CVE-2021-34527 (PrintNightmare). This detection leverages
  Endpoint Detection and Response (EDR) telemetry, focusing on process creation events
  where `spoolsv.exe` is the parent process. This activity is significant as `spoolsv.exe`
  typically does not spawn other processes, and such behavior could indicate an active
  exploitation attempt. If confirmed malicious, this could allow an attacker to execute
  arbitrary code, escalate privileges, or maintain persistence on the compromised
  endpoint.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name=spoolsv.exe
  (Processes.process_name=rundll32.exe OR Processes.original_file_name=RUNDLL32.EXE)
  by Processes.dest Processes.user Processes.parent_process_name Processes.original_file_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `spoolsv_spawning_rundll32_filter`'
