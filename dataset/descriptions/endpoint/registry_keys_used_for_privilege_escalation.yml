description: The following analytic detects modifications to registry keys under "Image
  File Execution Options" that can be used for privilege escalation. It leverages
  data from the Endpoint.Registry data model, specifically monitoring changes to registry
  paths and values like GlobalFlag and Debugger. This activity is significant because
  attackers can use these modifications to intercept executable calls and attach malicious
  binaries to legitimate system binaries. If confirmed malicious, this could allow
  attackers to execute arbitrary code with elevated privileges, leading to potential
  system compromise and persistent access.
required_fields:
- _time
- Registry.dest
- Registry.registry_value_name
- Registry.registry_key_name
- Registry.registry_path
- Registry.registry_value_data
- Registry.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  FROM datamodel=Endpoint.Registry WHERE ((Registry.registry_path="*Microsoft\\Windows
  NT\\CurrentVersion\\Image File Execution Options*") AND (Registry.registry_value_name=GlobalFlag
  OR Registry.registry_value_name=Debugger)) BY Registry.dest Registry.user Registry.registry_path
  Registry.registry_key_name Registry.registry_value_name Registry.registry_value_data
  Registry.process_guid | `drop_dm_object_name(Registry)` | where isnotnull(registry_value_data)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `registry_keys_used_for_privilege_escalation_filter`'
