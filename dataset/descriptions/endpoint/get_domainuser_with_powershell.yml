description: The following analytic detects the execution of `powershell.exe` with
  command-line arguments used to enumerate domain users via the `Get-DomainUser` command.
  This detection leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on process names and command-line executions mapped to the `Processes`
  node of the `Endpoint` data model. This activity is significant as it indicates
  potential reconnaissance efforts by adversaries or Red Teams using PowerView for
  Active Directory discovery. If confirmed malicious, this could allow attackers to
  gain situational awareness and identify valuable targets within the domain, potentially
  leading to further exploitation.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
- Processes.parent_process_name
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="cmd.exe" OR Processes.process_name="powershell*")
  AND Processes.process = "*Get-DomainUser*" by Processes.dest Processes.user Processes.parent_process
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  Processes.parent_process_name | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `get_domainuser_with_powershell_filter`'
