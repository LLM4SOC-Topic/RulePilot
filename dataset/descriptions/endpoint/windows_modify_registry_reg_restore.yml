description: The following analytic detects the execution of reg.exe with the "restore"
  parameter, indicating an attempt to restore registry backup data on a host. This
  detection leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on process execution logs and command-line arguments. This activity is significant
  as it may indicate post-exploitation actions, such as those performed by tools like
  winpeas, which use "reg save" and "reg restore" to manipulate registry settings.
  If confirmed malicious, this could allow an attacker to revert registry changes,
  potentially bypassing security controls and maintaining persistence.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.parent_process_guid
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where  (Processes.process_name=reg.exe OR Processes.original_file_name=reg.exe)
  AND Processes.process = "* restore *" by Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.process_guid Processes.parent_process_name
  Processes.parent_process Processes.parent_process_guid Processes.dest Processes.user
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_modify_registry_reg_restore_filter`'
