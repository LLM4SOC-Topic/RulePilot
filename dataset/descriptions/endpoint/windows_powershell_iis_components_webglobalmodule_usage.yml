description: The following analytic detects the usage of PowerShell Cmdlets - New-WebGlobalModule,
  Enable-WebGlobalModule, and Set-WebGlobalModule, which are used to create, enable,
  or modify IIS Modules. This detection leverages PowerShell Script Block Logging,
  specifically monitoring EventCode 4104 for these cmdlets. This activity is significant
  as adversaries may use these lesser-known cmdlets to manipulate IIS configurations,
  similar to AppCmd.exe, potentially bypassing traditional defenses. If confirmed
  malicious, this could allow attackers to persist in the environment, manipulate
  web server behavior, or escalate privileges.
required_fields:
- _time
- ScriptBlockText
- Computer
- EventCode
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText IN("*New-WebGlobalModule*","*Enable-WebGlobalModule*","*Set-WebGlobalModule*")
  | stats count min(_time) as firstTime max(_time) as lastTime by EventCode ScriptBlockText
  Computer user_id | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)  | `windows_powershell_iis_components_webglobalmodule_usage_filter`
