description: The following analytic detects the execution of ngrok.exe on a Windows
  operating system. It leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on process names and command-line arguments. This activity is significant
  because while ngrok is a legitimate tool for creating secure tunnels, it is increasingly
  used by adversaries to bypass network defenses and establish reverse proxies. If
  confirmed malicious, this could allow attackers to exfiltrate data, maintain persistence,
  or facilitate further attacks by tunneling traffic through the compromised system.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=ngrok.exe Processes.process
  IN ("*start*", "*--config*","*http*","*authtoken*", "*http*", "*tcp*") by Processes.dest
  Processes.user Processes.parent_process_name Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| `windows_ngrok_reverse_proxy_usage_filter`'
