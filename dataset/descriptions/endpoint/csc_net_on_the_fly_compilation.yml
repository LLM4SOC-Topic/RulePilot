description: The following analytic detects the use of the .NET compiler csc.exe for
  on-the-fly compilation of potentially malicious .NET code. It leverages data from
  Endpoint Detection and Response (EDR) agents, focusing on specific command-line
  patterns associated with csc.exe. This activity is significant because adversaries
  and malware often use this technique to evade detection by compiling malicious code
  at runtime. If confirmed malicious, this could allow attackers to execute arbitrary
  code, potentially leading to system compromise, data exfiltration, or further lateral
  movement within the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=csc.exe OR Processes.original_file_name=csc.exe)
  Processes.process = "*/noconfig*" Processes.process = "*/fullpaths*" Processes.process
  = "*@*" by Processes.dest Processes.user Processes.parent_process_name Processes.parent_process
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `csc_net_on_the_fly_compilation_filter`'
