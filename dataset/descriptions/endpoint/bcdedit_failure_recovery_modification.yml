description: The following analytic detects modifications to the Windows error recovery
  boot configurations using bcdedit.exe with flags such as "recoveryenabled" and "no".
  It leverages data from Endpoint Detection and Response (EDR) agents, focusing on
  process names, parent processes, and command-line executions. This activity is significant
  because ransomware often disables recovery options to prevent system restoration,
  making it crucial for SOC analysts to investigate. If confirmed malicious, this
  could hinder recovery efforts, allowing ransomware to cause extensive damage and
  complicate remediation.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.parent_process_name
- Processes.dest
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name = bcdedit.exe Processes.process="*recoveryenabled*"
  (Processes.process="* no*") by Processes.process_name Processes.process Processes.parent_process_name
  Processes.dest Processes.user | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `bcdedit_failure_recovery_modification_filter`'
