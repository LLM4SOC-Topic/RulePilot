description: The following analytic identifies the execution of `nltest.exe` with
  command-line arguments `/domain_trusts` or `/all_trusts` to query Domain Trust information.
  It leverages data from Endpoint Detection and Response (EDR) agents, focusing on
  process execution logs and command-line arguments. This activity is significant
  as it indicates potential reconnaissance efforts by adversaries to understand domain
  trust relationships, which can inform their lateral movement strategies. If confirmed
  malicious, this activity could enable attackers to map out trusted domains, facilitating
  further compromise and pivoting within the network.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=nltest.exe OR Processes.original_file_name=nltestrk.exe)
  (Processes.process=*/domain_trusts* OR Processes.process=*/all_trusts*) by Processes.dest
  Processes.user Processes.parent_process Processes.process_name Processes.process
  Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `nltest_domain_trust_discovery_filter`'
