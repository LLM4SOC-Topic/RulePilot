description: The following analytic identifies child processes spawned from "mshta.exe".
  It leverages data from Endpoint Detection and Response (EDR) agents, focusing on
  specific child processes like "powershell.exe" and "cmd.exe". This activity is significant
  because "mshta.exe" is often exploited by attackers to execute malicious scripts
  or commands. If confirmed malicious, this behavior could allow an attacker to execute
  arbitrary code, escalate privileges, or maintain persistence within the environment.
  Monitoring this activity helps in early detection of potential threats leveraging
  "mshta.exe" for malicious purposes.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.parent_process_name
- Processes.dest
- Processes.parent_process
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Processes.process_name) as process_name
  values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name=mshta.exe
  AND (Processes.process_name=powershell.exe OR Processes.process_name=colorcpl.exe
  OR Processes.process_name=msbuild.exe OR Processes.process_name=microsoft.workflow.compiler.exe
  OR Processes.process_name=searchprotocolhost.exe OR Processes.process_name=scrcons.exe
  OR Processes.process_name=cscript.exe OR Processes.process_name=wscript.exe OR Processes.process_name=powershell.exe
  OR Processes.process_name=cmd.exe) by Processes.dest Processes.parent_process Processes.user
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `suspicious_mshta_child_process_filter`'
