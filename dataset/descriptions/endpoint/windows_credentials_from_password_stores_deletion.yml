description: The following analytic detects the execution of the Windows OS tool cmdkey.exe
  with the /delete parameter. This detection leverages data from Endpoint Detection
  and Response (EDR) agents, focusing on process execution logs and command-line arguments.
  The activity is significant because cmdkey.exe can be used by attackers to delete
  stored credentials, potentially leading to privilege escalation and persistence.
  If confirmed malicious, this behavior could allow attackers to remove stored user
  credentials, hindering incident response efforts and enabling further unauthorized
  access to the compromised system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.parent_process_guid
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name="cmdkey.exe" OR Processes.original_file_name
  = "cmdkey.exe" AND Processes.process = "*/delete*" by Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.process_guid Processes.parent_process_name
  Processes.parent_process Processes.parent_process_guid Processes.dest Processes.user
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_credentials_from_password_stores_deletion_filter`'
