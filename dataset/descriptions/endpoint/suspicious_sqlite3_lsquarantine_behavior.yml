description: The following analytic identifies the use of SQLite3 querying the MacOS
  preferences to determine the original URL from which a package was downloaded. This
  detection leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on process names and command-line executions involving LSQuarantine. This activity
  is significant as it is commonly associated with MacOS adware and other malicious
  software. If confirmed malicious, this behavior could indicate an attempt to track
  or manipulate downloaded packages, potentially leading to further system compromise
  or persistent adware infections.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=sqlite3 Processes.process=*LSQuarantine*
  by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `suspicious_sqlite3_lsquarantine_behavior_filter`'
