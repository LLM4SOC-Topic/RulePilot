description: The following analytic detects a suspicious process creating or connecting
  to a potential Qakbot named pipe. It leverages Sysmon EventCodes 17 and 18, focusing
  on specific processes known to be abused by Qakbot and identifying randomly generated
  named pipes in GUID form. This activity is significant as Qakbot malware uses named
  pipes for inter-process communication after code injection, facilitating data theft.
  If confirmed malicious, this behavior could indicate a Qakbot infection, leading
  to unauthorized data access and potential exfiltration from the compromised host.
required_fields:
- _time
- Image
- EventType
- ProcessGuid
- ProcessId
- PipeName
- dest
- UserID
- SecurityID
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode IN (17, 18) EventType IN ( "CreatePipe",
  "ConnectPipe") Image IN ("*\\calc.exe", "*\\notepad.exe", "*\\rdpclip.exe", "*\\explorer.exe",
  "*\\wermgr.exe", "*\\ping.exe", "*\\OneDriveSetup.exe", "*\\dxdiag.exe", "*\\mobsync.exe",
  "*\\msra.exe", "*\\xwizard.exe") | regex PipeName="^\\\{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{8}"
  | stats  min(_time) as firstTime max(_time) as lastTime count by Image EventType
  ProcessGuid ProcessId PipeName SecurityID EventCode dest UserID | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_app_layer_protocol_qakbot_namedpipe_filter`
