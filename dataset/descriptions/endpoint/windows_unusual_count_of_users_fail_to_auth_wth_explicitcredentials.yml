description: The following analytic identifies a source user failing to authenticate
  with multiple users using explicit credentials on a host. It leverages Windows Event
  Code 4648 and calculates the standard deviation for each host, using the 3-sigma
  rule to detect anomalies. This behavior is significant as it may indicate a Password
  Spraying attack, where an adversary attempts to gain initial access or elevate privileges.
  If confirmed malicious, this activity could lead to unauthorized access, privilege
  escalation, or further compromise of the Active Directory environment.
required_fields:
- _time
- EventCode
- Target_User_Name
- Caller_User_Name
- Computer
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=4648 Caller_User_Name!=*$ Target_User_Name!=*$ | bucket span=5m _time
  | stats dc(Target_User_Name) AS unique_accounts values(Target_User_Name) as  user
  by _time, Computer, Caller_User_Name | eventstats avg(unique_accounts) as comp_avg
  , stdev(unique_accounts) as comp_std by Computer | eval upperBound=(comp_avg+comp_std*3)
  | eval isOutlier=if(unique_accounts > 10 and unique_accounts >= upperBound, 1, 0)
  | search isOutlier=1 | `windows_unusual_count_of_users_fail_to_auth_wth_explicitcredentials_filter`
