description: The following analytic detects the addition of NOPASSWD entries to the
  /etc/sudoers file on Linux systems. It leverages Linux Auditd data to identify command
  lines containing "NOPASSWD:". This activity is significant because it allows users
  to execute commands with elevated privileges without requiring a password, which
  can be exploited by adversaries to maintain persistent, privileged access. If confirmed
  malicious, this could lead to unauthorized privilege escalation, persistent access,
  and potential compromise of sensitive data and system integrity.
required_fields:
- _time
- proctitle
rule: sourcetype="linux:audit" type=PROCTITLE | eval normalized_proctitle_delimiter
  = if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(proctitle,"^[0-9A-F]+$"),
  replace(proctitle, "000", "020"),proctitle),null()) | eval normalized_proctitle_delimiter  =
  if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),
  replace(normalized_proctitle_delimiter, "00", "20"),normalized_proctitle_delimiter),null())
  | eval process_exec = if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),urldecode(replace(normalized_proctitle_delimiter,"([0-9A-F]{2})","%\1")),normalized_proctitle_delimiter)
  | rename host as dest | where LIKE (process_exec, "%NOPASSWD%") | stats count min(_time)
  as firstTime max(_time) as lastTime by process_exec proctitle normalized_proctitle_delimiter
  dest | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| `linux_auditd_nopasswd_entry_in_sudoers_file_filter`
