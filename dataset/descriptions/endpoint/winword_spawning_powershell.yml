description: The following analytic identifies instances where Microsoft Word (winword.exe)
  spawns a PowerShell process. This behavior is detected using Endpoint Detection
  and Response (EDR) telemetry, focusing on process creation events where the parent
  process is winword.exe. This activity is significant because it is uncommon and
  often associated with spearphishing attacks, where malicious documents execute encoded
  PowerShell commands. If confirmed malicious, this could allow an attacker to execute
  arbitrary code, potentially leading to data exfiltration, system compromise, or
  further lateral movement within the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name="winword.exe"
  (Processes.process_name=pwsh.exe OR Processes.process_name=sqlps.exe OR Processes.process_name=sqltoolsps.exe
  OR Processes.process_name=powershell.exe OR Processes.process_name=powershell_ise.exe
  OR Processes.original_file_name=pwsh.dll OR Processes.original_file_name=PowerShell.EXE
  OR Processes.original_file_name=powershell_ise.EXE) by Processes.dest Processes.user
  Processes.parent_process_name Processes.parent_process Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `winword_spawning_powershell_filter`'
