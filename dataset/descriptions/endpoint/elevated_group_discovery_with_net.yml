description: The following analytic detects the execution of `net.exe` or `net1.exe`
  with command-line arguments used to query elevated domain groups. It leverages data
  from Endpoint Detection and Response (EDR) agents, focusing on process names and
  command-line executions. This activity is significant as it indicates potential
  reconnaissance efforts by adversaries to identify high-privileged users within Active
  Directory. If confirmed malicious, this behavior could lead to further attacks aimed
  at compromising privileged accounts, escalating privileges, or gaining unauthorized
  access to sensitive systems and data.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="net.exe" OR Processes.original_file_name="net.exe"
  OR Processes.process_name="net1.exe" OR Processes.original_file_name="net1.exe")
  AND (Processes.process="*group*" AND Processes.process="*/do*") (Processes.process="*Domain
  Admins*" OR Processes.process="*Enterprise Admins*" OR Processes.process="*Schema
  Admins*" OR Processes.process="*Account Operators*" OR Processes.process="*Server
  Operators*" OR Processes.process="*Protected Users*" OR Processes.process="*Dns
  Admins*") by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `elevated_group_discovery_with_net_filter`'
