description: The following analytic detects the enabling of PowerShell Web Access
  via PowerShell commands. It leverages PowerShell script block logging (EventCode
  4104) to identify the execution of the `Install-WindowsFeature` cmdlet with the
  `WindowsPowerShellWebAccess` parameter. This activity is significant because enabling
  PowerShell Web Access can facilitate remote execution of PowerShell commands, potentially
  allowing an attacker to gain unauthorized access to systems and networks.
required_fields:
- _time
- EventCode
- ScriptBlockText
- dest
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText IN ("*Install-WindowsFeature*WindowsPowerShellWebAccess*","*Install-PswaWebApplication*","*Add-PswaAuthorizationRule*UserName
  *ComputerName *") | rename Computer as dest | stats count min(_time) as firstTime
  max(_time) as lastTime by EventCode ScriptBlockText dest UserID | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_enable_powershell_web_access_filter`
