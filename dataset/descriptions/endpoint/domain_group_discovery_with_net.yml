description: The following analytic identifies the execution of `net.exe` with command-line
  arguments used to query domain groups, specifically `group /domain`. It leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process names
  and command-line arguments. This activity is significant as it indicates potential
  reconnaissance efforts by adversaries to enumerate domain groups, which is a common
  step in Active Directory Discovery. If confirmed malicious, this behavior could
  allow attackers to gain insights into the domain structure, aiding in further attacks
  such as privilege escalation or lateral movement.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="net.exe" OR Processes.original_file_name="net.exe"
  OR Processes.process_name="net1.exe" OR Processes.original_file_name="net1.exe")
  AND (Processes.process=*group* AND Processes.process=*/do*) by Processes.dest Processes.user
  Processes.parent_process Processes.process_name Processes.process Processes.process_id
  Processes.parent_process_id | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `domain_group_discovery_with_net_filter`'
