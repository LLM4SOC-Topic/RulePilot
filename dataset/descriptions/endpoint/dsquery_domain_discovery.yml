description: The following analytic detects the execution of "dsquery.exe" with arguments
  targeting `TrustedDomain` queries directly from the command line. This behavior
  is identified using Endpoint Detection and Response (EDR) telemetry, focusing on
  process names and command-line arguments. This activity is significant as it often
  indicates domain trust discovery, a common step in lateral movement or privilege
  escalation by adversaries. If confirmed malicious, this could allow attackers to
  map domain trusts, potentially leading to further exploitation and unauthorized
  access to trusted domains.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=dsquery.exe Processes.process=*trustedDomain*
  by Processes.dest Processes.user Processes.parent_process_name Processes.parent_process
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `dsquery_domain_discovery_filter`'
