description: The following analytic detects the execution of `powershell.exe` running
  the `Get-DomainPolicy` cmdlet, which is used to retrieve password policies in a
  Windows domain. It leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on process names and command-line executions. This activity is significant
  as it indicates potential reconnaissance efforts by adversaries to gather domain
  policy information, which is crucial for planning further attacks. If confirmed
  malicious, this could lead to unauthorized access to sensitive domain configurations,
  aiding in privilege escalation and lateral movement within the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
- Processes.parent_process_name
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="cmd.exe" OR Processes.process_name="powershell*")
  AND Processes.process = "*Get-DomainPolicy*" by Processes.dest Processes.user Processes.parent_process
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  Processes.parent_process_name | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `get_domainpolicy_with_powershell_filter`'
