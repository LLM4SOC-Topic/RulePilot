description: The following analytic detects the use of Windows Curl.exe to download
  a file to a suspicious location, such as AppData, ProgramData, or Public directories.
  It leverages data from Endpoint Detection and Response (EDR) agents, focusing on
  command-line executions that include the -O or --output options. This activity is
  significant because downloading files to these locations can indicate an attempt
  to bypass security controls or establish persistence. If confirmed malicious, this
  behavior could lead to unauthorized code execution, data exfiltration, or further
  compromise of the system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=curl.exe OR Processes.original_file_name=Curl.exe)
  Processes.process IN ("*-O *","*--output*") Processes.process IN ("*\\appdata\\*","*\\programdata\\*","*\\public\\*")
  by Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.original_file_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_curl_download_to_suspicious_path_filter`'
