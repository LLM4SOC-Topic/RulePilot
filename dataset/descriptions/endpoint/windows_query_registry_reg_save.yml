description: The following analytic detects the execution of the reg.exe process with
  the "save" parameter. This detection leverages data from Endpoint Detection and
  Response (EDR) agents, focusing on process execution logs and command-line arguments.
  This activity is significant because threat actors often use the "reg save" command
  to dump credentials or test registry modification capabilities on compromised hosts.
  If confirmed malicious, this behavior could allow attackers to escalate privileges,
  persist in the environment, or access sensitive information stored in the registry.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.parent_process_guid
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where  (Processes.process_name=reg.exe OR Processes.original_file_name=reg.exe)
  AND Processes.process = "* save *" by Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.process_guid Processes.parent_process_name
  Processes.parent_process Processes.parent_process_guid Processes.dest Processes.user
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_query_registry_reg_save_filter`'
