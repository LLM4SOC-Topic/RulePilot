description: The following analytic detects the use of the Get-ADComputer cmdlet with
  parameters indicating a search for Windows endpoints with Kerberos Unconstrained
  Delegation. It leverages PowerShell Script Block Logging (EventCode=4104) to identify
  this specific activity. This behavior is significant as it may indicate an attempt
  by adversaries or Red Teams to gain situational awareness and perform Active Directory
  discovery. If confirmed malicious, this activity could allow attackers to identify
  high-value targets for further exploitation, potentially leading to privilege escalation
  or lateral movement within the network.
required_fields:
- _time
- EventCode
- ScriptBlockText
- Computer
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 (ScriptBlockText = "*Get-ADComputer*" AND ScriptBlockText = "*TrustedForDelegation*")
  | stats count min(_time) as firstTime max(_time) as lastTime by EventCode ScriptBlockText
  Computer UserID | rename Computer as dest | rename UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_get_adcomputer_unconstrained_delegation_discovery_filter`
