description: The following analytic detects winhlp32.exe spawning a child process
  that loads a file from appdata, programdata, or temp directories. This detection
  leverages data from Endpoint Detection and Response (EDR) agents, focusing on process
  creation events. This activity is significant because winhlp32.exe has known vulnerabilities
  and can be exploited to execute malicious code. If confirmed malicious, an attacker
  could use this technique to execute arbitrary scripts, escalate privileges, or maintain
  persistence within the environment. Analysts should review parallel processes, module
  loads, and file modifications for further suspicious behavior.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name=winhlp32.exe
  Processes.process IN ("*\\appdata\\*","*\\programdata\\*", "*\\temp\\*") by Processes.dest
  Processes.user Processes.parent_process_name Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `winhlp32_spawning_a_process_filter`'
