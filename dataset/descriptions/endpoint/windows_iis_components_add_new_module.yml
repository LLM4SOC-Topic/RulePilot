description: The following analytic detects the execution of AppCmd.exe to install
  a new module in IIS. This detection leverages data from Endpoint Detection and Response
  (EDR) agents, focusing on process names and command-line executions. This activity
  is significant as adversaries may use it to install webshells or backdoors, leading
  to credit card scraping, persistence, and further post-exploitation. If confirmed
  malicious, this could allow attackers to maintain persistent access, execute arbitrary
  code, and potentially exfiltrate sensitive information from the compromised web
  server.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where NOT (Processes.parent_process_name  IN ("msiexec.exe",
  "iissetup.exe")) Processes.process_name=appcmd.exe Processes.process IN ("*install
  *", "*module *") AND Processes.process="*image*" by Processes.dest Processes.user
  Processes.parent_process_name Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_iis_components_add_new_module_filter`'
