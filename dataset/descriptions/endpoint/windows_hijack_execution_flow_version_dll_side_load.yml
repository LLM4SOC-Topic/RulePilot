description: The following analytic detects a process loading a version.dll file from
  a directory other than %windir%\system32 or %windir%\syswow64. This detection leverages
  Sysmon EventCode 7 to identify instances where an unsigned or improperly located
  version.dll is loaded. This activity is significant as it is a common technique
  used in ransomware and APT malware campaigns, including Brute Ratel C4, to execute
  malicious code via DLL side loading. If confirmed malicious, this could allow attackers
  to execute arbitrary code, maintain persistence, and potentially compromise the
  target host.
required_fields:
- _time
- Image
- ImageLoaded
- process_name
- dest
- EventCode
- Signed
- ProcessId
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=7 ImageLoaded = "*\\version.dll"
  AND (Signed = "false" OR NOT(ImageLoaded IN("*\\windows\\system32*",  "*\\windows\\syswow64\\*")))
  | stats count min(_time) as firstTime max(_time) as lastTime by Image ImageLoaded
  process_name dest EventCode Signed ProcessId | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_hijack_execution_flow_version_dll_side_load_filter`
