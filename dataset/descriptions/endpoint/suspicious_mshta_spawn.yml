description: The following analytic detects the spawning of mshta.exe by wmiprvse.exe
  or svchost.exe. This behavior is identified using Endpoint Detection and Response
  (EDR) data, focusing on process creation events where the parent process is either
  wmiprvse.exe or svchost.exe. This activity is significant as it may indicate the
  use of a DCOM object to execute malicious scripts via mshta.exe, a common tactic
  in sophisticated attacks. If confirmed malicious, this could allow an attacker to
  execute arbitrary code, potentially leading to system compromise and further malicious
  activities.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Processes.process_name) as process_name
  values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.parent_process_name=svchost.exe
  OR Processes.parent_process_name=wmiprvse.exe) AND (Processes.process_name=mshta.exe
  OR Processes.original_file_name=MSHTA.EXE) by Processes.dest Processes.parent_process
  Processes.user Processes.original_file_name| `drop_dm_object_name(Processes)` |
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `suspicious_mshta_spawn_filter`'
