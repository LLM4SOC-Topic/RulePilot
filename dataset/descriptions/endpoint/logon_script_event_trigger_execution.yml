description: The following analytic detects the modification of the UserInitMprLogonScript
  registry entry, which is often used by attackers to establish persistence and gain
  privilege escalation upon system boot. It leverages data from the Endpoint.Registry
  data model, focusing on changes to the specified registry path. This activity is
  significant because it is a common technique used by APT groups and malware to ensure
  their payloads execute automatically when the system starts. If confirmed malicious,
  this could allow attackers to maintain persistent access and potentially escalate
  their privileges on the compromised host.
required_fields:
- _time
- Registry.dest
- Registry.user
- Registry.registry_path
- Registry.registry_key_name
- Registry.registry_value_name
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count  min(_time) as firstTime max(_time) as lastTime
  FROM datamodel=Endpoint.Registry where Registry.registry_path IN ("*\\Environment\\UserInitMprLogonScript")
  by Registry.dest  Registry.user Registry.registry_path Registry.registry_key_name
  Registry.registry_value_name | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `drop_dm_object_name(Registry)`
  | `logon_script_event_trigger_execution_filter`'
