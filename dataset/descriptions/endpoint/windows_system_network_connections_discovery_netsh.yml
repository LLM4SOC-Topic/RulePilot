description: The following analytic detects the execution of the Windows built-in
  tool netsh.exe to display the state, configuration, and profile of the host firewall.
  This detection leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on command-line executions and process metadata. Monitoring this activity
  is crucial as netsh.exe can be used by adversaries to bypass firewall rules or discover
  firewall settings. If confirmed malicious, this activity could allow attackers to
  manipulate firewall configurations, potentially leading to unauthorized network
  access or data exfiltration.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.parent_process_guid
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=netsh.exe OR Processes.original_file_name=netsh.exe)AND
  Processes.process = "* show *" Processes.process IN ("*state*", "*config*", "*wlan*",
  "*profile*") by Processes.process_name Processes.original_file_name Processes.process
  Processes.process_id Processes.process_guid Processes.parent_process_name Processes.parent_process
  Processes.parent_process_guid Processes.dest Processes.user | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_system_network_connections_discovery_netsh_filter`'
