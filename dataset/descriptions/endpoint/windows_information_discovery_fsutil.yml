description: The following analytic identifies the execution of the Windows built-in
  tool FSUTIL with the FSINFO parameter to discover file system information. This
  detection leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on process execution logs that include command-line details. Monitoring this activity
  is significant because FSUTIL can be abused by adversaries to gather detailed information
  about the file system, aiding in further exploitation. If confirmed malicious, this
  activity could enable attackers to map the file system, identify valuable data,
  and plan subsequent actions such as privilege escalation or persistence.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.parent_process_guid
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name="fsutil.exe" OR Processes.original_file_name
  = "fsutil.exe" AND Processes.process = "*fsinfo*" by Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.process_guid Processes.parent_process_name
  Processes.parent_process Processes.parent_process_guid Processes.dest Processes.user
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_information_discovery_fsutil_filter`'
