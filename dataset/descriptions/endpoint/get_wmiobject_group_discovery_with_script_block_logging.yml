description: The following analytic detects the execution of the `Get-WMIObject Win32_Group`
  command using PowerShell Script Block Logging (EventCode=4104). This method captures
  the full command sent to PowerShell, allowing for detailed analysis. Identifying
  group information on an endpoint is not inherently malicious but can be suspicious
  based on context such as time, endpoint, and user. This activity is significant
  as it may indicate reconnaissance efforts by an attacker. If confirmed malicious,
  it could lead to further enumeration and potential lateral movement within the network.
required_fields:
- _time
- EventCode
- Message
- ComputerName
- User
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*Get-WMIObject*" AND ScriptBlockText = "*Win32_Group*"
  | stats count min(_time) as firstTime max(_time) as lastTime by EventCode ScriptBlockText
  Computer UserID | rename Computer as dest, UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `get_wmiobject_group_discovery_with_script_block_logging_filter`
