description: The following analytic detects modifications to the Windows registry
  key for setting up a proxy server. It leverages data from the Endpoint.Registry
  datamodel, focusing on changes to the "Internet Settings\\ProxyServer" registry
  path. This activity is significant as it can indicate malware or adversaries configuring
  a proxy to facilitate unauthorized communication with Command and Control (C2) servers.
  If confirmed malicious, this could allow attackers to establish persistent, covert
  channels for data exfiltration or further exploitation of the compromised host.
required_fields:
- _time
- Registry.registry_key_name
- Registry.registry_path
- Registry.user
- Registry.dest
- Registry.registry_value_name
- Registry.action
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Registry where Registry.registry_path = "*\\Internet Settings\\ProxyServer"
  by  Registry.registry_path Registry.registry_value_name Registry.registry_value_data
  Registry.process_guid Registry.action Registry.user Registry.dest | `drop_dm_object_name(Registry)`
  | where isnotnull(registry_value_data) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_modify_registry_proxyserver_filter`'
