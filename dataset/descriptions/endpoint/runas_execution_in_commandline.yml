description: The following analytic detects the execution of the runas.exe process
  with administrator user options. It leverages data from Endpoint Detection and Response
  (EDR) agents, focusing on command-line executions and process details. This activity
  is significant as it may indicate an attempt to gain elevated privileges, a common
  tactic in privilege escalation and lateral movement. If confirmed malicious, this
  could allow an attacker to execute commands with higher privileges, potentially
  leading to unauthorized access, data exfiltration, or further compromise of the
  target host.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=runas.exe OR Processes.original_file_name=runas.exe)
  AND Processes.process = "*/user:*" AND Processes.process = "*admin*" by Processes.dest
  Processes.user Processes.parent_process_name Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `runas_execution_in_commandline_filter`'
