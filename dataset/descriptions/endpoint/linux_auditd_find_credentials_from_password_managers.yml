description: The following analytic detects suspicious attempts to find credentials
  stored in password managers, which may indicate an attacker's effort to retrieve
  sensitive login information. Password managers are often targeted by adversaries
  seeking to access stored passwords for further compromise or lateral movement within
  a network. By monitoring for unusual or unauthorized access to password manager
  files or processes, this analytic helps identify potential credential theft attempts,
  enabling security teams to respond quickly to protect critical accounts and prevent
  further unauthorized access.
required_fields:
- _time
- argc
- process_exec
rule: sourcetype="linux:audit" type=EXECVE | eval relevant_fields=if(type="EXECVE",
  "", relevant_fields) | foreach a* [eval relevant_fields=if(type="EXECVE", mvappend(relevant_fields,
  '<<FIELD>>'), relevant_fields)] | eval process_exec=if(type="EXECVE", mvjoin(relevant_fields,
  " "), process_exec) | eval process_exec=if(type="EXECVE", trim(process_exec), process_exec)
  | rename host as dest | where  (LIKE (process_exec, "%find%") OR LIKE (process_exec,
  "%grep%")) AND (LIKE (process_exec, "%.kdbx%") OR LIKE (process_exec, "%KeePass%")
  OR LIKE (process_exec, "%KeePass\.enforced%") OR LIKE (process_exec, "%.lpdb%")OR
  LIKE (process_exec, "%.opvault%")OR LIKE (process_exec, "%.agilekeychain%")OR LIKE
  (process_exec, "%.dashlane%")OR LIKE (process_exec, "%.rfx%")OR LIKE (process_exec,
  "%passbolt%")OR LIKE (process_exec, "%.spdb%")OR LIKE (process_exec, "%StickyPassword%")OR
  LIKE (process_exec, "%.walletx%")OR LIKE (process_exec, "%enpass%")OR LIKE (process_exec,
  "%vault%")OR LIKE (process_exec, "%.kdb%")) | stats count min(_time) as firstTime
  max(_time) as lastTime by argc process_exec dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `linux_auditd_find_credentials_from_password_managers_filter`
