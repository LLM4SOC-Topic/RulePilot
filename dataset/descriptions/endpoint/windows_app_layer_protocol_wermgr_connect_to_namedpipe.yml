description: The following analytic detects the wermgr.exe process creating or connecting
  to a named pipe. It leverages Sysmon EventCodes 17 and 18 to identify these actions.
  This activity is significant because wermgr.exe, a legitimate Windows OS Problem
  Reporting application, is often abused by malware such as Trickbot and Qakbot to
  execute malicious code. If confirmed malicious, this behavior could indicate that
  an attacker has injected code into wermgr.exe, potentially allowing them to communicate
  covertly, escalate privileges, or persist within the environment.
required_fields:
- _time
- Image
- EventType
- ProcessGuid
- ProcessId
- PipeName
- dest
- UserID
- SecurityID
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode IN (17, 18) Image= "*\\wermgr.exe"
  EventType IN ( "CreatePipe", "ConnectPipe") | stats  min(_time) as firstTime max(_time)
  as lastTime count by Image EventType ProcessGuid ProcessId PipeName SecurityID EventCode
  dest UserID | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_app_layer_protocol_wermgr_connect_to_namedpipe_filter`
