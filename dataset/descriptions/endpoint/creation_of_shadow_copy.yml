description: The following analytic detects the creation of shadow copies using Vssadmin
  or Wmic. It leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on process execution logs that include command-line details. This activity is significant
  because creating shadow copies can be a precursor to ransomware attacks or data
  exfiltration, allowing attackers to bypass file locks and access sensitive data.
  If confirmed malicious, this behavior could enable attackers to maintain persistence,
  recover deleted files, or prepare for further malicious activities, posing a significant
  risk to the integrity and confidentiality of the system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=vssadmin.exe Processes.process=*create*
  Processes.process=*shadow*) OR (Processes.process_name=wmic.exe Processes.process=*shadowcopy*
  Processes.process=*create*) by Processes.dest Processes.user Processes.process_name
  Processes.process  Processes.parent_process_name Processes.parent_process Processes.process_id
  Processes.parent_process_id | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `creation_of_shadow_copy_filter`'
