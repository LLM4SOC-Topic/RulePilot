description: The following analytic detects the execution of the chmod utility to
  set the SUID or SGID bit on files, which can allow users to temporarily gain root
  or group-level access. This detection leverages data from Linux Auditd, focusing
  on process names and command-line arguments related to chmod. This activity is significant
  as it can indicate an attempt to escalate privileges or maintain persistence on
  a system. If confirmed malicious, an attacker could gain elevated access, potentially
  compromising sensitive data or critical system functions.
required_fields:
- _time
- proctitle
rule: sourcetype="linux:audit" type=PROCTITLE | eval normalized_proctitle_delimiter
  = if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(proctitle,"^[0-9A-F]+$"),
  replace(proctitle, "000", "020"),proctitle),null()) | eval normalized_proctitle_delimiter  =
  if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),
  replace(normalized_proctitle_delimiter, "00", "20"),normalized_proctitle_delimiter),null())
  | eval process_exec = if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),urldecode(replace(normalized_proctitle_delimiter,"([0-9A-F]{2})","%\1")),normalized_proctitle_delimiter)
  | rename host as dest | where LIKE (process_exec, "%chmod %") AND (LIKE (process_exec,
  "% u+s %") OR LIKE (process_exec, "% g+s %") OR LIKE (process_exec, "% 4777 %")
  OR LIKE (process_exec, "% 4577 %")) | stats count min(_time) as firstTime max(_time)
  as lastTime by process_exec proctitle normalized_proctitle_delimiter dest | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| `linux_auditd_setuid_using_chmod_utility_filter`
