description: The following analytic detects a Telegram process enumerating all network
  users in a local group. It leverages EventCode 4798, which is generated when a process
  enumerates a user's security-enabled local groups on a computer or device. This
  activity is significant as it may indicate an attempt to gather information on user
  accounts, a common precursor to further malicious actions. If confirmed malicious,
  this behavior could allow an attacker to map out user accounts, potentially leading
  to privilege escalation or lateral movement within the network.
required_fields:
- _time
- user
- dest
- EventCode
- Process_Name
- Process_ID
- Account_Name
- Account_Domain
- Logon_ID
- Security_ID
- Message
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=4798  CallerProcessName = "*\\telegram.exe" | stats count min(_time) as
  firstTime max(_time) as lastTime by user Computer EventCode CallerProcessName  ProcessID
  SubjectUserSid SubjectDomainName  SubjectLogonId | rename Computer as dest | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `enumerate_users_local_group_using_telegram_filter`
