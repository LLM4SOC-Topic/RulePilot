description: The following analytic detects the execution of the Invoke-ShareFinder
  PowerShell cmdlet from PowerView. This detection leverages PowerShell Script Block
  Logging to identify instances where this specific command is executed. Monitoring
  this activity is crucial as it indicates an attempt to enumerate network file shares,
  which may contain sensitive information such as backups, scripts, and credentials.
  If confirmed malicious, this activity could enable an attacker to escalate privileges
  or move laterally within the network, potentially compromising additional systems
  and sensitive data.
required_fields:
- _time
- EventCode
- ScriptBlockText
- Opcode
- Computer
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104  (ScriptBlockText=Invoke-ShareFinder*) | stats count min(_time) as
  firstTime max(_time) as lastTime by Opcode Computer UserID EventCode ScriptBlockText
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_file_share_discovery_with_powerview_filter`
