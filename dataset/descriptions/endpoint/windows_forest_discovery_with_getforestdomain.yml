description: The following analytic detects the execution of the `Get-ForestDomain`
  cmdlet, a component of the PowerView toolkit used for Windows domain enumeration.
  It leverages PowerShell Script Block Logging (EventCode=4104) to identify this activity.
  Detecting `Get-ForestDomain` is significant because adversaries and Red Teams use
  it to gather detailed information about Active Directory forest and domain configurations.
  If confirmed malicious, this activity could enable attackers to understand the domain
  structure, facilitating lateral movement or privilege escalation within the environment.
required_fields:
- _time
- EventCode
- Message
- Computer
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*Get-ForestDomain*" | stats count min(_time) as
  firstTime max(_time) as lastTime by EventCode ScriptBlockText Computer UserID |
  rename Computer as dest, UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_forest_discovery_with_getforestdomain_filter`
