description: The following analytic detects the execution of `powershell.exe` with
  command-line arguments that query for domain groups using `Get-DomainGroup`. This
  detection leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on process names and command-line executions mapped to the `Processes` node of the
  `Endpoint` data model. Monitoring this activity is crucial as `Get-DomainGroup`
  is part of PowerView, a tool often used by adversaries for domain enumeration and
  situational awareness. If confirmed malicious, this activity could allow attackers
  to gain insights into domain group structures, aiding in further exploitation and
  privilege escalation.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="powershell.exe")
  (Processes.process=*Get-DomainGroup*) by Processes.dest Processes.user Processes.parent_process
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `getdomaingroup_with_powershell_filter`'
