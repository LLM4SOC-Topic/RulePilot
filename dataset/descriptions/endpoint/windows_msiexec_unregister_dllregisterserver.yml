description: The following analytic detects the use of msiexec.exe with the /z switch
  parameter, which is used to unload DLLRegisterServer. This detection leverages data
  from Endpoint Detection and Response (EDR) agents, focusing on process execution
  logs, including command-line arguments. This activity is significant because unloading
  DLLRegisterServer can be indicative of an attempt to deregister a DLL, potentially
  disrupting legitimate services or hiding malicious activity. If confirmed malicious,
  this could allow an attacker to disable security controls, evade detection, or disrupt
  system functionality, leading to further compromise of the environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=msiexec.exe OR Processes.original_file_name=msiexec.exe)
  Processes.process IN ("*/z*", "*-z*") by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.original_file_name Processes.process Processes.process_id
  Processes.parent_process_id | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_msiexec_unregister_dllregisterserver_filter`'
