description: The following analytic detects the modification of ACL permissions to
  files or folders, making them accessible to everyone. It leverages data from Endpoint
  Detection and Response (EDR) agents, focusing on processes like "cacls.exe," "icacls.exe,"
  and "xcacls.exe" with specific command-line arguments. This activity is significant
  as it may indicate an adversary attempting to evade ACLs or access protected files.
  If confirmed malicious, this could allow unauthorized access to sensitive data,
  potentially leading to data breaches or further system compromise.
required_fields:
- _time
- Processes.parent_process_name
- Processes.process_name
- Processes.dest
- Processes.user
- Processes.process
- Processes.process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` values(Processes.process) as process values(Processes.process_id)
  as process_id count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes
  where (Processes.process_name = "cacls.exe" OR Processes.process_name = "icacls.exe"
  OR Processes.process_name = "xcacls.exe") AND Processes.process = "*/G*" AND (Processes.process
  = "* everyone:*"  OR Processes.process = "* SYSTEM:*" OR Processes.process = "*
  S-1-1-0:*") by Processes.parent_process_name Processes.process_name Processes.dest
  Processes.user | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `modify_acl_permission_to_files_or_folder_filter`'
