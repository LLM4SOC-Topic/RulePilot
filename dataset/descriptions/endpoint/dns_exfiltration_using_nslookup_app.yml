description: The following analytic identifies potential DNS exfiltration using the
  nslookup application. It detects specific command-line parameters such as query
  type (TXT, A, AAAA) and retry options, which are commonly used by attackers to exfiltrate
  data. The detection leverages Endpoint Detection and Response (EDR) telemetry, focusing
  on process execution logs. This activity is significant as it may indicate an attempt
  to communicate with a Command and Control (C2) server or exfiltrate sensitive data.
  If confirmed malicious, this could lead to data breaches and unauthorized access
  to critical information.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` values(Processes.process) as process values(Processes.process_id)
  as process_id values(Processes.parent_process) as parent_process count min(_time)
  as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name
  = "nslookup.exe" Processes.process = "*-querytype=*" OR Processes.process="*-qt=*"
  OR Processes.process="*-q=*" OR Processes.process="*-type=*" OR Processes.process="*-retry=*"
  by Processes.dest Processes.user Processes.process_name Processes.process Processes.parent_process_name  |
  `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `dns_exfiltration_using_nslookup_app_filter`'
