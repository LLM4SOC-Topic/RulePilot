description: The following analytic detects the use of `reg.exe` to export Windows
  Registry hives, which may contain sensitive credentials. This detection leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on command-line
  executions involving `save` or `export` actions targeting the `sam`, `system`, or
  `security` hives. This activity is significant as it indicates potential offline
  credential access attacks, often executed from untrusted processes or scripts. If
  confirmed malicious, attackers could gain access to credential data, enabling further
  compromise and lateral movement within the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=reg.exe OR Processes.original_file_name=reg.exe)
  (Processes.process=*save* OR Processes.process=*export*) AND (Processes.process="*\sam
  *" OR Processes.process="*\system *" OR Processes.process="*\security *") by Processes.dest
  Processes.user Processes.parent_process Processes.process_name Processes.parent_process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `extraction_of_registry_hives_filter`'
