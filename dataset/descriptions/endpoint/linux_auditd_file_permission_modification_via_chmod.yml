description: The following analytic detects suspicious file permission modifications
  using the `chmod` command, which may indicate an attacker attempting to alter access
  controls on critical files or directories. Such modifications can be used to grant
  unauthorized users elevated privileges or to conceal malicious activities by restricting
  legitimate access. By monitoring for unusual or unauthorized `chmod` usage, this
  analytic helps identify potential security breaches, allowing security teams to
  respond promptly to prevent privilege escalation, data tampering, or other unauthorized
  actions on the system.
required_fields:
- _time
- proctitle
rule: sourcetype="linux:audit" type=PROCTITLE | eval normalized_proctitle_delimiter
  = if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(proctitle,"^[0-9A-F]+$"),
  replace(proctitle, "000", "020"),proctitle),null()) | eval normalized_proctitle_delimiter  =
  if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),
  replace(normalized_proctitle_delimiter, "00", "20"),normalized_proctitle_delimiter),null())
  | eval process_exec = if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),urldecode(replace(normalized_proctitle_delimiter,"([0-9A-F]{2})","%\1")),normalized_proctitle_delimiter)
  | rename host as dest  | where LIKE(process_exec, "%chmod%") AND (LIKE(process_exec,
  "% 777 %") OR LIKE(process_exec, "% 755 %") OR LIKE(process_exec, "%+%x%") OR LIKE(process_exec,
  "% 754 %") OR LIKE(process_exec, "% 700 %")) | stats count min(_time) as firstTime
  max(_time) as lastTime by process_exec proctitle dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `linux_auditd_file_permission_modification_via_chmod_filter`
