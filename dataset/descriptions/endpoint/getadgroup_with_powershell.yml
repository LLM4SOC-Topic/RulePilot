description: The following analytic detects the execution of `powershell.exe` with
  the `Get-AdGroup` commandlet, which is used to query domain groups in a Windows
  Domain. This detection leverages data from Endpoint Detection and Response (EDR)
  agents, focusing on process names and command-line arguments. Monitoring this activity
  is crucial as it may indicate an adversary or Red Team enumerating domain groups
  for situational awareness and Active Directory discovery. If confirmed malicious,
  this activity could lead to further reconnaissance, privilege escalation, or lateral
  movement within the network.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name="powershell.exe")
  (Processes.process=*Get-AdGroup*) by Processes.dest Processes.user Processes.parent_process
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `getadgroup_with_powershell_filter`'
