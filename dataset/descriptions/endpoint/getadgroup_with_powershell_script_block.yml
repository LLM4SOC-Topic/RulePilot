description: The following analytic detects the execution of the `Get-AdGroup` PowerShell
  cmdlet using PowerShell Script Block Logging (EventCode=4104). This cmdlet is used
  to enumerate all domain groups, which adversaries may exploit for situational awareness
  and Active Directory discovery. Monitoring this activity is crucial as it can indicate
  reconnaissance efforts within the network. If confirmed malicious, this behavior
  could lead to further exploitation, such as privilege escalation or lateral movement,
  by providing attackers with detailed information about the domain's group structure.
required_fields:
- _time
- EventCode
- Message
- Computer
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*Get-ADGroup*" | stats count min(_time) as firstTime
  max(_time) as lastTime by EventCode ScriptBlockText Computer UserID | rename Computer
  as dest, UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `getadgroup_with_powershell_script_block_filter`
