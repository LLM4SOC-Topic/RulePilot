description: The following analytic detects a suspicious process loading a COM object
  from wbemprox.dll, fastprox.dll, or wbemcomn.dll. It leverages Sysmon EventCode
  7 to identify instances where these DLLs are loaded by processes not typically associated
  with them, excluding known legitimate processes and directories. This activity is
  significant as it may indicate an attempt by threat actors to abuse COM objects
  for privilege escalation or evasion of detection mechanisms. If confirmed malicious,
  this could allow attackers to gain elevated privileges or maintain persistence within
  the environment, posing a significant security risk.
required_fields:
- _time
- Image
- ImageLoaded
- process_name
- dest
- EventCode
- Signed
- ProcessId
- Hashes
- IMPHASH
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=7  ImageLoaded IN ("*\\fastprox.dll",
  "*\\wbemprox.dll", "*\\wbemcomn.dll") NOT (process_name IN ("wmiprvse.exe", "WmiApSrv.exe",
  "unsecapp.exe")) NOT(Image IN("*\\windows\\*","*\\program files*", "*\\wbem\\*"))
  | stats count min(_time) as firstTime max(_time) as lastTime by Image ImageLoaded
  process_name dest EventCode Signed ProcessId Hashes IMPHASH | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `wbemprox_com_object_execution_filter`
