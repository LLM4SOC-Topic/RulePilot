description: The following analytic detects the creation of scheduled tasks designed
  to execute commands using native Windows shells like PowerShell, Cmd, Wscript, or
  Cscript. It leverages Windows Security EventCode 4698 to identify when such tasks
  are registered. This activity is significant as it may indicate an attempt to establish
  persistence or execute malicious commands on a system. If confirmed malicious, this
  could allow an attacker to maintain access, execute arbitrary code, or escalate
  privileges, posing a severe threat to the environment.
required_fields:
- _time
- dest
- Task_Name
- Description
- Command
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=4698 TaskContent IN ("*powershell.exe*", "*wscript.exe*", "*cscript.exe*",
  "*cmd.exe*", "*sh.exe*", "*ksh.exe*", "*zsh.exe*", "*bash.exe*", "*scrcons.exe*",
  "*pwsh.exe*") | stats count min(_time) as firstTime max(_time) as lastTime by Computer,
  TaskName, TaskContent | rename Computer as dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `winevent_scheduled_task_created_to_spawn_shell_filter`
