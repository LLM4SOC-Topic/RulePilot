description: The following analytic detects the execution of the msiexec.exe process
  with the /HideWindow and rundll32 command-line parameters. It leverages data from
  Endpoint Detection and Response (EDR) agents, focusing on process creation events
  and command-line arguments. This activity is significant because it is a known tactic
  used by malware like QakBot to mask malicious operations under legitimate system
  processes. If confirmed malicious, this behavior could allow an attacker to download
  additional payloads, execute malicious code, or establish communication with remote
  servers, thereby evading detection and maintaining persistence.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name = msiexec.exe  Processes.process
  = "* /HideWindow *" Processes.process = "* rundll32*" by Processes.dest Processes.user
  Processes.parent_process_name Processes.parent_process Processes.process_name Processes.process
  Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_msiexec_hidewindow_rundll32_execution_filter`'
