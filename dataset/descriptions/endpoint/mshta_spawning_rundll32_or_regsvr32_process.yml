description: The following analytic detects a suspicious mshta.exe process spawning
  rundll32 or regsvr32 child processes. It leverages data from Endpoint Detection
  and Response (EDR) agents, focusing on process GUID, process name, and parent process
  fields. This activity is significant as it is a known technique used by malware
  like Trickbot to load malicious DLLs and execute payloads. If confirmed malicious,
  this behavior could allow attackers to execute arbitrary code, escalate privileges,
  or download additional malware, posing a severe threat to the environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name = "mshta.exe"  (Processes.process_name=rundll32.exe
  OR Processes.original_file_name=RUNDLL32.EXE) OR (Processes.process_name=regsvr32.exe
  OR Processes.original_file_name=REGSVR32.EXE) by  Processes.parent_process_name
  Processes.parent_process Processes.process_name Processes.process Processes.process_id
  Processes.process_guid Processes.user Processes.dest | `drop_dm_object_name("Processes")`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) |convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `mshta_spawning_rundll32_or_regsvr32_process_filter`'
