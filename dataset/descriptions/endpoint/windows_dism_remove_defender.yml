description: The following analytic detects the use of `dism.exe` to remove Windows
  Defender. It leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on command-line executions that include specific parameters for disabling and removing
  Windows Defender. This activity is significant because adversaries may disable Defender
  to evade detection and carry out further malicious actions undetected. If confirmed
  malicious, this could lead to the attacker gaining persistent access, executing
  additional payloads, or exfiltrating sensitive data without being intercepted by
  Windows Defender.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=dism.exe (Processes.process="*/online*"
  AND Processes.process="*/disable-feature*" AND Processes.process="*Windows-Defender*"
  AND Processes.process="*/remove*") by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.original_file_name Processes.process Processes.process_id
  Processes.parent_process_id | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_dism_remove_defender_filter`'
