description: The following analytic detects the use of the 'cpulimit' command with
  specific flags ('-l', '-f') executed with 'sudo' privileges. It leverages data from
  Endpoint Detection and Response (EDR) agents, focusing on process command-line arguments
  and execution details. This activity is significant because if 'cpulimit' is granted
  sudo rights, a user can potentially execute system commands as root, leading to
  privilege escalation. If confirmed malicious, this could allow an attacker to gain
  root access, execute arbitrary commands, and fully compromise the affected system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process="*cpulimit*" AND Processes.process="*-l*"
  AND Processes.process="*-f*" AND Processes.process="*sudo*" by Processes.dest Processes.user
  Processes.parent_process_name Processes.process_name Processes.process Processes.process_id
  Processes.parent_process_id Processes.process_guid | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `linux_cpulimit_privilege_escalation_filter`'
