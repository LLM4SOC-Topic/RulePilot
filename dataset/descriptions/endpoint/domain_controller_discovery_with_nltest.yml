description: The following analytic detects the execution of `nltest.exe` with command-line
  arguments `/dclist:` or `/dsgetdc:` to discover domain controllers. It leverages
  Endpoint Detection and Response (EDR) data, focusing on process names and command-line
  arguments. This activity is significant because both Red Teams and adversaries use
  `nltest.exe` for situational awareness and Active Directory discovery. If confirmed
  malicious, this behavior could allow attackers to map out domain controllers, facilitating
  further attacks such as privilege escalation or lateral movement within the network.
required_fields:
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=nltest.exe OR Processes.original_file_name=nltestrk.exe)
  (Processes.process="*/dclist:*" OR Processes.process="*/dsgetdc:*") by Processes.dest
  Processes.user Processes.parent_process Processes.process_name Processes.process
  Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `domain_controller_discovery_with_nltest_filter`'
