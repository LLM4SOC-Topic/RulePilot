description: The following analytic detects suspicious file permissions modifications
  using the chattr command, which may indicate an attacker attempting to manipulate
  file attributes to evade detection or prevent alteration. The chattr command can
  be used to make files immutable or restrict deletion, which can be leveraged to
  protect malicious files or disrupt system operations. By monitoring for unusual
  or unauthorized chattr usage, this analytic helps identify potential tampering with
  critical files, enabling security teams to quickly respond to and mitigate threats
  associated with unauthorized file attribute changes.
required_fields:
- _time
- argc
- process_exec
rule: sourcetype="linux:audit" type=PROCTITLE | eval normalized_proctitle_delimiter
  = if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(proctitle,"^[0-9A-F]+$"),
  replace(proctitle, "000", "020"),proctitle),null()) | eval normalized_proctitle_delimiter  =
  if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),
  replace(normalized_proctitle_delimiter, "00", "20"),normalized_proctitle_delimiter),null())
  | eval process_exec = if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),urldecode(replace(normalized_proctitle_delimiter,"([0-9A-F]{2})","%\1")),normalized_proctitle_delimiter)
  | rename host as dest |  where LIKE(process_exec, "%chattr %") AND LIKE(process_exec,
  "% -i%") | stats count min(_time) as firstTime max(_time) as lastTime by process_exec
  proctitle normalized_proctitle_delimiter dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `linux_auditd_file_permissions_modification_via_chattr_filter`
