description: The following analytic detects the execution of the PowerView PowerShell
  cmdlet Get-NetComputer, which is used to query Active Directory for user account
  details such as "samaccountname," "accountexpires," "lastlogon," and more. It leverages
  Event ID 4104 from PowerShell Script Block Logging to identify this activity. This
  behavior is significant as it may indicate an attempt to gather user account information,
  which is often a precursor to further malicious actions. If confirmed malicious,
  this activity could lead to unauthorized access, privilege escalation, or lateral
  movement within the network.
required_fields:
- _time
- ScriptBlockText
- dest
- EventCode
- user
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104  ScriptBlockText = "*Get-NetComputer*" ScriptBlockText IN ("*samaccountname*",
  "*accountexpires*", "*lastlogon*", "*lastlogoff*", "*pwdlastset*", "*logoncount*")
  | rename Computer as dest, UserID as user | stats count min(_time) as firstTime
  max(_time) as lastTime by EventCode ScriptBlockText dest user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_domain_account_discovery_via_get_netcomputer_filter`
