description: The following analytic detects the execution of Mimikatz commands via
  PowerShell by leveraging PowerShell Script Block Logging (EventCode=4104). This
  method captures and logs the full command sent to PowerShell, allowing for the identification
  of suspicious activities such as Pass the Ticket, Pass the Hash, and credential
  dumping. This activity is significant as Mimikatz is a well-known tool used for
  credential theft and lateral movement. If confirmed malicious, this could lead to
  unauthorized access, privilege escalation, and potential compromise of sensitive
  information within the environment.
required_fields:
- _time
- ScriptBlockText
- Opcode
- Computer
- UserID
- EventCode
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText IN (*mimikatz*, *-dumpcr*, *sekurlsa::pth*, *kerberos::ptt*,
  *kerberos::golden*) | stats count min(_time) as firstTime max(_time) as lastTime
  by Opcode Computer UserID EventCode ScriptBlockText | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `detect_mimikatz_with_powershell_script_block_logging_filter`
