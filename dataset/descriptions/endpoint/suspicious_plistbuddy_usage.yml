description: The following analytic identifies the use of the native macOS utility,
  PlistBuddy, to create or modify property list (.plist) files. This detection leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process names
  and command-line executions involving PlistBuddy. This activity is significant because
  PlistBuddy can be used to establish persistence by modifying LaunchAgents, as seen
  in the Silver Sparrow malware. If confirmed malicious, this could allow an attacker
  to maintain persistence, execute arbitrary commands, and potentially escalate privileges
  on the compromised macOS system.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=PlistBuddy (Processes.process=*LaunchAgents*
  OR Processes.process=*RunAtLoad* OR Processes.process=*true*) by Processes.dest
  Processes.user Processes.parent_process Processes.process_name Processes.process
  Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) |  `suspicious_plistbuddy_usage_filter`'
