description: The following analytic detects the execution of Ruby commands with elevated
  privileges on a Linux system. It identifies processes where Ruby is used with the
  `-e` flag to execute commands via `sudo`, leveraging Endpoint Detection and Response
  (EDR) telemetry. This activity is significant because it indicates a potential privilege
  escalation attempt, allowing a user to execute commands as root. If confirmed malicious,
  this could lead to full system compromise, enabling an attacker to gain root access,
  execute arbitrary commands, and maintain persistent control over the affected system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process="*ruby*-e*" AND Processes.process="*exec*"
  AND Processes.process="*sudo*" by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  Processes.process_guid | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `linux_ruby_privilege_escalation_filter`'
