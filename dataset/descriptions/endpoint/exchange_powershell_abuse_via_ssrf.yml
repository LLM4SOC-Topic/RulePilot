description: The following analytic detects suspicious behavior indicative of ProxyShell
  exploitation against on-premise Microsoft Exchange servers. It identifies HTTP POST
  requests to `autodiscover.json` containing `PowerShell` in the URI, leveraging server-side
  request forgery (SSRF) to access backend PowerShell. This detection uses Exchange
  server logs ingested into Splunk. Monitoring this activity is crucial as it may
  indicate an attacker attempting to execute commands or scripts on the Exchange server.
  If confirmed malicious, this could lead to unauthorized access, privilege escalation,
  or persistent control over the Exchange environment.
required_fields:
- _time
- dest
- cs_uri_query
- cs_method
- c_uri
rule: sourcetype="MSWindows:IIS" c_uri="*//autodiscover*" cs_uri_query="*PowerShell*"
  cs_method="POST" | stats count min(_time) as firstTime max(_time) as lastTime by
  dest, cs_uri_query, cs_method, c_uri | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `exchange_powershell_abuse_via_ssrf_filter`
