description: The following analytic identifies the creation of scheduled tasks that
  execute binaries or scripts from public directories, such as users\public, \programdata\,
  or \windows\temp, using schtasks.exe with the /create command. It leverages Sysmon
  Event ID 1 data to detect this behavior. This activity is significant because it
  often indicates an attempt to maintain persistence or execute malicious scripts,
  which are common tactics in malware deployment. If confirmed as malicious, this
  could lead to data compromise, unauthorized access, and potential lateral movement
  within the network.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_name
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=schtasks.exe (Processes.process=*\\users\\public\\*
  OR Processes.process=*\\programdata\\* OR Processes.process=*windows\\temp*)  Processes.process=*/create*
  by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| `suspicious_scheduled_task_from_public_directory_filter`'
