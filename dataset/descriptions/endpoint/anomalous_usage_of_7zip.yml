description: The following analytic detects the execution of 7z.exe, a 7-Zip utility,
  spawned from rundll32.exe or dllhost.exe. This behavior is identified using Endpoint
  Detection and Response (EDR) telemetry, focusing on process names and parent processes.
  This activity is significant as it may indicate an adversary attempting to use 7-Zip
  for data exfiltration, often by renaming the executable to evade detection. If confirmed
  malicious, this could lead to unauthorized data archiving and exfiltration, compromising
  sensitive information and potentially leading to further system exploitation.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.parent_process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name IN ("rundll32.exe",
  "dllhost.exe") Processes.process_name=*7z* by Processes.dest Processes.user Processes.parent_process
  Processes.parent_process_name Processes.process_name Processes.process Processes.process_id
  Processes.parent_process_id | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `anomalous_usage_of_7zip_filter`'
