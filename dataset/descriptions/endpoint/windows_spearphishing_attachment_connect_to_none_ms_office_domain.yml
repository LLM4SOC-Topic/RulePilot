description: The following analytic identifies suspicious Office documents that connect
  to non-Microsoft Office domains. It leverages Sysmon EventCode 22 to detect processes
  like winword.exe or excel.exe making DNS queries to domains outside of *.office.com
  or *.office.net. This activity is significant as it may indicate a spearphishing
  attempt using malicious documents to download or connect to harmful content. If
  confirmed malicious, this could lead to unauthorized data access, malware infection,
  or further network compromise.
required_fields:
- _time
- Image
- QueryName
- QueryResults
- QueryStatus
- dest
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=22 Image IN ("*\\winword.exe","*\\excel.exe","*\\powerpnt.exe","*\\mspub.exe","*\\visio.exe","*\\wordpad.exe","*\\wordview.exe","*\\onenote.exe",
  "*\\onenotem.exe","*\\onenoteviewer.exe","*\\onenoteim.exe", "*\\msaccess.exe")
  AND NOT(QueryName IN ("*.office.com", "*.office.net")) | stats count min(_time)
  as firstTime max(_time) as lastTime by Image QueryName QueryResults QueryStatus
  Computer | rename Computer as dest | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_spearphishing_attachment_connect_to_none_ms_office_domain_filter`
