description: The following analytic detects the execution of the Windows OS tool quser.exe,
  commonly used to gather information about user sessions on a Remote Desktop Session
  Host server. This detection leverages data from Endpoint Detection and Response
  (EDR) agents, focusing on process execution logs. Monitoring this activity is crucial
  as quser.exe is often abused by post-exploitation tools like winpeas, used in ransomware
  attacks to enumerate user sessions. If confirmed malicious, attackers could leverage
  this information to further compromise the system, maintain persistence, or escalate
  privileges.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
- Processes.parent_process_guid
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name="quser.exe" OR Processes.original_file_name
  = "quser.exe" by Processes.process_name Processes.original_file_name Processes.process
  Processes.process_id Processes.process_guid Processes.parent_process_name Processes.parent_process
  Processes.parent_process_guid Processes.dest Processes.user | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_system_user_discovery_via_quser_filter`'
