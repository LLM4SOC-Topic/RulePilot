description: The following analytic detects the creation of a new service named WerFaultSvc
  with a binary path in the Windows WinSxS directory. It leverages Windows System
  logs, specifically EventCode 7045, to identify this activity. This behavior is significant
  because it indicates the presence of Snake malware, which uses this service to maintain
  persistence by blending in with legitimate Windows services. If confirmed malicious,
  this activity could allow an attacker to execute Snake malware components, leading
  to potential data exfiltration, system compromise, and long-term persistence within
  the environment.
required_fields:
- EventCode
- Service_File_Name
- Service_Type
- _time
- Service_Name
- Service_Start_Type
- Service_Account
- user
rule: eventtype=wineventlog_system EventCode=7045  ImagePath="*\\windows\\winSxS\\*"
  ImagePath="*\Werfault.exe" | stats count min(_time) as firstTime max(_time) as lastTime
  by Computer EventCode ImagePath ServiceName ServiceType | rename Computer as dest
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_snake_malware_service_create_filter`
