description: The following analytic detects the deletion of shadow copies using the
  vssadmin.exe or wmic.exe utilities. It leverages data from Endpoint Detection and
  Response (EDR) agents, focusing on process names and command-line arguments. This
  activity is significant because deleting shadow copies is a common tactic used by
  attackers to prevent recovery and hide their tracks. If confirmed malicious, this
  action could hinder incident response efforts and allow attackers to maintain persistence
  and cover their activities, making it crucial for security teams to investigate
  promptly.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Processes.process) as process values(Processes.parent_process)
  as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes
  where (Processes.process_name=vssadmin.exe OR Processes.process_name=wmic.exe) Processes.process=*delete*
  Processes.process=*shadow* by Processes.user Processes.process_name Processes.parent_process_name
  Processes.dest  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `deleting_shadow_copies_filter`'
