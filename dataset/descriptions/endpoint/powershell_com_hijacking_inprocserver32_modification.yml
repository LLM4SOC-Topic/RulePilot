description: The following analytic detects attempts to modify or add a Component
  Object Model (COM) entry to the InProcServer32 path within the registry using PowerShell.
  It leverages PowerShell ScriptBlock Logging (EventCode 4104) to identify suspicious
  script blocks that target the InProcServer32 registry path. This activity is significant
  because modifying COM objects can be used for persistence or privilege escalation
  by attackers. If confirmed malicious, this could allow an attacker to execute arbitrary
  code or maintain persistent access to the compromised system, posing a severe security
  risk.
required_fields:
- _time
- ScriptBlockText
- Opcode
- Computer
- UserID
- EventCode
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*Software\\Classes\\CLSID\\*\\InProcServer32*"
  | stats count min(_time) as firstTime max(_time) as lastTime by EventCode ScriptBlockText
  Computer UserID | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `powershell_com_hijacking_inprocserver32_modification_filter`
