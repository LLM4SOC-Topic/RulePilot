description: The following analytic detects the modification of firewall settings
  to allow file and printer sharing. It leverages data from Endpoint Detection and
  Response (EDR) agents, focusing on command-line executions involving 'netsh' commands
  that enable file and printer sharing. This activity is significant because it can
  indicate an attempt by ransomware to discover and encrypt files on additional machines
  connected to the compromised host. If confirmed malicious, this could lead to widespread
  file encryption across the network, significantly increasing the impact of a ransomware
  attack.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=netsh.exe OR Processes.original_file_name=netsh.exe)
  Processes.process= "*firewall*" Processes.process= "*group=\"File and Printer Sharing\"*"  Processes.process="*enable=Yes*"
  by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id Processes.parent_process_name
  Processes.original_file_name | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `allow_file_and_printing_sharing_in_firewall_filter`'
