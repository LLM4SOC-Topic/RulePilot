description: The following analytic detects the creation of shim database files (.sdb)
  in default directories using the sdbinst.exe application. It leverages filesystem
  activity data from the Endpoint.Filesystem data model to identify file writes to
  the Windows\AppPatch\Custom directory. This activity is significant because shims
  can intercept and alter API calls, potentially allowing attackers to bypass security
  controls or execute malicious code. If confirmed malicious, this could lead to unauthorized
  code execution, privilege escalation, or persistent access within the environment.
required_fields:
- _time
- Filesystem.file_hash
- Filesystem.file_path
- Filesystem.file_name
- Filesystem.dest
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Filesystem.action) values(Filesystem.file_hash)
  as file_hash values(Filesystem.file_path) as file_path  min(_time) as firstTime
  max(_time) as lastTime FROM datamodel=Endpoint.Filesystem where Filesystem.file_path=*Windows\\AppPatch\\Custom*
  by Filesystem.file_name Filesystem.dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) |`drop_dm_object_name(Filesystem)`
  | `shim_database_file_creation_filter`'
