description: The following analytic identifies the resizing of shadow storage volumes,
  a technique used by ransomware like CLOP to prevent the recreation of shadow volumes.
  This detection leverages data from Endpoint Detection and Response (EDR) agents,
  focusing on command-line executions involving "vssadmin.exe" with parameters related
  to resizing shadow storage. This activity is significant as it indicates an attempt
  to hinder recovery efforts by manipulating shadow copies. If confirmed malicious,
  this could lead to successful ransomware deployment, making data recovery difficult
  and increasing the potential for data loss.
required_fields:
- Processes.process
- Processes.parent_process_name
- _time
- Processes.process_name
- Processes.parent_process
- Processes.dest
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` values(Processes.process) as cmdline values(Processes.parent_process_name)
  as parent_process values(Processes.process_name) as process_name min(_time) as firstTime
  max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.parent_process_name
  = "cmd.exe" OR Processes.parent_process_name = "powershell.exe" OR Processes.parent_process_name
  = "powershell_ise.exe" OR Processes.parent_process_name =  "wmic.exe" Processes.process_name
  = "vssadmin.exe" Processes.process="*resize*" Processes.process="*shadowstorage*"
  Processes.process="*/maxsize*" by Processes.parent_process_name Processes.parent_process
  Processes.process_name Processes.process Processes.dest Processes.user Processes.process_id
  Processes.process_guid | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) |convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `resize_shadowstorage_volume_filter`'
