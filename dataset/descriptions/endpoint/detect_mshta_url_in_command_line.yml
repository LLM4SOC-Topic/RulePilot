description: The following analytic detects the use of Microsoft HTML Application
  Host (mshta.exe) to make remote HTTP or HTTPS connections. It leverages data from
  Endpoint Detection and Response (EDR) agents, focusing on command-line arguments
  containing URLs. This activity is significant because adversaries often use mshta.exe
  to download and execute remote .hta files, bypassing security controls. If confirmed
  malicious, this behavior could allow attackers to execute arbitrary code, potentially
  leading to system compromise, data exfiltration, or further network infiltration.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Processes.process) as process values(Processes.parent_process)
  as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes
  where (Processes.process_name=mshta.exe OR Processes.original_file_name=MSHTA.EXE)
  (Processes.process="*http://*" OR Processes.process="*https://*") by Processes.user
  Processes.process_name Processes.parent_process_name Processes.original_file_name
  Processes.dest  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `detect_mshta_url_in_command_line_filter`'
