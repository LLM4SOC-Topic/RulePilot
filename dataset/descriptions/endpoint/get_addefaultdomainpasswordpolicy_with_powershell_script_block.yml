description: The following analytic detects the execution of the `Get-ADDefaultDomainPasswordPolicy`
  PowerShell cmdlet, which is used to retrieve the password policy in a Windows domain.
  This detection leverages PowerShell Script Block Logging (EventCode=4104) to identify
  the specific command execution. Monitoring this activity is significant as it can
  indicate an attempt to gather domain policy information, which is often a precursor
  to further malicious actions. If confirmed malicious, this activity could allow
  an attacker to understand password policies, aiding in password attacks or further
  domain enumeration.
required_fields:
- _time
- EventCode
- Message
- ComputerName
- User
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText ="*Get-ADDefaultDomainPasswordPolicy*" | stats count
  min(_time) as firstTime max(_time) as lastTime by EventCode ScriptBlockText Computer
  UserID | rename Computer as dest, UserID as user |  convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `get_addefaultdomainpasswordpolicy_with_powershell_script_block_filter`
