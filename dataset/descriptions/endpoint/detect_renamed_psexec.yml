description: The following analytic identifies instances where `PsExec.exe` has been
  renamed and executed on an endpoint. It leverages data from Endpoint Detection and
  Response (EDR) agents, focusing on process names and original file names. This activity
  is significant because renaming `PsExec.exe` is a common tactic to evade detection.
  If confirmed malicious, this could allow an attacker to execute commands remotely,
  potentially leading to unauthorized access, lateral movement, or further compromise
  of the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name!=psexec.exe AND
  Processes.process_name!=psexec64.exe) AND Processes.original_file_name=psexec.c
  by Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id Processes.original_file_name
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `detect_renamed_psexec_filter`'
