description: The following analytic detects the loading of an unsigned DLL by the
  MMC.exe application, which is indicative of a potential UAC bypass or privilege
  escalation attempt. It leverages Sysmon EventCode 7 to identify instances where
  MMC.exe loads a non-Microsoft, unsigned DLL. This activity is significant because
  attackers often use this technique to modify CLSID registry entries, causing MMC.exe
  to load malicious DLLs, thereby bypassing User Account Control (UAC) and gaining
  elevated privileges. If confirmed malicious, this could allow an attacker to execute
  arbitrary code with higher privileges, leading to further system compromise and
  persistence.
required_fields:
- _time
- Image
- ImageLoaded
- Signed
- ProcessId
- OriginalFileName
- dest
- EventCode
- Company
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=7  ImageLoaded = "*.dll" Image
  = "*\\mmc.exe" Signed=false Company != "Microsoft Corporation" | stats count min(_time)
  as firstTime max(_time) as lastTime by Image ImageLoaded Signed ProcessId OriginalFileName
  dest EventCode Company | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) |
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `uac_bypass_mmc_load_unsigned_dll_filter`
