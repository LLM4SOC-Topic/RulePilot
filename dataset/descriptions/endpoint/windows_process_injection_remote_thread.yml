description: The following analytic detects suspicious remote thread execution in
  processes such as Taskmgr.exe, calc.exe, and notepad.exe, which may indicate process
  injection by malware like Qakbot. This detection leverages Sysmon EventCode 8 to
  identify remote thread creation in specific target processes. This activity is significant
  as it often signifies an attempt by malware to inject malicious code into legitimate
  processes, potentially leading to unauthorized code execution. If confirmed malicious,
  this could allow attackers to execute arbitrary code, escalate privileges, or maintain
  persistence on the compromised host.
required_fields:
- _time
- SourceImage
- TargetImage
- TargetProcessId
- SourceProcessId
- StartAddress
- EventCode
- dest
- signature
- TargetProcessGuid
- SourceProcessGuid
- StartAddress
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=8 TargetImage IN ("*\\Taskmgr.exe",
  "*\\calc.exe", "*\\notepad.exe", "*\\rdpclip.exe", "*\\explorer.exe", "*\\wermgr.exe",
  "*\\ping.exe", "*\\OneDriveSetup.exe", "*\\dxdiag.exe", "*\\mobsync.exe", "*\\msra.exe",
  "*\\xwizard.exe","*\\cmd.exe", "*\\powershell.exe") | stats count min(_time) as
  firstTime max(_time) as lastTime by  TargetImage TargetProcessId SourceProcessId  EventCode
  StartAddress SourceImage dest | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_process_injection_remote_thread_filter`
