description: The following analytic detects the use of PowerShell's `DownloadString`
  method to download files. It leverages data from Endpoint Detection and Response
  (EDR) agents, focusing on process execution logs that include command-line details.
  This activity is significant because `DownloadString` is commonly used in malicious
  PowerShell scripts to fetch and execute remote code. If confirmed malicious, this
  behavior could allow an attacker to download and run arbitrary code, potentially
  leading to unauthorized access, data exfiltration, or further compromise of the
  affected system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=pwsh.exe OR Processes.process_name=sqlps.exe
  OR Processes.process_name=sqltoolsps.exe OR Processes.process_name=powershell.exe
  OR Processes.process_name=powershell_ise.exe OR Processes.original_file_name=pwsh.dll
  OR Processes.original_file_name=PowerShell.EXE OR Processes.original_file_name=powershell_ise.EXE)
  Processes.process=*.DownloadString*  by Processes.dest Processes.user Processes.parent_process
  Processes.parent_process_name Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| `any_powershell_downloadstring_filter`'
