description: The following analytic detects a process enabling the "SeDebugPrivilege"
  privilege token. It leverages Windows Security Event Logs with EventCode 4703, filtering
  out common legitimate processes. This activity is significant because SeDebugPrivilege
  allows a process to inspect and modify the memory of other processes, potentially
  leading to credential dumping or code injection. If confirmed malicious, an attacker
  could gain extensive control over system processes, enabling them to escalate privileges,
  persist in the environment, or access sensitive information.
required_fields:
- _time
- ProcessName
- Security_ID
- action
- result
- Process_ID
- Message
- member_dn
- ComputerName
- user
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=4703 EnabledPrivilegeList = "*SeDebugPrivilege*" AND NOT(ProcessName IN
  ("*\\Program File*", "*\\System32\\lsass.exe*", "*\\SysWOW64\\lsass.exe*", "*\\SysWOW64\\svchost.exe*",
  "*\\System32\\svchost.exe*")) | stats count min(_time) as firstTime max(_time) as
  lastTime by Computer ProcessName ProcessId SubjectDomainName SubjectUserName SubjectUserSid
  TargetUserName TargetLogonId TargetDomainName EnabledPrivilegeList action | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_access_token_manipulation_sedebugprivilege_filter`
