description: The following analytic detects the execution of the `Get-DomainGroupMember`
  cmdlet from PowerView, identified through PowerShell Script Block Logging (EventCode=4104).
  This cmdlet is used to enumerate members of elevated domain groups such as Domain
  Admins and Enterprise Admins. Monitoring this activity is crucial as it indicates
  potential reconnaissance efforts by adversaries to identify high-privileged users
  within the domain. If confirmed malicious, this activity could lead to targeted
  attacks on privileged accounts, facilitating further compromise and lateral movement
  within the network.
required_fields:
- _time
- EventCode
- ScriptBlockText
- Computer
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 (ScriptBlockText = "*Get-DomainGroupMember*") AND ScriptBlockText
  IN ("*Domain Admins*","*Enterprise Admins*", "*Schema Admins*", "*Account Operators*"
  , "*Server Operators*", "*Protected Users*",  "*Dns Admins*") | stats count min(_time)
  as firstTime max(_time) as lastTime by EventCode ScriptBlockText Computer UserID
  | rename Computer as dest, UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `elevated_group_discovery_with_powerview_filter`
