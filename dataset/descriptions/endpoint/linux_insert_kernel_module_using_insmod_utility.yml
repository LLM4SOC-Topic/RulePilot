description: The following analytic detects the insertion of a Linux kernel module
  using the insmod utility. It leverages data from Endpoint Detection and Response
  (EDR) agents, focusing on process execution logs that include process names and
  command-line details. This activity is significant as it may indicate the installation
  of a rootkit or malicious kernel module, potentially allowing an attacker to gain
  elevated privileges and bypass security detections. If confirmed malicious, this
  could lead to unauthorized code execution, persistent access, and severe compromise
  of the affected system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name IN("kmod", "sudo")
  AND Processes.process = *insmod* by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  Processes.process_guid | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `linux_insert_kernel_module_using_insmod_utility_filter`'
