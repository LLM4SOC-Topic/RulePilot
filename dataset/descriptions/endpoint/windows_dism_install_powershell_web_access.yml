description: The following analytic detects the installation of PowerShell Web Access
  using the Deployment Image Servicing and Management (DISM) tool. It leverages Sysmon
  EventID 1 to identify the execution of `dism.exe` with specific parameters related
  to enabling the WindowsPowerShellWebAccess feature. This activity is significant
  because enabling PowerShell Web Access can facilitate remote execution of PowerShell
  commands, potentially allowing an attacker to gain unauthorized access to systems
  and networks. If confirmed malicious, this action could lead to further exploitation
  and compromise of the affected system.
required_fields:
- _time
- dest
- user
- parent_process_name
- process_name
- original_file_name
- process
- process_id
- parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=dism.exe (Processes.process="*WindowsPowerShellWebAccess*"
  AND Processes.process="*/online*" AND Processes.process="*/enable-feature*") by
  Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.original_file_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_dism_install_powershell_web_access_filter`'
