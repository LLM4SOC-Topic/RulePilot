description: The following analytic detects the use of CertUtil.exe with the 'decode'
  argument, which may indicate an attempt to decode a previously encoded file, potentially
  containing malicious payloads. This detection leverages data from Endpoint Detection
  and Response (EDR) agents, focusing on command-line executions involving CertUtil.exe.
  This activity is significant because attackers often use CertUtil to decode malicious
  files downloaded from the internet, which are then executed to compromise the system.
  If confirmed malicious, this activity could lead to unauthorized code execution,
  further system compromise, and potential data exfiltration.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=certutil.exe OR
  Processes.original_file_name=CertUtil.exe) Processes.process=*decode* by Processes.dest
  Processes.user Processes.parent_process Processes.parent_process_name Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `certutil_with_decode_argument_filter`'
