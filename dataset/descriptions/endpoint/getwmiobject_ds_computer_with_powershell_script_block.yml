description: The following analytic detects the execution of the `Get-WmiObject` cmdlet
  with the `DS_Computer` class parameter via PowerShell Script Block Logging (EventCode=4104).
  This detection leverages script block text to identify queries targeting domain
  computers using WMI. Monitoring this activity is crucial as adversaries and Red
  Teams may use it for Active Directory Discovery and situational awareness. If confirmed
  malicious, this behavior could allow attackers to map out domain computers, facilitating
  further attacks such as lateral movement or privilege escalation.
required_fields:
- _time
- ScriptBlockText
- Opcode
- Computer
- UserID
- EventCode
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 (ScriptBlockText=*Get-WmiObject* AND ScriptBlockText="*namespace
  root\\directory\\ldap*" AND ScriptBlockText="*class ds_computer*") | stats count
  min(_time) as firstTime max(_time) as lastTime by Opcode Computer UserID EventCode
  ScriptBlockText | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `getwmiobject_ds_computer_with_powershell_script_block_filter`
