description: The following analytic detects a suspicious modification to the Windows
  Update configuration registry key, specifically targeting the UpdateServiceUrlAlternate
  setting. It leverages data from the Endpoint.Registry datamodel to identify changes
  to this registry path. This activity is significant because adversaries, including
  malware like RedLine Stealer, exploit this technique to bypass detection and deploy
  additional payloads. If confirmed malicious, this modification could allow attackers
  to redirect update services, potentially leading to the execution of malicious code,
  further system compromise, and persistent evasion of security defenses.
required_fields:
- _time
- Registry.registry_key_name
- Registry.registry_path
- Registry.user
- Registry.dest
- Registry.registry_value_name
- Registry.action
- Registry.registry_value_data
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Registry where Registry.registry_path="*\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\UpdateServiceUrlAlternate"
  by Registry.dest Registry.user Registry.registry_path Registry.registry_value_data
  Registry.registry_key_name | `drop_dm_object_name(Registry)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_modify_registry_updateserviceurlalternate_filter`'
