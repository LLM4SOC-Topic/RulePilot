description: The following analytic detects programs initiated by pcalua.exe, the
  Microsoft Windows Program Compatibility Assistant. This detection leverages data
  from Endpoint Detection and Response (EDR) agents, focusing on process and parent
  process information. While pcalua.exe can start legitimate programs, it is significant
  because attackers may use it to bypass command line execution protections. If confirmed
  malicious, this activity could allow attackers to execute arbitrary commands, potentially
  leading to unauthorized actions, privilege escalation, or persistence within the
  environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
- Processes.process_path
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process="*pcalua* -a*"
  by Processes.dest Processes.user Processes.parent_process Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  Processes.process_path | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_indirect_command_execution_via_pcalua_filter`'
