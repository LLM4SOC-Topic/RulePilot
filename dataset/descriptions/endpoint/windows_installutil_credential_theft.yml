description: The following analytic detects instances where the Windows InstallUtil.exe
  binary loads `vaultcli.dll` and `Samlib.dll`. This detection leverages Sysmon EventCode
  7 to identify these specific DLL loads. This activity is significant because it
  can indicate an attempt to execute code that bypasses application control and captures
  credentials using tools like Mimikatz. If confirmed malicious, this behavior could
  allow an attacker to steal credentials, potentially leading to unauthorized access
  and further compromise of the system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=7 process_name=installutil.exe
  loaded_file_path IN ("*\\samlib.dll", "*\\vaultcli.dll") | stats count min(_time)
  as firstTime max(_time) as lastTime by user_id, dest, process_name, loaded_file,
  loaded_file_path, original_file_name, process_guid | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_installutil_credential_theft_filter`
