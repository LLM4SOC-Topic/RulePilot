description: The following analytic detects attempts to add a certificate to the untrusted
  certificate store using the 'certutil -addstore' command. It leverages process activity
  and command-line arguments from Endpoint Detection and Response (EDR) logs mapped
  to the Splunk `Processes` data model. This activity is significant as it may indicate
  an attacker trying to disable security tools to gain unauthorized access. If confirmed
  malicious, this could lead to the compromise of system security, allowing attackers
  to bypass defenses and potentially escalate privileges or persist in the environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.parent_process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime values(Processes.process)
  as process max(_time) as lastTime from datamodel=Endpoint.Processes where (Processes.process_name=certutil.exe
  OR Processes.original_file_name=CertUtil.exe) (Processes.process=*-addstore*) by
  Processes.dest Processes.user Processes.parent_process Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name("Processes")` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  |convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `attempt_to_add_certificate_to_untrusted_store_filter`'
