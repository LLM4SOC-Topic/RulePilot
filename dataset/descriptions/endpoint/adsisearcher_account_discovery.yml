description: The following analytic detects the use of the `[Adsisearcher]` type accelerator
  in PowerShell to query Active Directory for domain users. It leverages PowerShell
  Script Block Logging (EventCode=4104) to identify script blocks containing `[adsisearcher]`,
  `objectcategory=user`, and `.findAll()`. This activity is significant as it may
  indicate an attempt by adversaries or Red Teams to enumerate domain users for situational
  awareness and Active Directory discovery. If confirmed malicious, this could lead
  to further reconnaissance, privilege escalation, or lateral movement within the
  network.
required_fields:
- _time
- EventCode
- Message
- ComputerName
- User
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*[adsisearcher]*" ScriptBlockText = "*objectcategory=user*"
  ScriptBlockText = "*.findAll()*" | stats count min(_time) as firstTime max(_time)
  as lastTime by EventCode Computer ScriptBlockText UserID | rename Computer as dest,
  UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `adsisearcher_account_discovery_filter`
