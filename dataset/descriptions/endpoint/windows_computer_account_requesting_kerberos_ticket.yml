description: The following analytic detects a computer account requesting a Kerberos
  ticket, which is unusual as typically user accounts request these tickets. This
  detection leverages Windows Security Event Logs, specifically EventCode 4768, to
  identify instances where the TargetUserName ends with a dollar sign ($), indicating
  a computer account. This activity is significant because it may indicate the use
  of tools like KrbUpRelay or other Kerberos-based attacks. If confirmed malicious,
  this could allow attackers to impersonate computer accounts, potentially leading
  to unauthorized access and lateral movement within the network.
required_fields:
- _time
- dest
- subject
- action
- Supplied_Realm_Name
- user
- Account_Name
- src_ip
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security  EventCode=4768
  TargetUserName="*$"  src_ip!="::1" | stats  count min(_time) as firstTime max(_time)
  as lastTime by dest, subject, action, user, TargetUserName, src_ip | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_computer_account_requesting_kerberos_ticket_filter`
