description: The following analytic detects when a Windows service is modified from
  a start type to disabled. It leverages system event logs, specifically EventCode
  7040, to identify this change. This activity is significant because adversaries
  often disable security or other critical services to evade detection and maintain
  control over a compromised host. If confirmed malicious, this action could allow
  attackers to bypass security defenses, leading to further exploitation and persistence
  within the environment.
required_fields:
- _time
- ComputerName
- EventCode
- Message
- User
- Sid
rule: eventtype=wineventlog_system EventCode=7040  EventData_Xml="*disabled*" | stats
  count min(_time) as firstTime max(_time) as lastTime by Computer EventCode Name
  UserID service ServiceName | rename Computer as dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_event_for_service_disabled_filter`
