description: The following analytic detects modifications to the Windows RunMRU registry
  key, which stores a history of commands executed through the Run dialog box (Windows+R).
  It leverages Endpoint Detection and Response (EDR) telemetry to monitor registry
  events targeting this key. This activity is significant as malware often uses the
  Run dialog to execute malicious commands while attempting to appear legitimate.
  If confirmed malicious, this could indicate an attacker using indirect command execution
  techniques for defense evasion or persistence. The detection excludes MRUList value
  changes to focus on actual command entries.
required_fields:
- _time
- Registry.dest
- Registry.registry_value_data
- Registry.action
- Registry.process_guid
- Registry.process_id
- Registry.registry_key_name
- Registry.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Registry where Registry.registry_key_name="*\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU*"
  NOT Registry.registry_key_name="*\\MRUList" by Registry.dest Registry.registry_value_data
  Registry.action  Registry.process_guid Registry.process_id Registry.registry_key_name
  Registry.user | `drop_dm_object_name(Registry)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_runmru_command_execution_filter`'
