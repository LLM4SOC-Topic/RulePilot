description: The following analytic identifies the creation of WMI Event Subscriptions,
  which can be used to establish persistence or perform privilege escalation. It detects
  EventID 19 (EventFilter creation), EventID 20 (EventConsumer creation), and EventID
  21 (FilterToConsumerBinding creation) from Sysmon logs. This activity is significant
  because WMI Event Subscriptions can execute code with elevated SYSTEM privileges,
  making it a powerful persistence mechanism. If confirmed malicious, an attacker
  could maintain long-term access, escalate privileges, and execute arbitrary code,
  posing a severe threat to the environment.
required_fields:
- _time
- Destination
- dest
- User
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventID=20 | stats count min(_time) as
  firstTime max(_time) as lastTime by Computer User Destination | rename Computer
  as dest | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `detect_wmi_event_subscription_persistence_filter`
