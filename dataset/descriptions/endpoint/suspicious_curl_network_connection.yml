description: The following analytic detects the use of the curl command contacting
  suspicious remote domains, such as s3.amazonaws.com, which is indicative of Command
  and Control (C2) activity or downloading further implants. This detection leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process execution
  logs and command-line arguments. This activity is significant as it may indicate
  the presence of MacOS adware or other malicious software attempting to establish
  persistence or exfiltrate data. If confirmed malicious, this could allow attackers
  to maintain control over the compromised system and deploy additional payloads.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=curl Processes.process=s3.amazonaws.com
  by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `suspicious_curl_network_connection_filter`'
