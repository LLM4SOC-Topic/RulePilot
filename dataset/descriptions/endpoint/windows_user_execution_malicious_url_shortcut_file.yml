description: The following analytic detects the creation of suspicious URL shortcut
  link files, often used by malware like CHAOS ransomware. It leverages the Endpoint.Filesystem
  datamodel to identify .url files created outside standard directories, such as Program
  Files. This activity is significant as it may indicate an attempt to execute malicious
  code upon system reboot. If confirmed malicious, this could allow an attacker to
  achieve persistence and execute harmful payloads, potentially leading to further
  system compromise and data loss.
required_fields:
- _time
- Filesystem.file_create_time
- Filesystem.process_id
- Filesystem.file_name
- Filesystem.user
- Filesystem.file_path
- Filesystem.process_guid
- Filesystem.dest
rule: '|tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Filesystem where NOT(Filesystem.file_path IN ("*\\Program
  Files*")) Filesystem.file_name = *.url by Filesystem.file_create_time Filesystem.process_id  Filesystem.file_name
  Filesystem.user Filesystem.file_path Filesystem.process_guid Filesystem.dest | `drop_dm_object_name(Filesystem)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_user_execution_malicious_url_shortcut_file_filter`'
