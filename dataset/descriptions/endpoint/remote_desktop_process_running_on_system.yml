description: The following analytic detects the execution of the remote desktop process
  (mstsc.exe) on systems where it is not typically run. This detection leverages data
  from Endpoint Detection and Response (EDR) agents, filtering out systems categorized
  as common RDP sources. This activity is significant because unauthorized use of
  mstsc.exe can indicate lateral movement or unauthorized remote access attempts.
  If confirmed malicious, this could allow an attacker to gain remote control of a
  system, potentially leading to data exfiltration, privilege escalation, or further
  network compromise.
required_fields:
- _time
- Processes.process
- Processes.dest_category
- Processes.dest
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process=*mstsc.exe AND Processes.dest_category!=common_rdp_source
  by Processes.dest Processes.user Processes.process | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `drop_dm_object_name(Processes)`
  | `remote_desktop_process_running_on_system_filter`'
