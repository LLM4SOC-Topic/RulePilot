description: The following analytic detects the creation of new user accounts on Linux
  systems using commands like "useradd" or "adduser." It leverages data from Endpoint
  Detection and Response (EDR) agents, focusing on process names and command-line
  executions. This activity is significant as adversaries often create new user accounts
  to establish persistence on compromised hosts. If confirmed malicious, this could
  allow attackers to maintain access, escalate privileges, and further compromise
  the system, posing a severe security risk.
required_fields:
- _time
- proctitle
rule: sourcetype="linux:audit" type=PROCTITLE | eval normalized_proctitle_delimiter
  = if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(proctitle,"^[0-9A-F]+$"),
  replace(proctitle, "000", "020"),proctitle),null()) | eval normalized_proctitle_delimiter  =
  if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),
  replace(normalized_proctitle_delimiter, "00", "20"),normalized_proctitle_delimiter),null())
  | eval process_exec = if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),urldecode(replace(normalized_proctitle_delimiter,"([0-9A-F]{2})","%\1")),normalized_proctitle_delimiter)|
  rename host as dest | where LIKE (process_exec, "%useradd%") OR LIKE (process_exec,
  "%adduser%") | stats count min(_time) as firstTime max(_time) as lastTime by process_exec
  proctitle dest  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert
  timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `linux_auditd_add_user_account_filter`
