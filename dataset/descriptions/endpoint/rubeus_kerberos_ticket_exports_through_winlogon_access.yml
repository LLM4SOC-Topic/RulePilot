description: The following analytic detects a process accessing the winlogon.exe system
  process, indicative of the Rubeus tool attempting to export Kerberos tickets from
  memory. This detection leverages Sysmon EventCode 10 logs, focusing on processes
  obtaining a handle to winlogon.exe with specific access rights. This activity is
  significant as it often precedes pass-the-ticket attacks, where adversaries use
  stolen Kerberos tickets to move laterally within an environment. If confirmed malicious,
  this could allow attackers to bypass normal access controls, escalate privileges,
  and persist within the network, posing a severe security risk.
required_fields:
- _time
- EventCode
- TargetImage
- CallTrace
- dest
- TargetProcessId
- SourceImage
- SourceProcessId
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=10 TargetImage=C:\\Windows\\system32\\winlogon.exe
  (GrantedAccess=0x1f3fff) (SourceImage!=C:\\Windows\\system32\\svchost.exe AND SourceImage!=C:\\Windows\\system32\\lsass.exe
  AND SourceImage!=C:\\Windows\\system32\\LogonUI.exe AND SourceImage!=C:\\Windows\\system32\\smss.exe
  AND SourceImage!=C:\\Windows\\system32\\wbem\\wmiprvse.exe) | stats count min(_time)
  as firstTime max(_time) as lastTime by dest, SourceImage, SourceProcessId, TargetImage,
  TargetProcessId, EventCode, GrantedAccess  | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `rubeus_kerberos_ticket_exports_through_winlogon_access_filter`
