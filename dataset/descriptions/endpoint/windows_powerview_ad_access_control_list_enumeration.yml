description: The following analytic detects the execution of PowerView PowerShell
  cmdlets `Get-ObjectAcl` or `Get-DomainObjectAcl`, which are used to enumerate Access
  Control List (ACL) permissions for Active Directory objects. It leverages Event
  ID 4104 from PowerShell Script Block Logging to identify this activity. This behavior
  is significant as it may indicate an attempt to discover weak permissions in Active
  Directory, potentially leading to privilege escalation. If confirmed malicious,
  attackers could exploit these permissions to gain unauthorized access or escalate
  their privileges within the network.
required_fields:
- _time
- EventCode
- ScriptBlockText
- Opcode
- UserID
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104  (ScriptBlockText=*get-objectacl* OR ScriptBlockText=*Get-DomainObjectAcl*
  ) | stats count min(_time) as firstTime max(_time) as lastTime by Opcode Computer
  UserID EventCode ScriptBlockText | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_powerview_ad_access_control_list_enumeration_filter`
