description: The following analytic identifies the execution of msdtc.exe with specific
  command-line parameters (-a or -b), which are indicative of the PlugX malware. This
  detection leverages data from Endpoint Detection and Response (EDR) agents, focusing
  on process names and command-line arguments. This activity is significant because
  PlugX uses these parameters to masquerade its malicious operations within legitimate
  processes, making it harder to detect. If confirmed malicious, this behavior could
  allow attackers to gain unauthorized access, exfiltrate data, and conduct espionage,
  severely compromising the affected system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name = "msdtc.exe" Processes.process
  = "*msdtc.exe*" Processes.process IN ("* -a*", "* -b*") by Processes.dest Processes.user
  Processes.parent_process_name Processes.parent_process Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_masquerading_msdtc_process_filter`'
