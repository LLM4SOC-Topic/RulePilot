description: The following analytic detects the use of Certify or Certipy tools to
  enumerate Active Directory Certificate Services (AD CS) environments. It leverages
  Endpoint Detection and Response (EDR) data, focusing on specific command-line arguments
  associated with these tools. This activity is significant because it indicates potential
  reconnaissance or exploitation attempts targeting AD CS, which could lead to unauthorized
  access or privilege escalation. If confirmed malicious, attackers could gain insights
  into the AD CS infrastructure, potentially compromising sensitive certificates and
  escalating their privileges within the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process IN ("* find *","* auth
  *","* request *","* req *","* download *",) AND Processes.process IN ("* /vulnerable*","*
  /enrolleeSuppliesSubject *","* /json /outfile*","* /ca*", "* -username *","* -u
  *") by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| `detect_certify_command_line_arguments_filter`'
