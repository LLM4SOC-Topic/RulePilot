description: The following analytic detects the execution of the `Get-DomainComputer`
  commandlet using PowerShell Script Block Logging (EventCode=4104). This commandlet
  is part of PowerView, a tool often used for enumerating domain computers within
  Windows environments. The detection leverages script block text analysis to identify
  this specific command. Monitoring this activity is crucial as it can indicate an
  adversary's attempt to gather information about domain computers, which is a common
  step in Active Directory reconnaissance. If confirmed malicious, this activity could
  lead to further network enumeration and potential lateral movement within the domain.
required_fields:
- _time
- ScriptBlockText
- Opcode
- Computer
- UserID
- EventCode
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 (ScriptBlockText = "*Get-DomainComputer*") | stats count min(_time)
  as firstTime max(_time) as lastTime by Opcode Computer UserID EventCode ScriptBlockText
  | rename Computer as dest | rename UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `getdomaincomputer_with_powershell_script_block_filter`
