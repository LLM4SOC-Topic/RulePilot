description: The following analytic detects the modification of file or directory
  permissions using the takeown.exe Windows application. It leverages data from Endpoint
  Detection and Response (EDR) agents, focusing on process execution logs that include
  process GUID, process name, and command-line details. This activity is significant
  because it is a common technique used by ransomware to take ownership of files or
  folders for encryption or deletion. If confirmed malicious, this could lead to unauthorized
  access, data encryption, or data destruction, severely impacting the integrity and
  availability of critical data.
required_fields:
- _time
- Processes.parent_process_name
- Processes.parent_process
- Processes.process_name
- Processes.process
- Processes.dest
- Processes.user
- Processes.process_id
- Processes.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name = "takeown.exe" Processes.process
  = "*/f*" by Processes.parent_process_name Processes.parent_process Processes.process_name
  Processes.process Processes.dest Processes.user Processes.process_id Processes.process_guid
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `permission_modification_using_takeown_app_filter`'
