description: The following analytic detects the execution of reg.exe with parameters
  that export registry keys containing hashed credentials. It leverages data from
  Endpoint Detection and Response (EDR) agents, focusing on command-line executions
  involving reg.exe or cmd.exe with specific registry paths. This activity is significant
  because exporting these keys can allow attackers to obtain hashed credentials, which
  they may attempt to crack offline. If confirmed malicious, this could lead to unauthorized
  access to sensitive accounts, enabling further compromise and lateral movement within
  the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=reg* OR Processes.process_name=cmd*
  Processes.process=*save* (Processes.process=*HKEY_LOCAL_MACHINE\\Security* OR Processes.process=*HKEY_LOCAL_MACHINE\\SAM*
  OR Processes.process=*HKEY_LOCAL_MACHINE\\System* OR Processes.process=*HKLM\\Security*
  OR Processes.process=*HKLM\\System* OR Processes.process=*HKLM\\SAM*) by Processes.dest
  Processes.user Processes.parent_process Processes.parent_process_name  Processes.process_name
  Processes.original_file_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)|
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `attempted_credential_dump_from_registry_via_reg_exe_filter`'
