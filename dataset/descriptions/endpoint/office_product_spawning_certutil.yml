description: The following analytic detects any Windows Office Product spawning `certutil.exe`,
  a behavior often associated with malware families like TA551 and IcedID. This detection
  leverages Endpoint Detection and Response (EDR) data, focusing on process relationships
  and command-line executions. The significance lies in the fact that `certutil.exe`
  is frequently used for downloading malicious payloads from remote URLs. If confirmed
  malicious, this activity could lead to unauthorized code execution, data exfiltration,
  or further system compromise. Immediate investigation and containment are crucial
  to prevent potential damage.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name IN ("winword.exe","excel.exe","powerpnt.exe","mspub.exe","visio.exe","onenote.exe","onenotem.exe","onenoteviewer.exe","onenoteim.exe","msaccess.exe",
  "Graph.exe","winproj.exe") (Processes.process_name=certutil.exe OR Processes.original_file_name=CertUtil.exe)
  by Processes.dest Processes.user Processes.parent_process_name Processes.parent_process
  Processes.process_name Processes.original_file_name Processes.process Processes.process_id
  Processes.parent_process_id | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `office_product_spawning_certutil_filter`'
