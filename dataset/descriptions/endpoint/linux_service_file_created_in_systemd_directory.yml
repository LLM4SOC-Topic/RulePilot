description: The following analytic detects the creation of suspicious service files
  within the systemd directories on Linux platforms. It leverages logs containing
  file name, file path, and process GUID data from endpoints. This activity is significant
  for a SOC as it may indicate an adversary attempting to establish persistence on
  a compromised host. If confirmed malicious, this could lead to system compromise
  or data exfiltration, allowing attackers to maintain control over the system and
  execute further malicious activities.
required_fields:
- _time
- Filesystem.dest
- Filesystem.file_create_time
- Filesystem.file_name
- Filesystem.process_guid
- Filesystem.file_path
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  FROM datamodel=Endpoint.Filesystem where Filesystem.file_name = *.service Filesystem.file_path
  IN ("*/etc/systemd/system*", "*/lib/systemd/system*", "*/usr/lib/systemd/system*",
  "*/run/systemd/system*", "*~/.config/systemd/*", "*~/.local/share/systemd/*","*/etc/systemd/user*",
  "*/lib/systemd/user*", "*/usr/lib/systemd/user*", "*/run/systemd/user*") by Filesystem.dest
  Filesystem.file_create_time Filesystem.file_name Filesystem.process_guid Filesystem.file_path
  | `drop_dm_object_name(Filesystem)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `linux_service_file_created_in_systemd_directory_filter`'
