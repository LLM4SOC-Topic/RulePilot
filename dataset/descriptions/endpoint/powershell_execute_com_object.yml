description: The following analytic detects the execution of a COM CLSID through PowerShell.
  It leverages EventCode 4104 and searches for specific script block text indicating
  the creation of a COM object. This activity is significant as it is commonly used
  by adversaries and malware, such as the Conti ransomware, to execute commands, potentially
  for privilege escalation or bypassing User Account Control (UAC). If confirmed malicious,
  this technique could allow attackers to gain elevated privileges or persist within
  the environment, posing a significant security risk.
required_fields:
- _time
- ScriptBlockText
- Computer
- EventCode
rule: (source=WinEventLog:Microsoft-Windows-PowerShell/Operational OR source="XmlWinEventLog:Microsoft-Windows-PowerShell/Operational")
  EventCode=4104 ScriptBlockText = "*CreateInstance([type]::GetTypeFromCLSID*" | stats
  count min(_time) as firstTime max(_time) as lastTime by EventCode ScriptBlockText
  Computer UserID | rename Computer as dest | rename UserID as user | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `powershell_execute_com_object_filter`
