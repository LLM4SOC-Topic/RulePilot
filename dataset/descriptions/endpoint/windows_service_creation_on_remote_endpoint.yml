description: The following analytic identifies the creation of a Windows Service on
  a remote endpoint using `sc.exe`. It detects this activity by analyzing process
  execution logs from Endpoint Detection and Response (EDR) agents, focusing on command-line
  arguments that include remote paths and service creation commands. This behavior
  is significant because adversaries often exploit the Service Control Manager for
  lateral movement and remote code execution. If confirmed malicious, this activity
  could allow attackers to execute arbitrary code on remote systems, potentially leading
  to further compromise and persistence within the network.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=sc.exe OR Processes.original_file_name=sc.exe)
  (Processes.process=*\\\\* AND Processes.process=*create* AND Processes.process=*binpath*)
  by Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_service_creation_on_remote_endpoint_filter`'
