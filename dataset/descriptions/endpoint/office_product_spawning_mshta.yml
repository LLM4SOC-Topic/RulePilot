description: The following analytic identifies instances where a Microsoft Office
  product spawns `mshta.exe`. This detection leverages data from Endpoint Detection
  and Response (EDR) agents, focusing on process creation events where the parent
  process is an Office application. This activity is significant because it is a common
  technique used by malware families like TA551 and IcedID to execute malicious scripts
  or payloads. If confirmed malicious, this behavior could allow attackers to execute
  arbitrary code, potentially leading to data exfiltration, system compromise, or
  further malware deployment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name IN ("winword.exe","excel.exe","powerpnt.exe","mspub.exe","visio.exe",
  "onenote.exe","onenotem.exe", "msaccess.exe","Graph.exe","winproj.exe") (Processes.process_name=mshta.exe
  OR Processes.original_file_name=MSHTA.EXE) by Processes.dest Processes.user Processes.parent_process_name
  Processes.parent_process Processes.process_name Processes.original_file_name Processes.process
  Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `office_product_spawning_mshta_filter`'
