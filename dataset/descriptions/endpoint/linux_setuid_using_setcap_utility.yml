description: The following analytic detects the execution of the 'setcap' utility
  to enable the SUID bit on Linux systems. It leverages Endpoint Detection and Response
  (EDR) data, focusing on process names and command-line arguments that indicate the
  use of 'setcap' with specific capabilities. This activity is significant because
  setting the SUID bit allows a user to temporarily gain root access, posing a substantial
  security risk. If confirmed malicious, an attacker could escalate privileges, execute
  arbitrary commands with elevated permissions, and potentially compromise the entire
  system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name = setcap OR Processes.process
  = "*setcap *") AND Processes.process IN ("* cap_setuid=ep *", "* cap_setuid+ep *",
  "* cap_net_bind_service+p *", "* cap_net_raw+ep *", "* cap_dac_read_search+ep *")
  by Processes.dest Processes.user Processes.parent_process_name Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id Processes.process_guid
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `linux_setuid_using_setcap_utility_filter`'
