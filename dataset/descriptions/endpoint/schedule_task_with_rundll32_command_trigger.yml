description: The following analytic detects the creation of scheduled tasks in Windows
  that use the rundll32 command. It leverages Windows Security EventCode 4698, which
  logs the creation of scheduled tasks, and filters for tasks executed via rundll32.
  This activity is significant as it is a common technique used by malware, such as
  TrickBot, to persist in an environment or deliver additional payloads. If confirmed
  malicious, this could lead to data theft, ransomware deployment, or other damaging
  outcomes. Immediate investigation and mitigation are crucial to prevent further
  compromise.
required_fields:
- _time
- dest
- Task_Name
- Command
- Author
- Enabled
- Hidden
- Arguments
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=4698 | xmlkv Message | search Command IN ("*rundll32*") | stats count
  min(_time) as firstTime max(_time) as lastTime by dest, Task_Name, Command, Author,
  Enabled, Hidden, Arguments | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `schedule_task_with_rundll32_command_trigger_filter`
