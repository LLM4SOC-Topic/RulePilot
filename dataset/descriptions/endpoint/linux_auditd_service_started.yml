description: The following analytic detects the suspicious service started. This behavior
  is critical for a SOC to monitor because it may indicate attempts to gain unauthorized
  access or maintain control over a system. Such actions could be signs of malicious
  activity. If confirmed, this could lead to serious consequences, including a compromised
  system, unauthorized access to sensitive data, or even a wider breach affecting
  the entire network. Detecting and responding to these signs early is essential to
  prevent potential security incidents.
required_fields:
- _time
- proctitle
rule: sourcetype="linux:audit" type=PROCTITLE | eval normalized_proctitle_delimiter
  = if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(proctitle,"^[0-9A-F]+$"),
  replace(proctitle, "000", "020"),proctitle),null()) | eval normalized_proctitle_delimiter  =
  if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),
  replace(normalized_proctitle_delimiter, "00", "20"),normalized_proctitle_delimiter),null())
  | eval process_exec = if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),urldecode(replace(normalized_proctitle_delimiter,"([0-9A-F]{2})","%\1")),normalized_proctitle_delimiter)
  | rename host as dest | where (LIKE(process_exec, "%systemctl %") OR LIKE(process_exec,
  "%service %") ) AND(LIKE(process_exec, "% start %") OR LIKE(process_exec, "% enable
  %")) | stats count min(_time) as firstTime max(_time) as lastTime by process_exec
  proctitle normalized_proctitle_delimiter dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `linux_auditd_service_started_filter`
