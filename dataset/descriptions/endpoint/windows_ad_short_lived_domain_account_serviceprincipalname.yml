description: The following analytic identifies the addition and quick deletion of
  a Service Principal Name (SPN) to a domain account within 5 minutes. This detection
  leverages EventCode 5136 from the Windows Security Event Log, focusing on changes
  to the servicePrincipalName attribute. This activity is significant as it may indicate
  an attempt to perform Kerberoasting, a technique used to crack the cleartext password
  of a domain account offline. If confirmed malicious, this could allow an attacker
  to gain unauthorized access to sensitive information or escalate privileges within
  the domain environment.
required_fields:
- _time
- EventCode
- ObjectDN
- signature
- SubjectUserName
- Computer
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=5136 AttributeLDAPDisplayName=servicePrincipalName | transaction ObjectDN
  AttributeValue startswith=(EventCode=5136 OperationType="%%14674") endswith=(EventCode=5136
  OperationType="%%14675") | eval short_lived=case((duration<300),"TRUE") | search
  short_lived = TRUE | rename ObjectDN as user | `windows_ad_short_lived_domain_account_serviceprincipalname_filter`
