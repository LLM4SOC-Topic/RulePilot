description: The following analytic detects a suspicious modification to the Windows
  Defender Tamper Protection registry setting. It leverages data from the Endpoint
  datamodel, specifically targeting changes where the registry path is set to disable
  Tamper Protection. This activity is significant because disabling Tamper Protection
  can allow adversaries to make further undetected changes to Windows Defender settings,
  potentially leading to reduced security on the system. If confirmed malicious, this
  could enable attackers to evade detection, persist in the environment, and execute
  further malicious activities without interference from Windows Defender.
required_fields:
- _time
- Registry.registry_key_name
- Registry.registry_path
- Registry.user
- Registry.dest
- Registry.registry_value_name
- Registry.action
- Registry.registry_value_data
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Registry where Registry.registry_path="*\\SOFTWARE\\Microsoft\\Windows
  Defender\\Features\\TamperProtection" AND Registry.registry_value_data="0x00000000"
  by Registry.dest Registry.user Registry.registry_path Registry.registry_value_data
  Registry.registry_key_name | `drop_dm_object_name(Registry)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_modify_registry_tamper_protection_filter`'
