description: The following analytic detects potential Kerberoasting attacks by identifying
  Kerberos service ticket requests with RC4 encryption through Event ID 4769. It leverages
  specific Ticket_Options values commonly used by Kerberoasting tools. This activity
  is significant as Kerberoasting allows attackers to request service tickets for
  domain accounts, typically service accounts, and crack them offline to gain privileged
  access. If confirmed malicious, this could lead to unauthorized access, privilege
  escalation, and further compromise of the Active Directory environment.
required_fields:
- _time
- EventCode
- TicketOptions
- TicketEncryptionType
- Computer
- service
- service_id
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=4769 ServiceName!="*$" (TicketOptions=0x40810000 OR TicketOptions=0x40800000
  OR TicketOptions=0x40810010) TicketEncryptionType=0x17 | stats count min(_time)
  as firstTime max(_time) as lastTime by Computer, user, service_id, service, TicketEncryptionType,
  TicketOptions | rename Computer as dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `kerberoasting_spn_request_with_rc4_encryption_filter`
