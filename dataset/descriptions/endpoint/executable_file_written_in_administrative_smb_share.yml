description: The following analytic detects executable files (.exe or .dll) being
  written to Windows administrative SMB shares (Admin$, IPC$, C$). It leverages Windows
  Security Event Logs with EventCode 5145 to identify this activity. This behavior
  is significant as it is commonly used by tools like PsExec/PaExec for staging binaries
  before creating and starting services on remote endpoints, a technique often employed
  for lateral movement and remote code execution. If confirmed malicious, this activity
  could allow an attacker to execute arbitrary code remotely, potentially compromising
  additional systems within the network.
required_fields:
- _time
- EventCode
- Share_Name
- Relative_Target_Name
- Object_Type
- Access_Mask
- user
- src_port
- Source_Address
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security
  EventCode=5145 RelativeTargetName IN ("*.exe","*.dll") ObjectType=File ShareName
  IN ("\\\\*\\C$","\\\\*\\IPC$","\\\\*\\admin$") AccessMask= "0x2" | stats min(_time)
  as firstTime max(_time) as lastTime count by EventCode ShareName RelativeTargetName
  ObjectType AccessMask src_user src_port IpAddress | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)  | `executable_file_written_in_administrative_smb_share_filter`
