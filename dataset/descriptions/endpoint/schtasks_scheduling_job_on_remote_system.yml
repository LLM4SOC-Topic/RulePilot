description: The following analytic detects the use of 'schtasks.exe' to create a
  scheduled task on a remote system, indicating potential lateral movement or remote
  code execution. It leverages process data from Endpoint Detection and Response (EDR)
  agents, focusing on specific command-line arguments and flags. This activity is
  significant as it may signify an adversary's attempt to persist or execute code
  remotely. If confirmed malicious, this could allow attackers to maintain access,
  execute arbitrary commands, or further infiltrate the network, posing a severe security
  risk.
required_fields:
- _time
- Processes.process_name
- Processes.process
- Processes.parent_process_name
- Processes.dest
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name = schtasks.exe OR
  Processes.original_file_name=schtasks.exe) (Processes.process="*/create*" AND Processes.process="*/s*")
  by Processes.process_name Processes.process Processes.parent_process_name Processes.dest
  Processes.user | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `schtasks_scheduling_job_on_remote_system_filter`'
