description: The following analytic detects a process loading the credui.dll or wincredui.dll
  module. This detection leverages Sysmon EventCode 7 to identify instances where
  these DLLs are loaded by processes outside typical system directories. This activity
  is significant because adversaries often abuse these modules to create fake credential
  prompts or dump credentials, posing a risk of credential theft. If confirmed malicious,
  this activity could allow attackers to harvest user credentials, leading to unauthorized
  access and potential lateral movement within the network.
required_fields:
- _time
- Image
- ImageLoaded
- process_name
- dest
- EventCode
- Signed
- ProcessId
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=7  (ImageLoaded = "*\\credui.dll"
  AND OriginalFileName = "credui.dll") OR (ImageLoaded = "*\\wincredui.dll" AND OriginalFileName
  = "wincredui.dll") AND NOT(Image IN("*\\windows\\explorer.exe", "*\\windows\\system32\\*",
  "*\\windows\\sysWow64\\*", "*:\\program files*")) | stats count min(_time) as firstTime
  max(_time) as lastTime by Image ImageLoaded OriginalFileName dest EventCode Signed
  ProcessId ProcessGuid | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) |
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_input_capture_using_credential_ui_dll_filter`
