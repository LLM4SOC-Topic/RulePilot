description: The following analytic detects the execution of the 'shred' command on
  a Linux machine, which is used to overwrite files to make them unrecoverable. It
  leverages data from Linux Auditd, focusing on process names and command-line arguments.
  This activity is significant because the 'shred' command can be used in destructive
  attacks, such as those seen in the Industroyer2 malware targeting energy facilities.
  If confirmed malicious, this activity could lead to the permanent destruction of
  critical files, severely impacting system integrity and data availability.
required_fields:
- _time
- proctitle
rule: sourcetype="linux:audit" type=PROCTITLE | eval normalized_proctitle_delimiter
  = if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(proctitle,"^[0-9A-F]+$"),
  replace(proctitle, "000", "020"),proctitle),null()) | eval normalized_proctitle_delimiter  =
  if(type=="PROCTITLE" AND isnotnull(proctitle), if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),
  replace(normalized_proctitle_delimiter, "00", "20"),normalized_proctitle_delimiter),null())
  | eval process_exec = if(match(normalized_proctitle_delimiter,"^[0-9A-F]+$"),urldecode(replace(normalized_proctitle_delimiter,"([0-9A-F]{2})","%\1")),normalized_proctitle_delimiter)
  | rename host as dest | where LIKE (process_exec, "%shred%") AND (LIKE (process_exec,
  "%-n%") OR LIKE (process_exec, "%-z%") OR LIKE (process_exec, "%-u%") OR LIKE (process_exec,
  "%-s%")) | stats count min(_time) as firstTime max(_time) as lastTime by process_exec
  proctitle normalized_proctitle_delimiter dest | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `linux_auditd_shred_overwrite_command_filter`
