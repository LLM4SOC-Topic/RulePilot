description: The following analytic detects suspicious modifications to firewall rule
  registry settings that allow inbound traffic on specific ports with a public profile.
  It leverages data from the Endpoint.Registry data model, focusing on registry paths
  and values indicative of such changes. This activity is significant as it may indicate
  an adversary attempting to grant remote access to a machine by modifying firewall
  rules. If confirmed malicious, this could enable unauthorized remote access, potentially
  leading to further exploitation, data exfiltration, or lateral movement within the
  network.
required_fields:
- _time
- Registry.dest
- Registry.registry_value_name
- Registry.registry_key_name
- Registry.registry_path
- Registry.registry_value_data
- Registry.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  FROM datamodel=Endpoint.Registry WHERE (Registry.registry_path= "*\\System\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\FirewallRules\\*"
  Registry.registry_value_data = "*|Action=Allow|*" Registry.registry_value_data =
  "*|Dir=In|*"  Registry.registry_value_data = "*|LPort=*") BY Registry.registry_path
  Registry.registry_key_name Registry.registry_value_name Registry.registry_value_data
  Registry.process_guid  Registry.dest Registry.user | `drop_dm_object_name(Registry)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `allow_inbound_traffic_by_firewall_rule_registry_filter`'
