description: The following analytic detects modifications to the Windows Registry
  specifically targeting `.pwn` file associations related to the ValleyRAT malware.
  ValleyRAT may create or alter registry entries to associate `.pwn` files with malicious
  processes, allowing it to execute harmful scripts or commands when these files are
  opened. By monitoring for unusual changes in registry keys linked to `.pwn` extensions,
  this detection enables security analysts to identify potential ValleyRAT infection
  attempts. Early detection of these modifications helps mitigate unauthorized execution
  and prevents further exploitation of the system.
required_fields:
- Registry.dest
- Registry.registry_value_name
- Registry.registry_key_name
- Registry.registry_path
- Registry.registry_value_data
- Registry.process_guid
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count FROM datamodel=Endpoint.Registry WHERE (Registry.registry_path=
  "*.pwn\\Shell\\Open\\command" OR Registry.registry_value_data = ".pwn") BY Registry.dest
  Registry.user Registry.registry_path Registry.registry_key_name Registry.registry_value_name
  Registry.registry_value_data Registry.process_guid | `drop_dm_object_name(Registry)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_modify_registry_valleyrat_pwn_reg_entry_filter`'
