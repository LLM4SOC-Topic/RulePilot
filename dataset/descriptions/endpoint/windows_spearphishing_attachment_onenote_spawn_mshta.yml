description: The following analytic detects OneNote spawning `mshta.exe`, a behavior
  often associated with spearphishing attacks. It leverages data from Endpoint Detection
  and Response (EDR) agents, focusing on process creation events where OneNote is
  the parent process. This activity is significant as it is commonly used by malware
  families like TA551, AsyncRat, Redline, and DCRAT to execute malicious scripts.
  If confirmed malicious, this could allow attackers to execute arbitrary code, potentially
  leading to data exfiltration, system compromise, or further malware deployment.
  Immediate investigation and containment are recommended.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name IN ("onenote.exe",
  "onenotem.exe") (Processes.process_name=mshta.exe OR Processes.original_file_name=MSHTA.EXE)
  by Processes.dest Processes.user Processes.parent_process_name Processes.parent_process
  Processes.process_name Processes.original_file_name Processes.process Processes.process_id
  Processes.parent_process_id | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_spearphishing_attachment_onenote_spawn_mshta_filter`'
