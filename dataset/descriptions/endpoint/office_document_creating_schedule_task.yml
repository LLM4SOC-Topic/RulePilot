description: The following analytic detects an Office document creating a scheduled
  task, either through a macro VBA API or by loading `taskschd.dll`. This detection
  leverages Sysmon EventCode 7 to identify when Office applications load the `taskschd.dll`
  file. This activity is significant as it is a common technique used by malicious
  macro malware to establish persistence or initiate beaconing. If confirmed malicious,
  this could allow an attacker to maintain persistence, execute arbitrary commands,
  or schedule future malicious activities, posing a significant threat to the environment.
required_fields:
- ImageLoaded
- AllImageLoaded
- dest
- EventCode
- Image
- process_name
- ProcessId
- ProcessGuid
- _time
rule: sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
  OR source=Syslog:Linux-Sysmon/Operational EventCode=7 process_name IN ("WINWORD.EXE",
  "EXCEL.EXE", "POWERPNT.EXE","onenote.exe","onenotem.exe","onenoteviewer.exe","onenoteim.exe",
  "msaccess.exe") loaded_file_path = "*\\taskschd.dll" | stats min(_time) as firstTime
  max(_time) as lastTime count by user_id, dest, process_name,loaded_file, loaded_file_path,
  original_file_name, process_guid | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `office_document_creating_schedule_task_filter`
