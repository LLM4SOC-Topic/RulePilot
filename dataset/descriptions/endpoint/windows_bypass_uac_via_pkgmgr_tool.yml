description: The following analytic detects the execution of the deprecated 'pkgmgr.exe'
  process with an XML input file, which is unusual and potentially suspicious. This
  detection leverages Endpoint Detection and Response (EDR) telemetry, focusing on
  process execution details and command-line arguments. The significance lies in the
  deprecated status of 'pkgmgr.exe' and the use of XML files, which could indicate
  an attempt to bypass User Account Control (UAC). If confirmed malicious, this activity
  could allow an attacker to execute commands with elevated privileges, leading to
  potential system compromise and unauthorized changes.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where  Processes.process_name = pkgmgr.exe Processes.process
  = "*.xml*" NOT(Processes.parent_process_path IN("*:\\windows\\system32\\*", "*:\\windows\\syswow64\\*",
  "*:\\Program Files*")) by Processes.dest Processes.user Processes.parent_process_name
  Processes.parent_process_path Processes.process_name Processes.process Processes.process_id
  Processes.parent_process_id Processes.original_file_name | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_bypass_uac_via_pkgmgr_tool_filter`'
