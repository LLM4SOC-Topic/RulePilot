description: The following analytic identifies the execution of `adfind.exe` with
  specific command-line arguments related to Active Directory queries. It leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process names,
  command-line arguments, and parent processes. This activity is significant because
  `adfind.exe` is a powerful tool often used by threat actors like Wizard Spider and
  FIN6 to gather sensitive AD information. If confirmed malicious, this activity could
  allow attackers to map the AD environment, facilitating further attacks such as
  privilege escalation or lateral movement.
required_fields:
- _time
- Processes.process
- Processes.dest
- Processes.user
- Processes.process_name
- Processes.parent_process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where ((Processes.process="* -f *" OR Processes.process="*
  -b *") AND (Processes.process=*objectcategory* OR Processes.process="*-gcb *" OR
  Processes.process="* -sc *" )) OR ((Processes.process="*trustdmp*" OR Processes.process="*dclist*"))
  by Processes.dest Processes.user Processes.process_name Processes.process Processes.parent_process
  Processes.process_id Processes.parent_process_id  | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_adfind_exe_filter`| `windows_adfind_exe_filter`'
