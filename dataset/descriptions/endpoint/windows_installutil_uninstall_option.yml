description: The following analytic detects the use of the Windows InstallUtil.exe
  binary with the `/u` (uninstall) switch, which can execute code while bypassing
  application control. This detection leverages data from Endpoint Detection and Response
  (EDR) agents, focusing on process names, parent processes, and command-line executions.
  This activity is significant because it can indicate an attempt to execute malicious
  code without administrative privileges. If confirmed malicious, an attacker could
  achieve code execution, potentially leading to further system compromise or persistence
  within the environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=installutil.exe
  OR Processes.original_file_name=InstallUtil.exe) Processes.process IN ("*/u*", "*uninstall*")
  NOT (Processes.process IN ("*C:\\WINDOWS\\CCM\\*")) NOT (Processes.parent_process_name
  IN ("Microsoft.SharePoint.Migration.ClientInstaller.exe")) by Processes.dest Processes.user
  Processes.parent_process_name Processes.process_name Processes.original_file_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| `windows_installutil_uninstall_option_filter`'
