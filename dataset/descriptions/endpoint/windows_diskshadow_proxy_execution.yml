description: The following analytic detects the use of DiskShadow.exe in scripting
  mode, which can execute arbitrary unsigned code. It leverages data from Endpoint
  Detection and Response (EDR) agents, focusing on command-line executions with scripting
  mode flags. This activity is significant because DiskShadow.exe is typically used
  for legitimate backup operations, but its misuse can indicate an attempt to execute
  unauthorized code. If confirmed malicious, this could lead to unauthorized code
  execution, potentially compromising the system and allowing further malicious activities.
required_fields:
- _time
- Processes.process
- Porcesses.dest
- Processes.user
- Processes.parent_process
- Processes.process_name
- Processes.process_id
- Processes.parent_process_id
- Processes.original_file_name
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where (Processes.process_name=diskshadow.exe OR
  Processes.original_file_name=diskshadow.exe) (Processes.process=*-s* OR Processes.process=*/s*)
  by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `windows_diskshadow_proxy_execution_filter`'
