description: The following analytic identifies a source host failing to authenticate
  against a remote host with multiple users, potentially indicating a Password Spraying
  attack. It leverages Windows Event 4625 (failed logon attempts) and Logon Type 3
  (remote authentication) to detect this behavior. This activity is significant as
  it may represent an adversary attempting to gain initial access or elevate privileges
  within an Active Directory environment. If confirmed malicious, this could lead
  to unauthorized access, privilege escalation, and further compromise of the network.
required_fields:
- _time
- EventCode
- Logon_Type
- TargetUserName
- Computer
- IpAddress
rule: eventtype=wineventlog_security OR Channel=security OR source=XmlWinEventLog:Security  EventCode=4625
  Logon_Type=3 IpAddress!="-" | bucket span=2m _time | stats dc(TargetUserName) AS
  unique_accounts values(TargetUserName) as tried_accounts by _time, IpAddress, Computer
  | eventstats avg(unique_accounts) as comp_avg , stdev(unique_accounts) as comp_std
  by IpAddress, Computer | eval upperBound=(comp_avg+comp_std*3) | eval isOutlier=if(unique_accounts
  > 10 and unique_accounts >= upperBound, 1, 0) | search isOutlier=1 | `windows_unusual_count_of_users_remotely_failed_to_auth_from_host_filter`
