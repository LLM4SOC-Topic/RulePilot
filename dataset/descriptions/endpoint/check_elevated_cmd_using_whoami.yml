description: The following analytic identifies the execution of the 'whoami' command
  with specific parameters to check for elevated privileges. It leverages data from
  Endpoint Detection and Response (EDR) agents, focusing on process and command-line
  telemetry. This activity is significant because it is commonly used by attackers,
  such as FIN7, to perform reconnaissance on a compromised host. If confirmed malicious,
  this behavior could indicate an attacker is assessing their privilege level, potentially
  leading to further privilege escalation or persistence within the environment.
required_fields:
- _time
- Processes.parent_process_name
- Processes.parent_process
- Processes.process_name
- Processes.process_id
- Processes.process
- Processes.dest
- Processes.user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where  Processes.process = "*whoami*" Processes.process
  = "*/group*" Processes.process = "* find *" Processes.process = "*12288*" by Processes.dest
  Processes.user Processes.parent_process Processes.process_name Processes.process
  Processes.process_id Processes.parent_process_id | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `check_elevated_cmd_using_whoami_filter`'
