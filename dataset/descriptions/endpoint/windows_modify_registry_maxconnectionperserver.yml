description: The following analytic identifies a suspicious modification of the Windows
  registry setting for max connections per server. It detects changes to specific
  registry paths using data from the Endpoint.Registry datamodel. This activity is
  significant because altering this setting can be exploited by attackers to increase
  the number of concurrent connections to a remote server, potentially facilitating
  DDoS attacks or enabling more effective lateral movement within a compromised network.
  If confirmed malicious, this could lead to network disruption or further compromise
  of additional systems.
required_fields:
- _time
- Registry.registry_key_name
- Registry.registry_path
- Registry.user
- Registry.dest
- Registry.registry_value_name
- Registry.action
- Registry.registry_value_data
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  FROM datamodel=Endpoint.Registry where (Registry.registry_path= "*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet
  Settings\\MaxConnectionsPerServer*" OR Registry.registry_path= "*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet
  Settings\\MaxConnectionsPer1_0Server*")  Registry.registry_value_data = "0x0000000a"
  by Registry.registry_key_name Registry.user Registry.registry_path Registry.registry_value_data
  Registry.action Registry.dest | `drop_dm_object_name(Registry)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `windows_modify_registry_maxconnectionperserver_filter`'
