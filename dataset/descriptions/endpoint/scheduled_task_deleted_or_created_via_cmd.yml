description: The following analytic identifies the creation or deletion of scheduled
  tasks using the schtasks.exe utility with the -create or -delete flags. It leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process names
  and command-line executions. This activity is significant as it can indicate unauthorized
  system manipulation or malicious intent, often associated with threat actors like
  Dragonfly and incidents such as the SUNBURST attack. If confirmed malicious, this
  activity could allow attackers to execute code, escalate privileges, or persist
  within the environment, posing a significant security risk.
required_fields:
- _time
- Processes.process
- Processes.parent_process
- Processes.process_name
- Processes.user
- Processes.parent_process_name
- Processes.dest
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Processes.process) as process values(Processes.parent_process)
  as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes
  where Processes.process_name=schtasks.exe (Processes.process=*delete* OR Processes.process=*create*)
  by Processes.user Processes.process_name Processes.parent_process_name Processes.dest
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)|
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `scheduled_task_deleted_or_created_via_cmd_filter`'
