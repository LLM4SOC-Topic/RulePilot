description: The following analytic detects the execution of PHP commands with elevated
  privileges on a Linux system. It identifies instances where PHP is used in conjunction
  with 'sudo' and 'system' commands, indicating an attempt to run system commands
  as the root user. This detection leverages data from Endpoint Detection and Response
  (EDR) agents, focusing on process command-line arguments. This activity is significant
  because it can indicate an attempt to escalate privileges, potentially leading to
  full root access. If confirmed malicious, this could allow an attacker to execute
  arbitrary commands with root privileges, compromising the entire system.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process="*php*-r*" AND Processes.process="*system*"
  AND Processes.process="*sudo*" by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  Processes.process_guid | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `linux_php_privilege_escalation_filter`'
