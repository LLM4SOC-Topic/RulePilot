description: The following analytic detects the deletion of services on a Linux machine.
  It leverages filesystem event logs to identify when service files within system
  directories (e.g., /etc/systemd/, /lib/systemd/, /run/systemd/) are deleted. This
  activity is significant because attackers may delete or modify services to disable
  security features or evade defenses. If confirmed malicious, this behavior could
  indicate an attempt to impair system functionality or execute a destructive payload,
  potentially leading to system instability or data loss. Immediate investigation
  is required to determine the responsible process and user.
required_fields:
- _time
- Filesystem.dest
- Filesystem.file_create_time
- Filesystem.file_name
- Filesystem.process_guid
- Filesystem.file_path
- Filesystem.action
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  FROM datamodel=Endpoint.Filesystem where Filesystem.action=deleted Filesystem.file_path
  IN ( "/etc/systemd/*", "*/lib/systemd/*", "*/run/systemd/*") Filesystem.file_path
  = "*.service" by _time span=1h Filesystem.file_name Filesystem.file_path Filesystem.dest
  Filesystem.process_guid Filesystem.action | `drop_dm_object_name(Filesystem)` |
  convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$)| `linux_deletion_of_services_filter`'
