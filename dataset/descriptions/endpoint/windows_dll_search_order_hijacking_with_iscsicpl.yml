description: The following analytic detects DLL search order hijacking involving iscsicpl.exe.
  It identifies when iscsicpl.exe loads a malicious DLL from a new path, triggering
  the payload execution. This detection leverages data from Endpoint Detection and
  Response (EDR) agents, focusing on child processes spawned by iscsicpl.exe. This
  activity is significant as it indicates a potential attempt to execute unauthorized
  code via DLL hijacking. If confirmed malicious, this could allow an attacker to
  execute arbitrary code, escalate privileges, or maintain persistence within the
  environment.
required_fields:
- _time
- Processes.dest
- Processes.user
- Processes.parent_process_name
- Processes.parent_process
- Processes.original_file_name
- Processes.process_name
- Processes.process
- Processes.process_id
- Processes.parent_process_path
- Processes.process_path
- Processes.parent_process_id
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.parent_process_name=iscsicpl.exe
  (Processes.process_name=cmd.exe OR Processes.process_name=powershell.exe OR Processes.process_name=pwsh.exe
  OR Processes.process_name=sh.exe OR Processes.process_name=bash.exe OR Processes.process_name=wscript.exe
  OR Processes.process_name=cscript.exe) by Processes.dest Processes.user Processes.parent_process_name
  Processes.process_name Processes.process Processes.process_id Processes.parent_process_id
  | `drop_dm_object_name(Processes)` | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)| `windows_dll_search_order_hijacking_with_iscsicpl_filter`'
