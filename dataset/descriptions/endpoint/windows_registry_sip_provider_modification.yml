description: The following analytic detects modifications to the Windows Registry
  SIP Provider. It leverages Sysmon EventID 7 to monitor registry changes in paths
  and values related to Cryptography Providers and OID Encoding Types. This activity
  is significant as it may indicate an attempt to subvert trust controls, a common
  tactic for bypassing security measures and maintaining persistence. If confirmed
  malicious, an attacker could manipulate the system's cryptographic functions, potentially
  leading to unauthorized access, data theft, or other damaging outcomes. Review the
  modified registry paths and concurrent processes to identify the attack source.
required_fields:
- Registry.dest
- Registry.user
- Registry.registry_value_name
- Registry.registry_value_data
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count values(Registry.registry_key_name) as registry_key_name
  values(Registry.registry_path) as registry_path min(_time) as firstTime max(_time)
  as lastTime from datamodel=Endpoint.Registry where Registry.registry_path IN ("*\\SOFTWARE\\Microsoft\\Cryptography\\Providers\\*",
  "*\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType*", "*\\SOFTWARE\\WOW6432Node\\Microsoft\\Cryptography\\Providers\\*",
  "*\\SOFTWARE\\WOW6432Node\\Microsoft\\Cryptography\\OID\\EncodingType*") Registry.registry_value_name
  IN ("Dll","$DLL") by Registry.dest , Registry.user Registry.registry_value_name,
  Registry.registry_value_data | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | `drop_dm_object_name(Registry)`|
  `windows_registry_sip_provider_modification_filter`'
