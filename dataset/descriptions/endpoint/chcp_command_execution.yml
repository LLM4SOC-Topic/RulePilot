description: The following analytic detects the execution of the chcp.exe application,
  which is used to change the active code page of the console. This detection leverages
  data from Endpoint Detection and Response (EDR) agents, focusing on process creation
  events where chcp.exe is executed by cmd.exe with specific command-line arguments.
  This activity is significant because it can indicate the presence of malware, such
  as IcedID, which uses this technique to determine the locale region, language, or
  country of the compromised host. If confirmed malicious, this could lead to further
  system compromise and data exfiltration.
required_fields:
- _time
- process_name
- process
- parent_process_name
- parent_process
- process_id
- parent_process_id
- dest
- user
rule: '| tstats summariesonly=`summariesonly_config` allow_old_summaries=`oldsummaries_config`
  fillnull_value=`fillnull_config` count min(_time) as firstTime max(_time) as lastTime
  from datamodel=Endpoint.Processes where Processes.process_name=chcp.com Processes.parent_process_name
  = cmd.exe (Processes.parent_process=*/c* OR Processes.parent_process=*/k*) by  Processes.process_name
  Processes.process Processes.parent_process_name Processes.parent_process Processes.process_id
  Processes.parent_process_id Processes.dest Processes.user | `drop_dm_object_name(Processes)`
  | convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$) | convert timeformat="%Y-%m-%dT%H:%M:%S"
  ctime($field$) | `chcp_command_execution_filter`'
