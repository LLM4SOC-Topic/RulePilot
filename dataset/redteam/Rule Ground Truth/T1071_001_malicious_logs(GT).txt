Atomic Test #1 - Malicious User Agents - Powershell

Log1
10/02/2024 11:11:03 AM
LogName=Microsoft-Windows-PowerShell/Operational
EventCode=4104
EventType=5
ComputerName=DESKTOP-J7QIHDK
User=S-1-5-21-2868460691-234795373-3089146751-1001
Sid=S-1-5-21-2868460691-234795373-3089146751-1001
SidType=129
SourceName=Microsoft-Windows-PowerShell
Type=详细
RecordNumber=3032
Keywords=None
TaskCategory=执行远程命令
OpCode=在创建调用时
Message=正在创建 Scriptblock 文本(已完成 1，共 1):
Invoke-WebRequest www.google.com -UserAgent "*<|>*" | out-null

ScriptBlock ID: 9c4dafb6-5733-48c7-b0d0-8a96eea2fbf1
路径: 
Collapse
host = DESKTOP-J7QIHDKsource = C:\Users\nus\Desktop\TTP_logs\15ttp_logs_2_with_powershell\T1071.001\T1071_001_powershell.evtxsourcetype = WinEventLog:Microsoft-Windows-PowerShell/Operational

Log2
10/02/2024 11:11:03 AM
LogName=Microsoft-Windows-PowerShell/Operational
EventCode=4104
EventType=5
ComputerName=DESKTOP-J7QIHDK
User=S-1-5-21-2868460691-234795373-3089146751-1001
Sid=S-1-5-21-2868460691-234795373-3089146751-1001
SidType=129
SourceName=Microsoft-Windows-PowerShell
Type=详细
RecordNumber=3030
Keywords=None
TaskCategory=执行远程命令
OpCode=在创建调用时
Message=正在创建 Scriptblock 文本(已完成 1，共 1):
Invoke-WebRequest www.google.com -UserAgent "Opera/8.81 (Windows NT 6.0; U; en)" | out-null

ScriptBlock ID: 31e9d2ad-67fe-4f19-bd45-68bad3c099d1
路径: 
Collapse
host = DESKTOP-J7QIHDKsource = C:\Users\nus\Desktop\TTP_logs\15ttp_logs_2_with_powershell\T1071.001\T1071_001_powershell.evtxsourcetype = WinEventLog:Microsoft-Windows-PowerShell/Operational

Log3
10/02/2024 11:11:03 AM
LogName=Microsoft-Windows-PowerShell/Operational
EventCode=4104
EventType=5
ComputerName=DESKTOP-J7QIHDK
User=S-1-5-21-2868460691-234795373-3089146751-1001
Sid=S-1-5-21-2868460691-234795373-3089146751-1001
SidType=129
SourceName=Microsoft-Windows-PowerShell
Type=详细
RecordNumber=3028
Keywords=None
TaskCategory=执行远程命令
OpCode=在创建调用时
Message=正在创建 Scriptblock 文本(已完成 1，共 1):
Invoke-WebRequest www.google.com -UserAgent "Wget/1.9+cvs-stable (Red Hat modified)" | out-null

ScriptBlock ID: 0d6601af-46f8-46be-badb-c41ae78cd643
路径: 
Collapse
host = DESKTOP-J7QIHDKsource = C:\Users\nus\Desktop\TTP_logs\15ttp_logs_2_with_powershell\T1071.001\T1071_001_powershell.evtxsourcetype = WinEventLog:Microsoft-Windows-PowerShell/Operational

Log4
10/02/2024 11:11:03 AM
LogName=Microsoft-Windows-PowerShell/Operational
EventCode=4100
EventType=3
ComputerName=DESKTOP-J7QIHDK
User=S-1-5-21-2868460691-234795373-3089146751-1001
Sid=S-1-5-21-2868460691-234795373-3089146751-1001
SidType=129
SourceName=Microsoft-Windows-PowerShell
Type=警告
RecordNumber=3019
Keywords=None
TaskCategory=正在执行管道
OpCode=引发异常时使用
Message=Error Message = 
Virus/Spyware Download Blocked

The file you are trying to download has been blocked in accordance with company policy regarding viruses and spyware. Please contact your system administrator if you believe this is an error.


File name: www.google.com/ 
Fully Qualified Error ID = WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand
Recommended Action = 


上下文:
        Severity = Warning
        Host Name = ConsoleHost
        Host Version = 5.1.19041.4894
        Host ID = abe5f7b3-0c31-4f8a-9534-02c893d640d8
        Host Application = C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
        Engine Version = 5.1.19041.4894
        Runspace ID = 2ec8a2dc-43c0-4918-b28f-e9c5d568b95d
        Pipeline ID = 37
        Command Name = Invoke-WebRequest
        Command Type = Cmdlet
        Script Name = 
        Command Path = 
        Sequence Number = 57
        User = DESKTOP-J7QIHDK\xcy
        Connected User = 
        Shell ID = Microsoft.PowerShell


用户数据:

Collapse
host = DESKTOP-J7QIHDKsource = C:\Users\nus\Desktop\TTP_logs\15ttp_logs_2_with_powershell\T1071.001\T1071_001_powershell.evtxsourcetype = WinEventLog:Microsoft-Windows-PowerShell/Operational

Log5
10/02/2024 11:11:03 AM
LogName=Microsoft-Windows-PowerShell/Operational
EventCode=4104
EventType=5
ComputerName=DESKTOP-J7QIHDK
User=S-1-5-21-2868460691-234795373-3089146751-1001
Sid=S-1-5-21-2868460691-234795373-3089146751-1001
SidType=129
SourceName=Microsoft-Windows-PowerShell
Type=详细
RecordNumber=3018
Keywords=None
TaskCategory=执行远程命令
OpCode=在创建调用时
Message=正在创建 Scriptblock 文本(已完成 1，共 1):
Invoke-WebRequest www.google.com -UserAgent "HttpBrowser/1.0" | out-null

ScriptBlock ID: 3eb95da9-0f27-480c-b071-69be5f8c33b4
路径: 
Collapse
host = DESKTOP-J7QIHDKsource = C:\Users\nus\Desktop\TTP_logs\15ttp_logs_2_with_powershell\T1071.001\T1071_001_powershell.evtxsourcetype = WinEventLog:Microsoft-Windows-PowerShell/Operational

Atomic Test #2 - Malicious User Agents - CMD

Log1
09/03/2024 02:29:54 PM
LogName=Microsoft-Windows-Sysmon/Operational
EventCode=1
EventType=4
ComputerName=DESKTOP-43B3OH1
User=SYSTEM
Sid=S-1-5-18
SidType=1
SourceName=Microsoft-Windows-Sysmon
Type=信息
RecordNumber=392221
Keywords=None
TaskCategory=Process Create (rule: ProcessCreate)
OpCode=信息
Message=Process Create:
RuleName: -
UtcTime: 2024-09-03 06:29:54.041
ProcessGuid: {6f6dba56-ace2-66d6-5b32-2b0000001700}
ProcessId: 106224
Image: C:\Windows\System32\curl.exe
FileVersion: 8.7.1
Description: The curl executable
Product: The curl executable
Company: curl, https://curl.se/
OriginalFileName: curl.exe
CommandLine: C:\Windows\System32\Curl.exe  -A "HttpBrowser/1.0" -m3 www.google.com 
CurrentDirectory: C:\Windows\system32\
User: DESKTOP-43B3OH1\xcy
LogonGuid: {6f6dba56-34a7-66d6-0a51-0c2102000000}
LogonId: 0x2210C510A
TerminalSessionId: 2
IntegrityLevel: High
Hashes: SHA1=81C324DDC98578136DBE7D2A8D388A2EF52A86F6,MD5=50679935A55F0805DC12A9188065DFAE,SHA256=2BBAD800BC5058CAD5631DBFFD39FB8A293616479250C47B38DC8E8EB61DC3DA,IMPHASH=56794FF286FC53558CCB48D15E1FB35A
ParentProcessGuid: {6f6dba56-41b7-66d6-4c79-2a0000001700}
ParentProcessId: 7560
ParentImage: C:\Windows\System32\cmd.exe
ParentCommandLine: "C:\Windows\system32\cmd.exe" 
ParentUser: DESKTOP-43B3OH1\xcy
Collapse
host = DESKTOP-43B3OH1source = C:\Users\nus\Desktop\TTP_logs\15ttp_logs_2_with_powershell\T1071.001\T1071_001.evtxsourcetype = WinEventLog:Microsoft-Windows-Sysmon/Operational
